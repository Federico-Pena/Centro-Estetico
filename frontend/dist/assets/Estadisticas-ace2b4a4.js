import{r as n,j as s,U as $}from"./index-4e232b89.js";import{T as i}from"./TransitionNumber-4119ef34.js";import{H as M,M as f,a as b}from"./constantes-5af98ff7.js";import{f as y}from"./fetchData-919cca5f.js";function A(e){const o=Object.values(e).reduce((a,t)=>a+t.cantidad,0),c={};for(const a in e){const t=e[a].tratamiento,j=e[a].cantidad;c[t]=(j/o*100).toFixed(1)}const d=Object.entries(c).map(([a,t])=>({tratamiento:a,porcentaje:parseFloat(t)}));return d.sort((a,t)=>t.porcentaje-a.porcentaje),d}function T({datos:e}){const o=A(e),[c,d]=n.useState(!1);return n.useEffect(()=>{const a=setTimeout(()=>{d(!0)},300);return()=>clearTimeout(a)},[]),s.jsxs("article",{className:"porcentajes",children:[s.jsx("h3",{children:"Tratamientos Preferidos"}),s.jsx("ul",{className:`bar-chart ${c?"animate":""}`,children:o.map(({tratamiento:a,porcentaje:t})=>s.jsxs("li",{children:[a," ",t.toFixed(1)," %",s.jsx("div",{className:"bar",children:s.jsx("div",{className:"fill",style:{width:`${c?t:0}%`}})})]},a))})]})}const F=({estadisticasPacientes:e,tratamientosPacientes:o})=>s.jsxs("section",{className:"pacientesDatos",children:[s.jsx("h2",{children:"Datos de Pacientes"}),s.jsxs("ul",{className:"ulPacientesDatos",children:[s.jsxs("li",{children:["Pacientes",s.jsx("strong",{children:s.jsx(i,{from:0,to:e.totalPacientes,duration:2e3})})]}),s.jsxs("li",{children:["Promedio De Edad",s.jsxs("strong",{children:[s.jsx(i,{from:0,to:e.promedioDeEdades,duration:2e3})," ",s.jsx("span",{children:" años"})]})]})]}),s.jsx("section",{className:"pacientesPorcentaje",children:s.jsx(T,{datos:o})})]}),G={estadosMes:{reservasCanceladas:0,reservasPendientes:0,reservasTerminadas:0,reservasTodas:0},estadosTodas:{reservasCanceladas:0,reservasPendientes:0,reservasTerminadas:0,reservasTodas:0}};function v(e){return e>=1&&e<=12?f[e-1]:"Mes no válido"}const B=()=>{var h;const[e,o]=n.useState(M.split("-")[1]),[c,d]=n.useState({totalPacientes:0,promedioDeEdades:0}),[a,t]=n.useState(G),[j,P]=n.useState({}),[N,E]=n.useState({}),[m,g]=n.useState({totales:0,mes:0}),{accessToken:x}=n.useContext($);n.useEffect(()=>{const r=`${b.estadisticas.estadisticas}${e}`,l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${x||""}`}};(async()=>{await y(r,l,S)})()},[x,e]);const S=r=>{const{estadisticasPaciente:l,estadosMes:u,estadosTodas:C,reservaMotivo:D,gananciasReservas:R}=r;g(R),t({estadosMes:u,estadosTodas:C}),d(l),P(l.tratamientosPacientes),E(D)};return s.jsxs("main",{className:"mainEstadisticas",children:[s.jsx(F,{estadisticasPacientes:c,tratamientosPacientes:j}),s.jsxs("section",{className:"reservasEstadisticas",children:[s.jsx("h2",{children:"Datos de Reservas"}),s.jsxs("article",{className:"reservasEstadisticasArticle",children:[s.jsx("h3",{children:"Reservas del mes"}),s.jsxs("select",{className:"selectMeses",value:e,onChange:r=>o(r.target.value),children:[s.jsx("option",{value:e,children:`${v(e)}`},e),f.map((r,l)=>r!==`${v(e)}`&&s.jsx("option",{value:l+1,children:r},r))]}),s.jsxs("ul",{className:"ulReservasDatos",children:[s.jsxs("li",{children:["Ganancias",s.jsxs("strong",{children:["$"," ",s.jsx(i,{from:0,to:m.mes,duration:500})]})]}),s.jsxs("li",{children:["Todas",s.jsx("strong",{children:s.jsx(i,{from:0,to:(h=a.estadosMes)==null?void 0:h.reservasTodas,duration:500})})]}),s.jsx(p,{datos:a.estadosMes})]})]}),s.jsxs("article",{className:"reservasEstadisticasArticle",children:[s.jsx("h3",{children:"Total de las Reservas"}),s.jsxs("ul",{className:"ulReservasDatos",children:[s.jsxs("li",{children:["Ganancias",s.jsxs("strong",{children:["$"," ",s.jsx(i,{from:0,to:m.totales,duration:500})]})]}),s.jsxs("li",{children:["Todas",s.jsx("strong",{children:s.jsx(i,{from:0,to:a.estadosTodas.reservasTodas,duration:500})})]}),s.jsx(p,{datos:a==null?void 0:a.estadosTodas})]})]}),s.jsx(T,{datos:N})]})]})},p=({datos:e})=>s.jsxs(s.Fragment,{children:[s.jsxs("li",{className:"Pago",children:["Terminadas",s.jsx("strong",{children:s.jsx(i,{from:0,to:e.reservasTerminadas,duration:500})})]}),s.jsxs("li",{className:"Pendiente",children:["Pendientes",s.jsx("strong",{children:s.jsx(i,{from:0,to:e.reservasPendientes,duration:500})})]}),s.jsxs("li",{className:"Cancelada",children:["Canceladas",s.jsx("strong",{children:s.jsx(i,{from:0,to:e.reservasCanceladas,duration:500})})]})]});export{B as default};
