import{j as o,m as I,R as E,u as D,r as p,c as A,g as L}from"./index-BN4e8_cD.js";import{u as R}from"./useForm-CXfPmMIm.js";import{B as j}from"./Button-D70TNmHc.js";import{u as _,a as q}from"./useTratamientos-CPZHQVQH.js";import{L as c}from"./LabelInput-BKKsOyNx.js";import{D as O}from"./Dropdown-B46kqRJn.js";import{g as M}from"./getServiciosNombresYTratamientos-_9qnF2x3.js";import{u as V,b as B}from"./useLoaderContext-CL4xz49p.js";import{T as U}from"./TextErrorForm-BKvfVkcs.js";function $(e){const r=new FormData;return r.append("nombre",e.nombre.toLowerCase()),r.append("descripcion",e.descripcion),r.append("costoTotal",e.costoTotal),r.append("tiempo",e.tiempo),r.append("sesiones",e.sesiones),r.append("enPromocion",e.enPromocion),e.enPromocion&&r.append("foto",e.imagen),r}const z=({values:e,errors:r,handleChange:s})=>o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid gap-4 py-2 ",children:o.jsx(c,{className:"capitalize",errors:r,disabled:!0,labelText:"Servicio",name:"nombre",onChange:s,type:"text",value:e.nombre,placeholder:"Masaje Estético"})}),o.jsx("div",{className:"grid gap-4 border-t border-black py-2",children:o.jsx(c,{value:e.descripcion,labelText:"Descripcion",name:"descripcion",onChange:s,placeholder:"1 Sesión (Cuerpo completo)",type:"text",errors:r})}),o.jsx("div",{className:"grid gap-4 border-t border-black py-2",children:o.jsx(c,{value:e.tiempo,labelText:"Tiempo",name:"tiempo",onChange:s,placeholder:"50",type:"number",errors:r})}),o.jsx("div",{className:"grid gap-4 border-t border-black py-2",children:o.jsx(c,{value:e.sesiones,labelText:"Sesiones",name:"sesiones",onChange:s,placeholder:"1",type:"number",errors:r})}),o.jsx("div",{className:"grid gap-4 border-t border-black py-2",children:o.jsx(c,{value:e.costoTotal,labelText:"Precio",name:"costoTotal",onChange:s,placeholder:"1",type:"number",errors:r})})]}),G=({edicion:e,values:r,errors:s,handleChange:l})=>{var t,a;return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-flow-col items-center pt-4 gap-4 border-t border-black py-2",children:o.jsx(c,{errors:s,labelText:"En Promoción",name:"enPromocion",onChange:l,type:"checkbox",value:r.enPromocion})}),r.enPromocion&&o.jsxs("div",{className:"grid gap-4 border-t border-b pb-4 border-black py-2",children:[o.jsx("label",{htmlFor:"imagen",children:e?"Nueva imagen:":"Imagen para promoción:"}),o.jsx("input",{name:"imagen",id:"imagen",className:"cursor-pointer border border-black rounded-lg p-4",type:"file",accept:"image/*",onChange:l}),(r.imgPreview||((t=r.imagen)==null?void 0:t.secure_url))&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Imagen actual:"}),o.jsx("img",{className:"justify-self-center aspect-square rounded-lg object-cover object-center",src:r.imgPreview||((a=r.imagen)==null?void 0:a.secure_url),alt:`Imagen de servicio ${r.nombre||""}`})]}),s.imagen&&o.jsx("samp",{className:"error-message",children:s.imagen})]})]})},Y={nombre:{required:!0},costoTotal:{required:!0},sesiones:{required:!0,minValue:1},tiempo:{required:!0},descripcion:{required:!0,pattern:/^[^-]*$/,message:"La descripción no debe contener guiones."}},H=e=>({nombre:(e==null?void 0:e.servicio.nombre)||"",descripcion:(e==null?void 0:e.descripcion)||"",tiempo:(e==null?void 0:e.tiempo)||"",costoTotal:(e==null?void 0:e.costoTotal)||"",sesiones:(e==null?void 0:e.sesiones)||"",enPromocion:(e==null?void 0:e.enPromocion)||!1,imagen:(e==null?void 0:e.imagen)||""}),se=()=>{var x;const e=I(),r=(x=e.state)==null?void 0:x.tratamiento,s=e.pathname===E.admin.editarTratamiento,{dispatch:l}=_(),{accessToken:t}=V(),{setMensaje:a}=D(),{loading:f}=B(),{crearTratamiento:h,editarTratamiento:N}=q(),[y]=p.useState(H(r)),[b,v]=p.useState([]),{handleChange:m,values:g,onSubmitForm:F,errors:d,resetForm:S}=R(y,Y),w=A();p.useEffect(()=>{s||!s&&(async()=>{try{const n=await M(t,a);n.length&&v(n)}catch{return a("Ocurrió un error"),!1}})()},[t,a,s]);const u=()=>{l({type:L.SET_TRATAMIENTO_FILTRADO,payload:null}),S(),w(-1)},C=async i=>{const n=$(i);(s?await N(n,r._id):await h(n))&&u()},P=i=>{const T={target:{name:"nombre",value:i.target.textContent}};m(T)},k=i=>i.map(n=>n.nombre);return o.jsxs("section",{className:"grid grid-rows-[auto_1fr]  gap-4 px-4 py-8",children:[o.jsxs("h1",{className:"text-2xl text-color-violeta font-betonga text-center font-bold",children:[s?"Editar":"Crear"," Tratamiento"]}),o.jsxs("form",{className:"animate-fadeIn rounded-lg grid p-4 gap-4 max-w-md w-full self-start justify-self-center bg-color-verde-blanco border border-gray-300 shadow-lg",onSubmit:i=>F(i,C),children:[b.length>0&&o.jsx(O,{name:"Servicios Disponibles",list:k(b),onClickFunction:P}),o.jsx(z,{errors:d,handleChange:m,values:g}),o.jsx(G,{edicion:s,errors:d,handleChange:m,values:g}),o.jsx(U,{errors:d}),o.jsxs("footer",{className:"grid grid-flow-col gap-2",children:[o.jsx(j,{className:"w-full",bgColor:!0,disabled:f,tipo:"submit",texto:"Guardar"}),o.jsx(j,{onClickFunction:u,texto:"Cerrar",tipo:"button",className:"w-full"})]})]})]})};export{se as default};
