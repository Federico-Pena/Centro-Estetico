import{j as e,E as w,u as S,r as i,H as D,A as y}from"./index-Hh7_R6wJ.js";import{O as H,C as L}from"./OpenInfo-jv49R_IV.js";import{u as R,a as I,f as T,b as E}from"./useUserContext-DcMwd5wI.js";import{f as $}from"./useReservasContext-_ngMcy1i.js";import{L as C}from"./LabelInput-FL_WFd5g.js";import{u as M}from"./useForm-FkYXM2nw.js";import{T as q}from"./TextAreaLabel-hDeLTtfO.js";import{u as X}from"./useFormReserva-caWhrk6S.js";import{B as F}from"./Button-Upt60w8G.js";import"./useObserver-jBAvkzED.js";import"./compararFechas-I2kUju9M.js";function j(s){return s.split(" ").map(t=>t[0].toUpperCase()+t.substring(1)).join(" ")}const V=s=>{const t="59894539587",a=`Me interesa hacer la siguiente reserva. 
  Nombre: ${j(s.nombre)}.
  Fecha: ${j($(`${s.fecha} ${s.hora}`))}.
  Hora: ${s.hora}. 
  Observaciones: ${j(s.observaciones)}.`;window.open(`https://wa.me/${t}?text=${encodeURIComponent(a)}`,"_blank")},B=({values:s,handleSetHora:t,horasDisponibles:a})=>e.jsxs("ul",{className:"grid gap-4 grid-cols-5",children:[e.jsx("li",{className:"col-span-full",children:"Horas disponibles"}),a.map((o,n)=>n!==0&&n!==1&&o.estado!==w.pendiente&&o.estado!==w.pago&&!o.proximaHoraNoDisponible&&e.jsx("li",{className:`p-2 rounded-xl w-full grid place-content-center shadow-md ${o.id.split("T")[1]===s.hora?"col-span-full row-start-2 bg-color-violeta text-slate-50 max-w-md transition-[max-width]":"bg-slate-50 max-w-20 hover:opacity-50 cursor-pointer transition-opacity"}`,onClick:()=>t(o.id.split("T")[1]),children:o.id.split("T")[1]},o.id))]}),U=({values:s,horasDisponibles:t})=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-betonga text-color-violeta font-bold capitalize text-center underline underline-offset-4 text-2xl px-4",children:"Resumen"}),s.nombre&&e.jsxs("span",{className:"bg-color-verde-blanco text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Nombre ",e.jsx("strong",{className:"text-end text-balance",children:s.nombre})]}),s.fecha&&e.jsxs("span",{className:"bg-color-verde-blanco text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Dia"," ",e.jsx("strong",{className:"text-end text-balance",children:$(`${s.fecha} ${s.hora}`)})]}),s.hora&&t.length>0&&e.jsxs("span",{className:"bg-color-verde-blanco text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Hora ",e.jsx("strong",{className:"text-end text-balance",children:s.hora})]}),s.observaciones&&e.jsxs("span",{className:"bg-color-verde-blanco text-color-violeta py-2 px-4 grid gap-4 rounded capitalize",children:["Observación ",e.jsx("strong",{className:"text-pretty",children:s.observaciones})]})]}),P={nombre:{required:!0},fecha:{required:!0},hora:{required:!0}},O=({observaciones:s,cerrarFormulario:t})=>{const{loading:a}=R(),{setMensaje:o}=S(),n=i.useRef(),u={nombre:"",fecha:"",hora:"",observaciones:s||""},{errors:l,handleChange:p,values:r,validateForm:f}=M(u,P),{horasDisponibles:x}=X(r.fecha),b=new Date(r.fecha).getDay()===6,g=m=>{m.preventDefault(),f()&&!b&&r.nombre?(V(r),c()):o("Faltan campos requeridos.")},c=()=>{n.current.classList.add("animate-fadeOut")},d=m=>{p({target:{name:"hora",value:m}})};return e.jsxs("section",{id:"sectionForm",ref:n,className:"grid grid-rows-[50px_1fr] p-4 py-8",onAnimationEnd:m=>{m.target.id==="sectionForm"&&m.animationName!=="fadeIn"&&t()},children:[e.jsx("h1",{className:"font-betonga text-color-violeta font-bold capitalize text-center underline underline-offset-4 text-2xl px-4",children:"Reserva"}),e.jsxs("form",{onSubmit:g,className:"animate-fadeIn grid w-full max-w-md py-8 px-4 rounded-lg bg-color-logo gap-4 m-auto border border-black",children:[e.jsx(C,{errors:l,labelText:"Nombre",name:"nombre",onChange:p,placeholder:"Nombre",type:"text",value:r.nombre}),e.jsx(C,{className:"w-full",errors:l,labelText:"Fecha",name:"fecha",onChange:m=>{p(m),d("")},type:"date",value:r.fecha,min:D.split("T")[0]}),b?e.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los días domingos no se realizan reservas"}):null,x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{horasDisponibles:x,handleSetHora:d,values:r}),l.hora&&e.jsx("small",{className:"text-red-600",children:"* Este campo es requerido"})]}),e.jsx(q,{disabled:!0,value:r.observaciones,placeholder:"Observación",onChange:p,name:"observaciones",labelText:"Observación",error:l.observaciones}),e.jsx(U,{horasDisponibles:x,values:r}),e.jsxs("footer",{className:"grid grid-flow-col pt-8 px-4 gap-4",children:[e.jsx(F,{className:"w-full",tipo:"button",onClickFunction:c,texto:"Volver"}),e.jsx(F,{className:"w-full",bgColor:!0,tipo:"submit",texto:"Enviar",disabled:a})]})]})]})},G=()=>{const[s,t]=i.useState(0),[a,o]=i.useState([]),{setMensaje:n}=S(),{accessToken:u}=I();return i.useEffect(()=>{(async()=>{const f=E.publicas.getPromociones,x={headers:{authorization:`Bearer ${u}`}},b=await T(f,x),{error:g,datos:c,status:d}=b;d===200?o(c):n(g||"Error al obtener los datos")})()},[n,u]),i.useEffect(()=>{const f=setInterval(()=>{const x=(s+1)%a.length;t(x)},5e3);return()=>{clearInterval(f)}},[s,a.length]),{promos:a,nextSlide:()=>{const r=(s+1)%a.length;t(r)},prevSlide:()=>{const r=(s-1+a.length)%a.length;t(r)},currentIndex:s}},Y=({promos:s,handleReservar:t,currentIndex:a})=>e.jsx("div",{className:"overflow-hidden flex rounded-lg border border-slate-500",children:s.map(o=>{var n,u;return e.jsxs("figure",{className:"transition-transform duration-500 relative flex-[0_0_100%]",style:{transform:`translateX(-${a*100}%)`},children:[e.jsx("img",{className:"object-cover w-full h-full bg-slate-50 aspect-square max-h-[500px]",src:((n=o.imagen)==null?void 0:n.secure_url)||((u=o.servicio.imagen)==null?void 0:u.secure_url),alt:o.nombre}),e.jsx("button",{className:"absolute w-full max-w-64 bottom-4 left-1/2 -translate-x-1/2 font-bold text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent",onClick:()=>t(o),children:"Reservar"})]},o._id)})}),J=()=>{const[s,t]=i.useState(!1),[a,o]=i.useState(""),{nextSlide:n,prevSlide:u,promos:l,currentIndex:p}=G(),r=i.useRef(null),f=c=>{r.current=c.touches[0].clientX},x=()=>{r.current},b=c=>{if(r.current===null)return;const d=c.touches[0].clientX,m=r.current-d;m>50?n():m<-50&&u()},g=c=>{const d=`${c.servicio.nombre} - ${c.descripcion}`;o(d),t(!0)};return l instanceof Array?l.length>0&&e.jsxs(e.Fragment,{children:[s&&e.jsx(O,{observaciones:a,cerrarFormulario:()=>t(!1)}),e.jsxs("section",{className:"relative flex justify-center max-w-4xl m-auto mb-8",onTouchStart:f,onTouchMove:b,onTouchEnd:x,children:[l.length>1&&e.jsx("span",{className:"rounded-md cursor-pointer text-4xl absolute z-10 left-0 top-1/2 flex justify-center items-center rotate-90 transition-transform px-4 bg-[#00000025] hover:bg-[#0000003f] hover:scale-95",onClick:u,children:e.jsx(y,{})}),e.jsx(Y,{currentIndex:p,handleReservar:g,promos:l}),l.length>1&&e.jsx("span",{className:"rounded-md cursor-pointer text-4xl absolute z-10 right-0 top-1/2 flex justify-center items-center -rotate-90 transition-transform px-4 bg-[#00000025] hover:bg-[#0000003f] hover:scale-95",onClick:n,children:e.jsx(y,{})}),e.jsx("div",{className:" overflow-hidden absolute rounded-xl px-4 py-2 bg-[#00000025] -bottom-10 flex justify-center gap-x-4 m-auto",children:Array.from(l).map((c,d)=>e.jsx("span",{className:`${d===p?"bg-color-violeta translate-y-0":"translate-y-8"} rounded-full w-4 h-4 transition duration-500`},d))})]})]}):null},K=J;function ce(){const{setMensaje:s}=S(),{setLoading:t}=R(),{accessToken:a}=I(),[o,n]=i.useState([]),[u,l]=i.useState(null),[p,r]=i.useState(!1),[f,x]=i.useState(!1),[b,g]=i.useState(""),c=i.useRef();i.useEffect(()=>{try{t(!0),(async()=>{const v=E.publicas.getServicios,z={headers:{authorization:`Bearer ${a}`}},A=await T(v,z),{error:N,datos:_,status:k}=A;k===200?n(_):s(N||"Error al obtener los servicios")})()}catch{s("Error al obtener los servicios")}finally{t(!1)}},[s,a,t]);const d=h=>{l(h),x(!0)},m=(h,v)=>{c.current.scrollIntoView(),g(v),l(h),r(!0)};return e.jsxs("main",{className:"animate-fadeIn grid py-8 px-4 gap-8 ",ref:c,children:[e.jsx(K,{}),f&&e.jsx(O,{observaciones:u.nombre,cerrarFormulario:()=>x(!1)}),p&&!f&&e.jsx(H,{setOpenInfo:r,imgSrc:b,servicio:u,reservar:d}),e.jsx("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 max-w-5xl mx-auto gap-8",children:o instanceof Array&&!f&&!p&&o.map(h=>h.nombre!=="admin"&&e.jsx(L,{servicio:h,abrirMasInfo:m,reservar:d,setServicio:l},h._id))})]})}export{ce as default};
