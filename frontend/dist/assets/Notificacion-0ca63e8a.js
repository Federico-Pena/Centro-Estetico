import{r as t,M as J,U as _,j as e,B as w}from"./index-9b0ccc10.js";import{a as q,f as L,d as ee,H as ae,L as se}from"./FormularioReserva-777331ff.js";import{E as y,b as P,H as Y,a as te}from"./apiConfig-6444a406.js";import{T as K,f as B}from"./TransitionNumber-9cc045e6.js";import{B as ne}from"./BotonPrimario-010807d4.js";const oe=(s,r,i)=>{if(s.target.className.includes(y.pendiente)||s.target.className.includes(y.pago))return!1;const l=s.target.textContent,n=r+" "+l,a=new Date(n);a.setMinutes(a.getMinutes()+30);const c=q(a);return!i.filter(x=>x.fecha===new Date(r).toISOString()&&(x.hora.includes(c)||x.horaFin.includes(c))).find(x=>x.estado===y.pago||x.estado===y.pendiente)};function V(s,r){if(s&&r){const i=s.fecha.split("T")[0],l=r.fecha.split("T")[0],n=new Date(`${i}T${s.hora}`),a=new Date(`${l}T${r.hora}`);return n>a?-1:n<a?1:0}}const Q=s=>{const[r,i]=t.useState([]),[l,n]=t.useState(null),[a,c]=t.useState(!1),[d,b]=t.useState([]),[x,S]=t.useState(1),[T,C]=t.useState(1),{setMensaje:g}=t.useContext(J),{accessToken:p}=t.useContext(_);t.useEffect(()=>{x&&(async()=>{c(!0);const m={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}},v=`${P.paciente.nombres}/${x}`,h=await fetch(v,m),{pacientes:j,page:$,totalPages:k}=await h.json();C(k),S($),j.length?b(j.sort((O,z)=>O.nombre.toLowerCase()<z.nombre.toLowerCase()?-1:1)):b([]),c(!1)})()},[p,x]),t.useEffect(()=>{const o={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}};s&&(async()=>{c(!0);const v=`${P.reservas.deUnPaciente}${s}`;try{const h=await fetch(v,o);if(h.ok){const j=await h.json();i(j.sort(V))}}catch(h){console.log(h)}c(!1)})()},[p,s]);const M={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}};return{setPaciente:n,agregarPaciente:o=>{if(o.error){g(o.mensaje);return}o.totalReservas=0,b([...d,o].sort((v,h)=>v.nombre.toLowerCase()<h.nombre.toLowerCase()?-1:1));const m=`Paciente nuevo ${o.nombre}.`;g(m)},getPaciente:async o=>{if(n(null),c(!0),o){const m=d.find($=>$.nombre===o),v=`${P.paciente.porId}${m._id}`,j=await(await fetch(v,M)).json();n(j)}else n(null);c(!1)},eliminarPaciente:o=>{const{mensaje:m,userExistente:v}=o;g(m),console.log(o);const h=d.filter(j=>j._id!==v._id).sort((j,$)=>j.nombre.toLowerCase()<$.nombre.toLowerCase()?-1:1);b(h)},actualizarReservaPaciente:o=>{const{reserva:m}=o,v=`Reserva nueva de ${m.pacienteNombre}. El dia ${L({fecha:m.fecha.split("T")[0]})} a las ${m.hora}`,h=r.filter(j=>j._id!==m._id);g(v),i(h.concat(m).sort(V))},eliminarReservaPaciente:o=>{const{reserva:m}=o,v=r.filter(j=>j._id!==m._id),h=`Reserva eliminada de ${m.pacienteNombre}. El dia ${L({fecha:m.fecha.split("T")[0]})} a las ${m.hora}`;g(h),i(v.sort(V))},reservasPaciente:r,nombres:d,paciente:l,loading:a,setNombres:b,editarPaciente:o=>{const m=d.find($=>$._id===o._id),v={_id:o._id,nombre:o.nombre,foto:{secure_url:o.foto.secure_url},totalReservas:m.totalReservas},h=d.filter($=>$._id!==o._id);console.log(o),console.log(h),b([...h,v].sort(($,k)=>$.nombre.toLowerCase()<k.nombre.toLowerCase()?-1:1));const j=`Paciente nuevo ${o.nombre}.`;g(j),n(null)},setReservasPaciente:i,pagina:x,setPagina:S,totalPaginas:T}};const re=({nombres:s,onChangeNombre:r,setPagina:i,pagina:l})=>{const{totalPaginas:n}=Q();return e.jsxs("div",{className:"selectNombre-container",children:[e.jsxs("div",{className:"encabezado",children:[e.jsxs("strong",{children:["Páginas:"," ",e.jsx(K,{from:0,to:n,duration:1e3})]}),e.jsxs("strong",{children:["Página actual:"," ",e.jsx(K,{from:1,to:l,duration:200})]})]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsx(w,{tipo:"button",className:"pagination-buttons-Anterior",texto:"Pág anterior",onClickFunction:()=>l>1&&i(l-1)}),e.jsx(w,{tipo:"button",className:"pagination-buttons-Siguiente",onClickFunction:()=>l!==n&&i(l+1),texto:"Siguiente pág"})]}),s.length>0&&s.map((a,c)=>e.jsxs("div",{className:a.nombre==="admin"||a.pacienteNombre==="admin"?"selectNombre-option admin":"selectNombre-option",onClick:()=>r(a.nombre||a.pacienteNombre),children:[e.jsx("img",{src:a.foto.secure_url,alt:a.nombre||a.pacienteNombre,className:"imagen"}),e.jsx("span",{className:"nombre",children:a.nombre||a.pacienteNombre}),e.jsxs("span",{className:"numero",children:["Numero de reservas: ",a.totalReservas]})]},c))]})},ie=re,ce=({reserva:s,setForm:r,editar:i,actualizarReserva:l})=>{const[n,a]=t.useState(s.fecha||Y.split("T")[0]),[c,d]=t.useState([]),[b,x]=t.useState(s.motivo),[S,T]=t.useState(s.observaciones),[C,g]=t.useState(s.hora||""),[p,M]=t.useState(s.pacienteNombre),[f,F]=t.useState(!1),[H,U]=t.useState([]),D=t.useRef(),{setMensaje:A}=t.useContext(J),{accessToken:o}=t.useContext(_),{nombres:m,pagina:v,setPagina:h,totalPacientes:j,totalPaginas:$}=Q(),k=()=>{D.current.parentElement.classList.add("animationOut"),setTimeout(()=>{r()},300)};t.useEffect(()=>{D.current.scrollIntoView({behavior:"smooth",block:"start"}),n&&(async()=>{const u=await fetch(`${P.reservas.deUnDia}${n}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o||""}`}}),{data:R}=await u.json();d(R)})()},[n,o,s]),t.useEffect(()=>{const u=ee(n,c).find(R=>R.dia.getDay()===new Date(`${n} ${C}`).getDay());U(u==null?void 0:u.horaID)},[n,c,C]);const O=N=>{g(N.target.textContent),oe(N,n,c)||(A("Hora no disponible para hacer una reserva"),g(""))},z=async N=>{N.preventDefault(),F(!0);const u=D.current,R=new Date(`${u.fecha.value.split("T")[0]} ${C}`);R.setMinutes(R.getMinutes()+30);const E={pacienteNombre:u.pacienteNombre.value,fecha:u.fecha.value,hora:C,horaFin:q(R),motivo:u.motivo?u.motivo.value:void 0,observaciones:u.observaciones.value};if(E.pacienteNombre.trim()&&E.hora&&E.fecha){const I={method:"POST",body:JSON.stringify(E),headers:{"Content-Type":"application/json",authorization:`Bearer ${o}`}};await B(`${P.reservas.agregar}`,I,l),u.classList.add("formOut"),r()}else A("Faltan campos");F(!1)},W=async N=>{N.preventDefault(),F(!0);const u=D.current,R=new Date(`${u.fecha.value.split("T")[0]} ${C}`);R.setMinutes(R.getMinutes()+30);const E={_id:s._id,pacienteNombre:u.pacienteNombre.value,fecha:u.fecha.value,hora:C,horaFin:q(R),motivo:u.motivo?u.motivo.value:void 0,observaciones:u.observaciones.value};if(E.pacienteNombre.trim()&&E.hora&&E.fecha){const I=`${P.reservas.editar}${E._id}`,Z={method:"PUT",body:JSON.stringify(E),headers:{"Content-Type":"application/json",authorization:`Bearer ${o}`}};await B(I,Z,l),r()}else A("Faltan campos");F(!1)},X=N=>{M(N)};return e.jsxs("section",{className:"formReservaContainer",children:[e.jsx(w,{className:"cerrarForm",texto:"Cerrar Formulario",onClickFunction:k,tipo:"button"}),e.jsxs("form",{onSubmit:i?W:z,className:"formReserva",ref:D,children:[e.jsx("h3",{children:"Reserva"}),!p=="admin"||!s.pacienteNombre&&e.jsx(ie,{totalPacientes:j,totalPaginas:$,nombres:m,pagina:v,setPagina:h,onChangeNombre:X}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"pacienteNombre",children:"Nombre"}),e.jsx("input",{id:"pacienteNombre",type:"text",name:"pacienteNombre",defaultValue:p,disabled:!!p,required:!0})]}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"fecha",children:"Fecha"}),e.jsx("input",{id:"fecha",type:"date",name:"fecha",required:!0,disabled:!(p==="admin"||s.pacienteNombre),defaultValue:s.fecha||Y.split("T")[0],onChange:N=>{const u=N.target.value.split("T")[0];a(u)}})]}),(H==null?void 0:H.length)>0&&e.jsx("div",{className:"input",children:e.jsx(ae,{horas:H,onClickReservar:O})}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"observaciones",children:p==="admin"?"Tareas. Separadas por comas":"Observaciones"}),e.jsx("input",{defaultValue:s.observaciones,id:"observaciones",type:"text",name:"observaciones",onChange:N=>T(N.target.value)})]}),p==="admin"?null:e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"motivo",children:"Motivo"}),e.jsxs("select",{name:"motivo",onChange:N=>x(N.target.value),children:[e.jsx("option",{defaultValue:s.motivo,children:s.motivo?s.motivo:""}),e.jsx("option",{value:"Drenaje Linfático",children:"Drenaje Linfático"}),e.jsx("option",{value:"Masaje Estético",children:"Masaje Estético"}),e.jsx("option",{value:"Exfoliación Corporal",children:"Exfoliación Corporal"}),e.jsx("option",{value:"Masaje Cérvico-Craneal",children:"Masaje Cérvico-Craneal"}),e.jsx("option",{value:"Masaje Con Piedras Calientes",children:"Masaje Con Piedras Calientes"}),e.jsx("option",{value:"Masaje Descontracturante",children:"Masaje Descontracturante"}),e.jsx("option",{value:"Masaje Relajante",children:"Masaje Relajante"}),e.jsx("option",{value:"Masaje Prenatal",children:"Masaje Prenatal"}),e.jsx("option",{value:"Barras De access",children:"Barras De Access"})]})]}),e.jsxs("div",{className:"input",children:[p&&e.jsxs("span",{className:"spanHora",children:["Nombre ",e.jsx("strong",{children:p})]}),n&&e.jsxs("span",{className:"spanHora",children:["Dia ",e.jsx("strong",{children:L({fecha:n})})]}),C&&e.jsxs("span",{className:"spanHora",children:["Hora ",e.jsx("strong",{children:C})]}),S&&e.jsxs("span",{className:"spanHora",children:["Observaciones",e.jsx("strong",{children:S})]}),b&&e.jsxs("span",{className:"spanHora",children:["Motivo ",e.jsx("strong",{children:b})]})]}),e.jsx(ne,{tipo:"submit",className:"submitAdmin",texto:f?e.jsx(se,{}):"Guardar"})]})]})};const le=({titulo:s,mensaje:r,onConfirm:i,onCancel:l})=>{const n=t.useRef();return t.useEffect(()=>{n.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",ref:n,children:[e.jsx("h3",{children:s}),e.jsx("p",{children:r}),e.jsxs("div",{children:[e.jsx("button",{onClick:i,children:"Confirmar"}),e.jsx("button",{onClick:l,children:"Cancelar"})]})]})})},G=[y.pendiente,y.cancelada,y.pago];function de(s){const r=G.indexOf(s);if(r!==-1){const i=(r+1)%G.length;return G[i]}else return}const me=({actualizarReserva:s,reserva:r,cerrarReserva:i,setForm:l,setModal:n})=>{const[a,c]=t.useState(r),d=t.useRef(),{accessToken:b}=t.useContext(_),{setMensaje:x}=t.useContext(J),S=async()=>{const g=de(a.estado),p=`${P.reservas.editarEstado}${a._id}`,M={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${b}`},body:JSON.stringify({estado:g})};await B(p,M,f=>{s(f),c(f.reserva),x(f.mensaje)})},T=()=>{i(d)},C=()=>{l(a)};return e.jsx(e.Fragment,{children:e.jsxs("article",{className:"containerReserva",ref:d,children:[e.jsx("div",{className:`reserva-container-titulo  ${a.estado}`,children:e.jsx("h3",{children:"Detalles de la reserva"})}),e.jsxs("div",{className:`reserva-container-cuerpo  ${a.estado}`,children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Paciente: ",e.jsx("strong",{children:a.pacienteNombre})]}),e.jsxs("li",{children:["Fecha:",e.jsx("strong",{children:L(a)})]}),e.jsxs("li",{children:["Hora: ",e.jsx("strong",{children:a.hora})]}),a.pacienteNombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Motivo: ",e.jsx("strong",{children:a.motivo})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("strong",{children:a.observaciones})]}),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:a.estado})]})]})]}),a.pacienteNombre==="admin"&&e.jsxs("ul",{className:"tareasAdmin",children:[e.jsx("li",{children:"Lista:"}),a.observaciones.split(",").map(g=>e.jsx("li",{className:"liTarea",children:e.jsx("span",{children:g})},g)),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:a.estado})]})]})]}),e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(w,{texto:"Editar",className:"btnEditar",onClickFunction:C}),e.jsx(w,{texto:"Cambiar Estado",className:`btnCompletada ${a.estado}`,onClickFunction:S})]}),i?e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(w,{texto:"Cerrar",className:"btnCerrarReserva",onClickFunction:T,tipo:"button"}),e.jsx(w,{texto:"Eliminar",className:"btnCerrar Cancelada",onClickFunction:()=>n(a)})]}):e.jsx("div",{className:"reserva-container-botones",children:e.jsx(w,{texto:"Eliminar",className:"btnCerrar",onClickFunction:()=>n(a)})})]})})};const ve=({reservas:s,actualizarReservas:r,actualizarReservaEliminada:i,cerrarReserva:l,className:n})=>{const[a,c]=t.useState(!1),[d,b]=t.useState(!1),[x,S]=t.useState(!1),{accessToken:T}=t.useContext(_),C=f=>{c(!0),b(f)},g=async()=>{const f=`${P.reservas.eliminar}${d._id}`,F={method:"DELETE",headers:{authorization:`Bearer ${T}`}};await B(f,F,i),S(!1)},p=()=>{S(!1)},M=f=>{console.log(f),b(f),S(!0)};return a?e.jsx(ce,{editar:!0,reserva:{...d,fecha:d.fecha.split("T")[0],nombre:d.pacienteNombre},actualizarReserva:f=>{b(f.reserva),r(f)},setForm:()=>{c(!1)}}):x?e.jsx(le,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${d.pacienteNombre} el dia ${L(d)} a las ${d.hora}?`,onConfirm:g,onCancel:p}):e.jsx("section",{className:`ContenedorReservas ${n||""}`,children:(s==null?void 0:s.length)>0&&s.map(f=>e.jsx(me,{setModal:M,setForm:C,cerrarReserva:l,actualizarReservaEliminada:i,actualizarReserva:r,reserva:f},f._id))})},ue=()=>{const[s,r]=t.useState([]),{accessToken:i}=t.useContext(_);return t.useEffect(()=>{i&&(async()=>{let n=te.toISOString().split("T")[0];const a={headers:{"Content-Type":"application/json",Authorization:`Bearer ${i||""}`}};try{const c=`${P.publicas.fechasHorasReservadasDeLaSemana}${n}`;await B(c,a,d=>{r(d.reservas)})}catch(c){console.log(c)}})()},[i]),{reservasSemanales:s}},be=()=>{const{isAllowedAccess:s}=t.useContext(_),{reservasSemanales:r}=ue();return t.useEffect(()=>{"Notification"in window&&s&&r.forEach(i=>{const l=new Date(`${i.fecha.split("T")[0]} ${i.hora}`),a=(l-new Date)/(24*60*60*1e3),c={body:"Mensaje de Prueba",icon:"/assets/icons/icon-192.png",vibrate:[200,100,200],tag:"notificacion"};a===1&&setTimeout(()=>{new Notification("Recordatorio",c).addEventListener("click",()=>{window.location.href="https://www.masajistanataliapena.com/#/calendario"})},l-new Date)})},[s]),null};export{ve as C,ce as F,be as N,ie as S,le as a,oe as c,V as o,Q as u};
