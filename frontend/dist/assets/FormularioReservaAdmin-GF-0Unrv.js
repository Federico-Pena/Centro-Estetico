import{j as o,E as h,k as _,a as L,u as q,R as S,l as k}from"./index-YAdz76Jm.js";import{u as O}from"./useForm-kpLBmbY3.js";import{B as C}from"./Button-qbGwCLcH.js";import{L as F}from"./LabelInput-iD2B8GI7.js";import{T as P}from"./TextAreaLabel-U7btEOxD.js";import{S as v}from"./SelectServicio-mph11qzB.js";import{f as z,u as B}from"./useReservasContext-D-al89pr.js";import{u as U}from"./useFormReserva-vENUwRLe.js";import{c as G}from"./compararFechas-sMQnMgQ2.js";import{f as M}from"./formatHoraUser-TJ92Iw1g.js";import{D as J}from"./Dropdown-UufBkZzb.js";import{u as K}from"./useLoaderContext-_SMLR0xo.js";import"./getServiciosNombresYTratamientos-ybwHkVIj.js";const Q=({values:e})=>{const s=new Date(e.horaInicio).getDay()===6;return o.jsxs("ul",{className:"grid gap-2 border-t border-b border-slate-500 py-4",children:[o.jsx("li",{className:"text-color-violeta text-xl text-center mb-4",children:"Resumen de la reserva"}),e.nombre&&o.jsxs("li",{className:"capitalize grid gap-4 grid-cols-[1fr_2fr] bg-white p-4 rounded-lg text-color-violeta",children:["Nombre ",o.jsx("strong",{className:"text-end",children:e.nombre})]}),e.horaInicio&&!s&&o.jsxs("li",{className:"capitalize grid gap-4 grid-cols-[1fr_2fr] bg-white p-4 rounded-lg text-color-violeta",children:["Dia",o.jsx("strong",{className:"text-end",children:z(new Date(`${e.horaInicio} 00:00:00`))})]}),e.hora&&o.jsxs("li",{className:"grid gap-4 grid-cols-[1fr_2fr] bg-white p-4 rounded-lg text-color-violeta",children:["Hora ",o.jsx("strong",{className:"text-end",children:e.hora})]}),e.observaciones&&o.jsxs("li",{className:"grid grid-cols-[1fr_2fr] gap-4 bg-white p-4 rounded-lg text-color-violeta",children:["Observaciones",o.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:e.observaciones})]}),e.servicio&&o.jsxs("li",{className:"grid gap-4 grid-cols-[1fr_2fr] bg-white p-4 rounded-lg text-color-violeta",children:["Servicio",o.jsx("strong",{className:"capitalize text-end text-nowrap overflow-auto",children:e.servicio})]}),e.tratamiento&&o.jsxs("li",{className:"grid gap-4 grid-cols-[1fr_2fr] bg-white p-4 rounded-lg text-color-violeta ",children:["Tratamiento",o.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:e.tratamiento})]})]})},W=({horasDisponibles:e,values:s,reservasDelDia:i,handleChange:t,setMensaje:l,errors:d})=>{const m=n=>{const c=n.target.textContent,r=G(new Date(`${s.horaInicio} ${c}`),i);if(r.estado&&r.estado!==h.cancelada||r.proximaHoraNoDisponible){l("Hora no disponible para hacer una reserva");return}else t({target:{name:"hora",value:c}})};return o.jsxs(o.Fragment,{children:[o.jsxs("ul",{className:"grid gap-4 grid-cols-5",children:[o.jsx("li",{className:"col-span-full",children:"Hora"}),e.map(n=>o.jsx("li",{className:`${n.estado} p-2 rounded-xl w-full grid place-content-center shadow-md max-w-20 transition-[max-width] ${X(n,s)} `,onClick:m,children:n.id.split("T")[1]},n.id))]}),d.hora&&o.jsxs("small",{className:"text-red-600",children:["* ",d.hora]}),o.jsxs("ul",{className:"grid grid-flow-col grid-rows-3 gap-4 border border-slate-500 p-4 rounded-lg",children:[o.jsx("li",{className:"col-span-full opacity-50 p-2 rounded-xl w-full grid place-content-center shadow-md m-auto",children:"No disponible"}),o.jsx("li",{className:"p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50",children:"Disponible"}),o.jsx("li",{className:`${h.pago} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Paga"}),o.jsx("li",{className:`${h.pendiente} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Pendiente"}),o.jsx("li",{className:`${h.cancelada} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Cancelada"})]})]})},X=(e,s)=>{const i=e.proximaHoraNoDisponible,t=e.estado,l=e.id.split("T")[1]===s.hora,d=t&&t===h.cancelada,m=t&&(t===h.pago||t===h.pendiente);return[!i&&!l&&!m&&"bg-slate-50 cursor-pointer",m&&"cursor-not-allowed text-white",d&&"text-white",i&&!m&&"opacity-50 cursor-not-allowed",l&&"bg-color-violeta col-span-full row-start-2 text-white max-w-xl font-bold opacity-100 cursor-default"].filter(Boolean).join(" ")},Y=e=>({pacienteNombre:e.nombre,fecha:new Date(`${e.horaInicio} ${e.hora}:00`),observaciones:e.observaciones,servicio:e.servicio,tratamiento:e.tratamiento,estado:e.estado||""}),Z={nombre:{required:!0},horaInicio:{required:!0},servicio:{required:!0},tratamiento:{required:!0},hora:{required:!0}},ee=(e,s,i)=>{var n,c,r,a,p,g;const t=((n=e==null?void 0:e.tratamiento)==null?void 0:n.descripcion)||"",l=(c=e==null?void 0:e.tratamiento)==null?void 0:c.sesiones;let d="";return t&&l!==void 0&&(d=`${t} - ${l} ${l>1?"Sesiones":"Sesión"}`),{nombre:((r=e==null?void 0:e.paciente)==null?void 0:r.nombre)||"",horaInicio:((a=e==null?void 0:e.horario)==null?void 0:a.horaInicio.split("T")[0])||"",hora:(s||i)&&M((p=e==null?void 0:e.horario)==null?void 0:p.horaInicio)||"",observaciones:(e==null?void 0:e.observaciones)||"",servicio:((g=e==null?void 0:e.servicio)==null?void 0:g.nombre)||"",tratamiento:d||"",estado:(e==null?void 0:e.estado)||""}},ge=()=>{var j,D;const e=_(),s=L(),i=(j=e.state)==null?void 0:j.reserva,{setMensaje:t}=q(),{reserva:l,dispatch:d}=B(),{loading:m}=K(),n=e.pathname===S.admin.agregarReserva&&((D=e.state)==null?void 0:D.from)===S.admin.calendario,c=i.estado,{handleChange:r,values:a,errors:p,validateForm:g,resetForm:R}=O(ee(l||i,c,n),Z),{horasDisponibles:f,reservasDelDia:I,agregarReserva:T,editarReserva:y,pacientesNombres:$}=U(a.horaInicio),w=new Date(a.horaInicio).getDay()===6,A=x=>{r({target:{name:"hora",value:""}}),r(x)},E=async x=>{if(x.preventDefault(),g()&&!w){const b=Y(a);(c?await y(b,i._id):await T(b))?N():t("Ocurrió un guardar la reserva.")}else t("Faltan campos requeridos.")},N=()=>{R(),d({type:k.SET_RESERVA,payload:null}),s(-1)},H=x=>{const b={target:{name:"nombre",value:x.target.textContent}};r(b)},V=x=>x.map(u=>u.nombre);return o.jsxs("section",{className:"grid px-4 py-8",children:[o.jsxs("h1",{className:"font-betonga font-bold text-color-violeta text-2xl tracking-wider text-center mb-4",children:[c?"Editar":"Crear"," Reserva"]}),o.jsxs("form",{className:"animate-fadeIn rounded-lg p-4 max-w-xl m-auto w-full grid gap-4 bg-color-verde-blanco border border-gray-300 shadow-lg",onSubmit:E,children:[!c&&o.jsx(J,{name:"Pacientes existentes",onClickFunction:H,list:V($)}),o.jsx(F,{placeholder:"Nombre",value:a.nombre,labelText:"Nombre",name:"nombre",type:"text",errors:p,onChange:r}),o.jsx(F,{className:"w-full",value:a.horaInicio.split("T")[0],labelText:"Fecha",name:"horaInicio",type:"date",errors:p,onChange:A}),w?o.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los días domingos no se realizan reservas"}):null,f.length>0&&a.horaInicio&&o.jsx(o.Fragment,{children:o.jsx(W,{horasDisponibles:f,values:a,setMensaje:t,handleChange:r,reservasDelDia:I,errors:p})}),o.jsx("label",{children:"Servicio y Tratamiento"}),o.jsx(v,{values:a,handleChange:r,errors:p}),o.jsx(P,{value:a.observaciones,onChange:r,name:"observaciones",labelText:a.nombre==="admin"?"Compromisos separados por comas":"Observaciones"}),o.jsx(Q,{values:a}),o.jsxs("footer",{className:"grid grid-flow-col gap-4",children:[o.jsx(C,{bgColor:!0,className:"w-full",tipo:"submit",texto:"Guardar",disabled:m}),o.jsx(C,{className:"w-full",tipo:"button",onClickFunction:N,texto:"Cerrar"})]})]})]})};export{ge as default};
