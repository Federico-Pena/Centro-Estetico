import{j as e,e as R,i as T,h as E,R as j,r as l,k as y,B as m,m as x,f as v,a as w,E as g,U as _,T as $,u as F}from"./index-GYJrmH-P.js";import{C as I}from"./ConfirmationModal-8KHYrsSG.js";import{f as C}from"./formatHoraUser-TJ92Iw1g.js";const O=({reserva:s})=>{var a,o,t;return e.jsxs("ul",{className:"grid [&>li]:p-4 [&>li]:grid [&>li]:grid-flow-col [&>li]:grid-cols-[1fr_2fr] [&>li]:justify-between [&>li>span]:text-end",children:[e.jsxs("li",{children:["Fecha:",e.jsx("span",{children:R(s.horario.horaInicio)})]}),e.jsxs("li",{children:["Hora: ",e.jsx("span",{children:C(new Date(s.horario.horaInicio))})]}),s.paciente.nombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"capitalize",children:["Servicio: ",e.jsx("span",{children:((a=s.servicio)==null?void 0:a.nombre)||"-"})]}),e.jsxs("li",{children:["Tratamiento:",e.jsx("span",{children:((o=s.tratamiento)==null?void 0:o.descripcion)||"-"})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("span",{children:s.observaciones||"-"})]}),e.jsxs("li",{children:["Valor:",e.jsxs("span",{children:["$ ",(t=s.tratamiento)==null?void 0:t.costoPorSesion]})]})]})]})},V=({reserva:s})=>s.paciente.nombre==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"p-4 border-t",children:"Compromisos:"}),e.jsx("ul",{className:"px-6 pb-4 gap-4 grid list-decimal list-inside",children:s.observaciones.split(",").map(a=>e.jsx("li",{className:"",children:e.jsx("span",{children:a})},a))})]}),k=({reserva:s,handleEditarEstadoReserva:a,handleEliminarReserva:o,loading:t,contenedorRef:n})=>{const r=T(),d=E().pathname===j.admin.calendario,{dispatch:i}=l.useContext(y),p=()=>{i({type:x.SET_RESERVA,payload:s}),r(j.admin.editarReserva)},c=()=>{n.current.classList.replace("animate-growIn","animate-growOut"),setTimeout(()=>{i({type:x.SET_RESERVAS_SELECCIONADAS,payload:[]})},500)};return e.jsxs(e.Fragment,{children:[e.jsx(m,{texto:"Editar",tipo:"button",className:"border border-color-violeta bg-color-violeta  flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity ",onClickFunction:p}),e.jsx(m,{disabled:t,texto:"Estado",tipo:"button",className:`border border-color-violeta bg-color-violeta flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity  ${s.estado}`,onClickFunction:a}),d&&e.jsx(m,{texto:"Cerrar",className:"border border-color-violeta bg-color-violeta  flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity",onClickFunction:c,tipo:"button"}),e.jsx(m,{texto:"Eliminar",tipo:"button",className:"border border-color-violeta flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity bg-red-600 text-white",onClickFunction:o})]})},D=async(s,a)=>{const o=`${w.reservas.deleteReserva}${a}`,t={method:"DELETE",headers:{Authorization:`Bearer ${s||""}`}};return await v(o,t)},b=[g.pendiente,g.pago,g.cancelada];function U(s){const a=b.indexOf(s);if(a!==-1){const o=(a+1)%b.length;return b[o]}else return}const z=async(s,a)=>{const o=U(a.estado),t=`${w.reservas.putEstadoReserva}${a._id}`,n={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${s}`},body:JSON.stringify({estado:o})};return await v(t,n)},B=()=>{const[s,a]=l.useState(!1),{accessToken:o}=l.useContext(_),{setMensaje:t}=l.useContext($),{dispatch:n}=l.useContext(y);return{borrarReserva:async d=>{a(!0);const i=await D(o,d._id),{status:p,error:c,mensaje:u}=i;p===200?(t(u),n({type:x.DELETE_RESERVA,payload:d})):t(c||"Ocurrió un error al eliminar el paciente"),a(!1)},loading:s,cambiarEstadoReserva:async d=>{a(!0);const i=await z(o,d),{status:p,datos:c,error:u,mensaje:h}=i;if(p===200)return t(h),n({type:x.SET_RESERVA_NUEVA,payload:c}),a(!1),c;u?(t(u),a(!1)):(t("Error al actualizar el estado"),a(!1))}}},L=({datos:s,contenedorRef:a})=>{const{loading:o,borrarReserva:t,cambiarEstadoReserva:n}=B(),[r,f]=l.useState(s),[d,i]=l.useState(!1),p=l.useRef(),{isVisible:c}=F(p),u=async()=>{await t(r),i(!1)},h=()=>{i(!0)},S=async()=>{const A=await n(r);f(A)},N={Pago:"bg-color-paga text-white",Cancelada:"bg-color-cancelada text-white",Pendiente:"bg-color-pendiente text-white"}[r.estado]||"";return e.jsxs(e.Fragment,{children:[d&&e.jsx(I,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${r.paciente.nombre} el dia ${R(r.horario.horaInicio)} a las ${C(new Date(r.horario.horaInicio))}?`,onConfirm:u,onCancel:()=>i(!1)}),e.jsxs("article",{className:`${c?"animate-toastIn":""} border border-slate-500 grid grid-rows-[40px_1fr_130px] rounded-lg max-w-96 w-full m-auto overflow-auto snap-center min-w-80 ${N}`,ref:p,children:[e.jsx("h3",{className:"font-betonga font-bold text-xl capitalize grid place-content-center tracking-wider",children:r.paciente.nombre}),e.jsxs("section",{className:"grid border-t border-b border-slate-50",children:[e.jsx(O,{reserva:r}),e.jsx(V,{reserva:r})]}),e.jsx("section",{className:"grid gap-4 p-4 grid-cols-2 justify-evenly bg-white",children:e.jsx(k,{contenedorRef:a,reserva:r,handleEditarEstadoReserva:S,handleEliminarReserva:h,loading:o})})]})]})},J=({reservas:s})=>{const a=E(),o=l.useRef(),t=a.pathname===j.admin.calendario;return e.jsx("section",{className:`${t?"animate-growIn fixed inset-0 z-30 m-0 p-4 bg-white bg-opacity-30 backdrop-blur-sm flex gap-4 justify-start overflow-x-auto snap-x snap-proximity scroll-smooth":"grid gap-4 m-auto w-full max-w-5xl md:grid-cols-2 xl:grid-cols-3"} `,ref:o,children:s.length>0?s.map(n=>e.jsx(L,{datos:n,contenedorRef:o},n._id)):e.jsx("h2",{className:"text-xl text-center col-span-full",children:"No hay reservas"})})};export{J as C};
