import{r,M as y,U as B,j as a,a as G,B as j}from"./index-0a369e23.js";import{C as U,F as P,e as Y,o as N}from"./ContenedorReservas-a6771d0c.js";import{d as Z,f as F,L as I,c as V}from"./diasSemanaConHoras-804ec44b.js";import{D as T,a as q,H as E,b as _,E as v,f as w}from"./constantes-122ae6b5.js";import{C as J}from"./ContadorReservas-1c60c8be.js";import{f as K}from"./fetchData-26851f92.js";import"./BotonPrimario-025232f1.js";import"./TransitionNumber-93bf79e7.js";const Q=R=>{const[D,m]=r.useState(!1),[u,h]=r.useState(R),[f,x]=r.useState([]),{setMensaje:p}=r.useContext(y),n=Z(u),{accessToken:c}=r.useContext(B);return r.useEffect(()=>{u&&(async()=>{m(!0);const g={headers:{"Content-Type":"application/json",Authorization:`Bearer ${c||""}`}},l=`${q.reservas.deLaSemana}${u}`;await K(l,g,S=>{if(S.error){p(S.error);return}else x(S.reservas)}),m(!1)})()},[c,p,u]),{reservasSemanales:f,loading:D,diasSemana:n,semanaAnterior:()=>{m(!0);const o=new Date(`${u} 00:00:00.000Z`);o.setDate(o.getDate()-T),h(o.toISOString().split("T")[0]),m(!1)},semanaSiguiente:()=>{m(!0);const o=new Date(`${u} 00:00:00.000Z`);o.setDate(o.getDate()+T),h(o.toISOString().split("T")[0]),m(!1)},setReservasSemanales:x}};function oe(){const[R,D]=r.useState(E.split("T")[0]),[m,u]=r.useState(E.split("T")[1]),[h,f]=r.useState(!1),[x,p]=r.useState(""),[n,c]=r.useState([]),{setMensaje:C}=r.useContext(y),{loading:H}=r.useContext(B),{semanaAnterior:o,semanaSiguiente:g,reservasSemanales:l,setReservasSemanales:S,loading:b,diasSemana:O}=Q(R),$=e=>{if(e){f(!1);const t=l.filter(s=>s._id!==e._id),i=n.filter(s=>s._id!==e._id);c([...i,e]),S([...t,e])}},L=e=>{c([]),p("");const t=e.target.getAttribute("data-fecha"),i=new Date(t).toISOString(),[s]=i.split("T");D(s),u(i);const d=V(new Date(t),l);if(e.target.className.includes("paraReservaAdmin")&&p("admin"),d.estado){c(d.reservadas),d.estado===v.cancelada&&f(!0);return}if(d.proximaHoraNoDisponible)d.proximaHoraNoDisponible===v.cancelada?f(!0):C("Hora no disponible para reservar");else{f(!0);return}},k=e=>{e.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{e.current.parentElement.remove("animationReservaOut"),c([])},500)},z=e=>{const{reserva:t}=e;if(t){const i=`Reserva borrada de ${t.pacienteNombre} el dia ${F({fecha:t.horario.horaInicio})} a las  ${w(new Date(t.horario.horaInicio))}`;C(i);const s=l.filter(d=>d._id!==t._id);S(s.sort(N)),c([])}},M=e=>{if(e==="Toda")c(l.sort(N));else{const t=l.filter(i=>i.estado===e);c(t.sort(N))}};return a.jsxs(a.Fragment,{children:[H&&a.jsx(G,{}),(n==null?void 0:n.length)>0?a.jsx("div",{className:n.length?"divReservaCalendario":"",children:a.jsx(U,{cerrarReserva:k,reservas:n,actualizarReservaEliminada:z,actualizarReservas:e=>{$(e)}})}):null,h&&(n==null?void 0:n.length)===0&&a.jsx(P,{reserva:{pacienteNombre:x,fecha:m},actualizarReserva:e=>{$(e)},setForm:()=>{f(!1)}}),a.jsx("main",{className:"containerCalendario",children:a.jsxs(a.Fragment,{children:[a.jsx(J,{reservas:l,mostrarReservadas:M}),a.jsxs("h1",{children:["Hoy ",F({fecha:E})]}),a.jsxs("div",{className:"containerBotones",children:[a.jsx(j,{onClickFunction:o,texto:"Anterior"}),b&&a.jsx(I,{}),a.jsx(j,{onClickFunction:g,texto:"Siguiente"})]}),a.jsx("div",{className:"containerFechas",children:O.map(e=>e.dia.getDay()!==0&&a.jsxs("div",{className:"dias",children:[a.jsx("h3",{className:`${e.dia.getDate()===_.getDate()&&e.dia.getDay()===_.getDay()?"esHoy":""}`,children:F({fecha:e.dia})}),a.jsx("ul",{className:"HorasCalendario",children:e.horas.map((t,i)=>{const s=Y(l,O).find(A=>A.hora.toISOString()===t.toISOString()&&A.estado!==v.cancelada),d=i==0||i==1?`paraReservaAdmin ${(s==null?void 0:s.estado)||""}`:s&&s.nombreReserva==="admin"&&(s.estado===v.pago||s.estado===v.pendiente)?`paraReservaAdmin ${s.estado}`:s?`${s.estado}`:"";return a.jsx("li",{"data-fecha":t,onClick:L,className:d,children:w(t)},t.toISOString())})})]},e.dia))}),a.jsxs("div",{className:"containerBotonesAbajo",children:[a.jsx(j,{onClickFunction:o,texto:"Anterior"}),b&&a.jsx(I,{}),a.jsx(j,{onClickFunction:g,texto:"Siguiente"})]})]})})]})}export{oe as default};
