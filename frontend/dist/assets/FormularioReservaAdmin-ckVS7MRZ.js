import{j as o,e as H,E as c,g as V,h as k,i as q,R as b,r as u,T as _,k as L,l as O,b as P,m as z,B as S,D as B,c as F,S as U,d as G,n as M}from"./index-rKMOL2j9.js";import{f as J}from"./formatHoraUser-TJ92Iw1g.js";const K=({values:e})=>{const r=new Date(e.horaInicio).getDay()===6;return o.jsxs("ul",{className:"grid gap-2 border-t border-b border-slate-500 py-4",children:[o.jsx("li",{className:"text-color-violeta text-xl text-center mb-4",children:"Resumen de la reserva"}),e.nombre&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Nombre ",o.jsx("strong",{className:"text-end",children:e.nombre})]}),e.horaInicio&&!r&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Dia"," ",o.jsx("strong",{className:"text-end",children:H(new Date(`${e.horaInicio} 00:00:00`))})]}),e.hora&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Hora ",o.jsx("strong",{className:"text-end",children:e.hora})]}),e.observaciones&&o.jsxs("li",{className:"grid  gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Observaciones",o.jsx("strong",{className:"text-end",children:e.observaciones})]}),e.servicio&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Servicio",o.jsx("strong",{className:"capitalize text-end",children:e.servicio})]}),e.tratamiento&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta ",children:["Tratamiento",o.jsx("strong",{className:"text-end",children:e.tratamiento})]})]})},Q=({horasDisponibles:e,values:r,reservasDelDia:d,handleChange:s,setMensaje:a,errors:i})=>{const p=l=>{const m=l.target.textContent,n=V(new Date(`${r.horaInicio} ${m}`),d);if(n.estado&&n.estado!==c.cancelada||n.proximaHoraNoDisponible){a("Hora no disponible para hacer una reserva");return}else s({target:{name:"hora",value:m}})};return o.jsxs(o.Fragment,{children:[o.jsxs("ul",{className:"grid gap-4 grid-cols-5",children:[o.jsx("li",{className:"col-span-full",children:"Hora"}),e.map(l=>o.jsx("li",{className:`p-2 rounded-xl w-full grid place-content-center shadow-md max-w-20 transition-[max-width] ${W(l,r)}`,onClick:p,children:l.id.split("T")[1]},l.id))]}),i.hora&&o.jsxs("small",{className:"text-red-600",children:["* ",i.hora]}),o.jsxs("ul",{className:"grid grid-flow-col grid-rows-3 gap-4 border border-slate-500 p-4 rounded-lg",children:[o.jsx("li",{className:"col-span-full opacity-50 p-2 rounded-xl w-full grid place-content-center shadow-md m-auto",children:"No disponible"}),o.jsx("li",{className:"p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50",children:"Disponible"}),o.jsx("li",{className:`${c.pago} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Paga"}),o.jsx("li",{className:`${c.pendiente} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Pendiente"}),o.jsx("li",{className:`${c.cancelada} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Cancelada"})]})]})},W=(e,r)=>{const d=e.proximaHoraNoDisponible,s=e.id.split("T")[1]===r.hora,a=e.estado;return[d&&"opacity-50 cursor-not-allowed",(a===c.pago||a===c.pendiente)&&`${a} cursor-not-allowed text-white`,a===c.cancelada&&`${a} text-white`,s&&"bg-color-violeta col-span-full row-start-2 text-white max-w-xl font-bold opacity-100 cursor-default",!d&&!s&&(a!==c.pago||a!==c.pendiente)&&"bg-slate-50 cursor-pointer"].filter(Boolean).join(" ")},X=e=>({pacienteNombre:e.nombre,fecha:new Date(`${e.horaInicio} ${e.hora}`),observaciones:e.observaciones,servicio:e.servicio,tratamiento:e.tratamiento,estado:e.estado||""}),Y={nombre:{required:!0},horaInicio:{required:!0},servicio:{required:!0},tratamiento:{required:!0},hora:{required:!0}},Z=(e,r,d)=>{var a,i,p,l,m;return{nombre:((a=e==null?void 0:e.paciente)==null?void 0:a.nombre)||"",horaInicio:((i=e==null?void 0:e.horario)==null?void 0:i.horaInicio.split("T")[0])||"",hora:(r||d)&&J((p=e==null?void 0:e.horario)==null?void 0:p.horaInicio)||"",observaciones:(e==null?void 0:e.observaciones)||"",servicio:((l=e==null?void 0:e.servicio)==null?void 0:l.nombre)||"",tratamiento:((m=e==null?void 0:e.tratamiento)==null?void 0:m.descripcion)||"",estado:(e==null?void 0:e.estado)||""}},te=()=>{var C;const e=k(),r=q(),d=(C=e.state)==null?void 0:C.from,s=e.pathname===b.admin.editarReserva,a=e.pathname===b.admin.agregarReserva&&d===b.admin.calendario,{setMensaje:i}=u.useContext(_),{reserva:p,dispatch:l}=u.useContext(L),{loading:m}=u.useContext(O),{handleChange:n,values:t,errors:h,validateForm:v,resetForm:y}=P(Z(p,s,a),Y),{horasDisponibles:j,reservasDelDia:I,agregarReserva:T,editarReserva:E,pacientesNombres:N}=z(t.horaInicio),w=new Date(t.horaInicio).getDay()===6,A=x=>{n({target:{name:"hora",value:""}}),n(x)},$=async x=>{if(x.preventDefault(),v()&&!w){const g=X(t);(s?await E(g,p._id):await T(g))?f():i("Ocurrió un error al guardar el paciente.")}else i("Faltan campos requeridos.")},f=()=>{y(),l({type:M.SET_RESERVA,payload:null}),r(-1)},D=x=>{const g={target:{name:"nombre",value:x.target.textContent}};n(g)};return o.jsxs("section",{className:"grid grid-rows-[auto_1fr] gap-4 p-4",children:[o.jsx(S,{className:"border border-color-violeta bg-color-violeta text-white  flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity",tipo:"button",onClickFunction:f,texto:"Cerrar"}),o.jsxs("form",{className:"animate-toastIn bg-color-logo rounded-lg p-4 max-w-xl m-auto w-full grid gap-4 ",onSubmit:$,children:[o.jsxs("h2",{className:"font-betonga font-bold text-color-violeta text-2xl tracking-wider text-center mb-4",children:[s?"Editar":"Crear"," Reserva"]}),!s&&o.jsxs(B,{name:"Pacientes",className:"gap-4",children:[o.jsx("p",{className:"min-h-10 text-center p-2 border-b hover:bg-slate-300 transition-colors cursor-pointer",onClick:D}),N.length>0&&N.map(x=>o.jsx("p",{className:"min-h-10 text-center p-2 border-b hover:bg-slate-300 transition-colors cursor-pointer capitalize",onClick:D,children:x.nombre},x._id))]}),o.jsx(F,{placeholder:"Nombre",value:t.nombre,labelText:"Nombre",name:"nombre",type:"text",errors:h,onChange:n}),o.jsx(F,{className:"w-full",value:t.horaInicio.split("T")[0],labelText:"Fecha",name:"horaInicio",type:"date",errors:h,onChange:A}),w?o.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los días domingos no se realizan reservas"}):null,j.length>0&&t.horaInicio&&o.jsx(o.Fragment,{children:o.jsx(Q,{horasDisponibles:j,values:t,setMensaje:i,handleChange:n,reservasDelDia:I,errors:h})}),o.jsx(U,{values:t,handleChange:n,errors:h}),o.jsx(G,{value:t.observaciones,onChange:n,name:"observaciones",labelText:t.nombre==="admin"?"Compromisos separados por comas":"Observaciones"}),o.jsx(K,{values:t}),o.jsx(S,{className:`${m?"opacity-65 cursor-not-allowed":""} font-bold text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent cursor-pointer`,tipo:"submit",texto:"Guardar",disabled:m})]})]})};export{te as default};
