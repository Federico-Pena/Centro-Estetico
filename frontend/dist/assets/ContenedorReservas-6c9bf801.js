import{r as t,M as H,U as P,j as e,B as $}from"./index-7bc7cf19.js";import{f as T,L as M,d as ee,c as ae}from"./diasSemanaConHoras-5d2e9931.js";import{f as w,a as C,E,H as L}from"./constantes-5e793bc1.js";import{f as F}from"./fetchData-919cca5f.js";import{B as z}from"./BotonPrimario-e990d38c.js";function B(a,n){if(a&&n){const r=new Date(a.horario.horaInicio),l=new Date(n.horario.horaInicio);return r>l?-1:r<l?1:0}}const se=a=>{const[n,r]=t.useState([]),[l,o]=t.useState([]),[s,c]=t.useState(!1),{setMensaje:i}=t.useContext(H),{accessToken:m}=t.useContext(P);return t.useEffect(()=>{const p={headers:{"Content-Type":"application/json",Authorization:`Bearer ${m||""}`}};a&&(async()=>{c(!0);const x=`${C.reservas.deUnPaciente}${a}`;try{const f=await fetch(x,p);if(f.ok){const h=await f.json();r(h.sort(B))}}catch(f){console.log(f)}c(!1)})()},[m,a]),{setPacientes:o,getPaciente:async p=>{const u={headers:{"Content-Type":"application/json",Authorization:`Bearer ${m||""}`}};if(o([]),c(!0),p){const x=`${C.paciente.porNombre}${p}`,h=await(await fetch(x,u)).json();o(h)}else o([]);c(!1)},actualizarReservaPaciente:p=>{const{reserva:u}=p,x=`Reserva nueva de ${u.pacienteNombre} el dia ${T({fecha:u.horario.horaInicio})} a las  ${w(new Date(u.horario.horaInicio))}`,f=n.filter(h=>h._id!==u._id);i(x),r(f.concat(u).sort(B))},eliminarReservaPaciente:p=>{const{reserva:u}=p,x=n.filter(h=>h._id!==u._id),f=`Reserva eliminada de ${u.pacienteNombre}. El dia ${T({fecha:u.fecha.split("T")[0]})} a las ${u.hora}`;i(f),r(x.sort(B))},reservasPaciente:n,pacientes:l,loading:s,setReservasPaciente:r}};const te=a=>{const[n,r]=t.useState(1),[l,o]=t.useState(null),[s,c]=t.useState([]),[i,m]=t.useState(!1),{setMensaje:v}=t.useContext(H),{accessToken:d}=t.useContext(P);return t.useEffect(()=>{a&&(async()=>{if(m(!0),a.length<1){v("Dos letras como mínimo"),m(!1),c([]);return}const p={headers:{"Content-Type":"application/json",Authorization:`Bearer ${d||""}`}},u=`${C.paciente.nombres}${n}?nombre=${a}`,x=await fetch(u,p),{pacientes:f,page:h,totalPages:S}=await x.json();f&&f.length>0?(o(S),r(h),c(f.sort((R,D)=>R.nombre.toLowerCase()<D.nombre.toLowerCase()?-1:1))):(v("No se encontraron pacientes"),c([]),o(0),r(1)),m(!1)})()},[d,n,a,v]),{totalPages:l,pagina:n,nombres:s,setPagina:r,loading:i}},ne=({onChangeNombre:a})=>{const[n,r]=t.useState(""),[l,o]=t.useState(),{totalPages:s,nombres:c,pagina:i,setPagina:m,loading:v}=te(l);return e.jsxs("div",{className:"selectNombre-container",children:[e.jsxs("div",{className:"formBuscarPorNombre",children:[e.jsx("input",{name:"nombre",id:"buscarPaciente",type:"text",placeholder:"Buscar Nombre",onChange:d=>r(d.target.value)}),e.jsx(z,{tipo:"button",texto:"Buscar",className:"formBuscarBtn",onClickFunction:()=>o(n)})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pagination-buttons",children:[e.jsx("div",{className:"encabezado",children:v?e.jsx(M,{className:"loaderPacientes"}):e.jsxs("strong",{children:["Página: ",i," / ",s]})}),e.jsx($,{tipo:"button",className:"pagination-buttons-Anterior",texto:"Pág anterior",onClickFunction:()=>i>1&&m(i-1)}),e.jsx($,{tipo:"button",className:"pagination-buttons-Siguiente",onClickFunction:()=>i!==s&&m(i+1),texto:"Siguiente pág"})]}),c.map((d,g)=>e.jsxs("div",{className:d.nombre==="admin"?"selectNombre-option admin":"selectNombre-option",onClick:()=>a(d.nombre),children:[e.jsx("img",{src:d.foto.secure_url,alt:d.nombre,className:"imagen"}),e.jsx("span",{className:"nombre",children:d.nombre}),e.jsxs("span",{className:"numero",children:["Numero de reservas: ",d.totalReservas]})]},g))]})]})},oe=ne,re=(a,n)=>{const[r,l]=t.useState([]),[o,s]=t.useState([]);return t.useEffect(()=>{const i=ee(new Date(`${a} ${n}`)).filter(m=>m.dia.getDay()===new Date(`${a} ${n}`).getDay());s(i),l(i[0].horas)},[a,n]),{horas:r,diaConHoras:o}},ie=(a,n)=>a.reduce((r,l)=>{const o=new Date(l.horario.horaInicio),s=new Date(l.horario.horaDeFin),c=l.estado,i=l.pacienteNombre,m=n.reduce((v,d)=>{const g=d.horas.filter(p=>p>=o&&p<=s).map(p=>({hora:p,estado:c===E.cancelada?"":c,nombreReserva:i==="admin"?i:""}));return[...v,...g]},[]);return[...r,...m]},[]),ce=({reservas:a,diaConHoras:n,horas:r,onClickReservar:l})=>r.map((o,s)=>{const c=ie(a,n).find(m=>m.hora.toISOString()===o.toISOString());let i="liHora";return(s==0||s==1)&&(i+=" paraReservaAdmin"),c&&c.nombreReserva==="admin"&&(i+=" paraReservaAdmin"),c&&(i+=` ${c.estado}`),e.jsx("li",{"data-fecha":o,onClick:l,className:i,children:w(o)},o.toISOString())}),le=({tratamientos:a,reserva:n,setMotivo:r,className:l,name:o})=>(console.log(a),e.jsxs("div",{className:l||"",children:[e.jsx("label",{children:"Tratamiento"}),e.jsxs("select",{required:!0,name:o,onChange:s=>r&&r(s.target.value),children:[n?e.jsx("option",{defaultValue:n.tratamiento?n.tratamiento.nombre:"",children:n.tratamiento?n.tratamiento.nombre:""}):e.jsx("option",{}),a&&a.length&&a.map(s=>e.jsx("option",{value:s.nombre,children:s.nombre},s._id))]})]})),de=()=>{const[a,n]=t.useState([]),{accessToken:r}=t.useContext(P);return t.useEffect(()=>{(async()=>{const o={headers:{"Content-Type":"application/json",Authorization:`Bearer ${r||""}`}},s=C.tratamientos.todos;await F(s,o,c=>{n(c.tratamientos)})})()},[r]),{tratamientos:a}},me=({reserva:a,setForm:n,editar:r,actualizarReserva:l})=>{var _;const[o,s]=t.useState(new Date(`${a.fecha}`).toISOString().split("T")[0]||L.split("T")[0]),[c,i]=t.useState(w(new Date(`${a.fecha}`))||""),[m,v]=t.useState([]),[d,g]=t.useState(((_=a.tratamiento)==null?void 0:_.nombre)||""),[p,u]=t.useState(a.observaciones),[x,f]=t.useState(a.pacienteNombre),[h,S]=t.useState(!1),R=t.useRef(),{setMensaje:D}=t.useContext(H),{accessToken:y}=t.useContext(P),{nombres:V,pagina:U,setPagina:q,totalPacientes:G,totalPaginas:J}=se(),{diaConHoras:A,horas:Y}=re(o,c),{tratamientos:k}=de();t.useEffect(()=>{R.current.scrollIntoView({behavior:"smooth",block:"start"})},[]);const K=()=>{R.current.parentElement.classList.add("animationOut"),setTimeout(()=>{n()},300)};t.useEffect(()=>{o&&(async()=>{const j=await fetch(`${C.reservas.deUnDia}${o}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${y||""}`}}),{data:b}=await j.json();v(b)})()},[o,y,a]);const Q=N=>{const j=N.target.textContent;i(j);const b=ae(new Date(`${o} ${j}`),m);(b.estado||b.proximaHoraNoDisponible)&&(D("Hora no disponible para hacer una reserva"),i(""))},W=async N=>{N.preventDefault(),S(!0);const j=R.current,b={pacienteNombre:j.pacienteNombre.value,fecha:new Date(`${j.fecha.value} ${c}`),tratamiento:j.tratamiento.value,observaciones:j.observaciones.value,sesionSeleccionada:j.sesiones.value};if(b.pacienteNombre.trim()&&b.fecha instanceof Date&&b.sesionSeleccionada.trim()&&b.tratamiento.trim()){const I={method:"POST",body:JSON.stringify(b),headers:{"Content-Type":"application/json",authorization:`Bearer ${y}`}};await F(`${C.reservas.agregar}`,I,l),j.classList.add("formOut"),n()}else D("Faltan campos");S(!1)},X=async N=>{N.preventDefault(),S(!0);const j=R.current,b={_id:a._id,pacienteNombre:j.pacienteNombre.value,fecha:new Date(`${j.fecha.value} ${c}`),tratamiento:j.tratamiento.value,observaciones:j.observaciones.value,sesionSeleccionada:j.sesiones.value,estado:a.estado||E.pendiente};if(b.pacienteNombre.trim()&&b.fecha instanceof Date&&b.sesionSeleccionada.trim()&&b.tratamiento.trim()){const I=`${C.reservas.editar}${b._id}`,Z={method:"PUT",body:JSON.stringify(b),headers:{"Content-Type":"application/json",authorization:`Bearer ${y}`}};await F(I,Z,l),n()}else D("Faltan campos");S(!1)};return e.jsxs("section",{className:"formReservaContainer",children:[e.jsx($,{className:"cerrarForm",texto:"Cerrar Formulario",onClickFunction:K,tipo:"button"}),e.jsxs("form",{onSubmit:r?X:W,className:"formReserva",ref:R,children:[e.jsx("h3",{children:"Reserva"}),!x=="admin"||!a.pacienteNombre&&e.jsx(oe,{totalPacientes:G,totalPaginas:J,nombres:V,pagina:U,setPagina:q,onChangeNombre:f}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"pacienteNombre",children:"Nombre"}),e.jsx("input",{id:"pacienteNombre",type:"text",name:"pacienteNombre",defaultValue:x,disabled:!!x,required:!0})]}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"fecha",children:"Fecha"}),e.jsx("input",{id:"fecha",type:"date",name:"fecha",required:!0,disabled:!(x==="admin"||a.pacienteNombre),defaultValue:o||L.split("T")[0],onChange:N=>{const j=N.target.value.split("T")[0];s(j),i("")}})]}),A&&e.jsx("div",{className:"input",children:e.jsx("ul",{className:"horasDisplay",children:e.jsx(ce,{diaConHoras:A,horas:Y,onClickReservar:Q,reservas:m})})}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"observaciones",children:x==="admin"?"Tareas. Separadas por comas":"Observaciones"}),e.jsx("input",{defaultValue:a.observaciones,id:"observaciones",type:"text",name:"observaciones",onChange:N=>u(N.target.value)})]}),e.jsx(le,{className:"input",reserva:a,tratamientos:k,setMotivo:g,name:"tratamiento"}),d&&e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"sesiones",children:"Sesiones"}),e.jsxs("select",{name:"sesiones",required:!0,children:[a&&a.tratamiento&&e.jsx("option",{defaultValue:a.tratamiento.descripcionSesion,children:a.tratamiento.descripcionSesion}),k.length>0&&k.filter(N=>N.nombre===d)[0].sesiones.map(N=>e.jsx("option",{defaultValue:N.descripcion,children:N.descripcion},N._id))]})]}),e.jsxs("div",{className:"input",children:[x&&e.jsxs("span",{className:"spanHora",children:["Nombre ",e.jsx("strong",{children:x})]}),o&&e.jsxs("span",{className:"spanHora",children:["Dia"," ",e.jsx("strong",{children:T({fecha:new Date(`${o} ${c}`)})})]}),c&&e.jsxs("span",{className:"spanHora",children:["Hora ",e.jsx("strong",{children:c})]}),p&&e.jsxs("span",{className:"spanHora",children:["Observaciones",e.jsx("strong",{children:p})]}),d&&e.jsxs("span",{className:"spanHora",children:["Tratamiento ",e.jsx("strong",{children:d})]})]}),e.jsx(z,{tipo:"submit",className:"submitAdmin",texto:h?e.jsx(M,{}):"Guardar"})]})]})};const O=[E.pendiente,E.pago,E.cancelada];function ue(a){const n=O.indexOf(a);if(n!==-1){const r=(n+1)%O.length;return O[r]}else return}const he=({actualizarReserva:a,reserva:n,cerrarReserva:r,setForm:l,setModal:o})=>{const[s,c]=t.useState(n),i=t.useRef(),{accessToken:m}=t.useContext(P),{setMensaje:v}=t.useContext(H),d=async()=>{const u=ue(s.estado),x=`${C.reservas.editarEstado}${s._id}`,f={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${m}`},body:JSON.stringify({estado:u})};await F(x,f,h=>{a(h),c(h.reserva),v(h.mensaje)})},g=()=>{r(i)},p=()=>{l(s)};return e.jsx(e.Fragment,{children:e.jsxs("article",{className:"containerReserva",ref:i,children:[e.jsx("div",{className:`reserva-container-titulo  ${s.estado}`,children:e.jsx("h3",{children:"Detalles de la reserva"})}),e.jsxs("div",{className:`reserva-container-cuerpo  ${s.estado}`,children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Paciente: ",e.jsx("strong",{children:s.pacienteNombre})]}),e.jsxs("li",{children:["Fecha:",e.jsx("strong",{children:T({fecha:s.horario.horaInicio})})]}),e.jsxs("li",{children:["Hora:"," ",e.jsx("strong",{children:w(new Date(s.horario.horaInicio))})]}),s.pacienteNombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Tratamiento: ",e.jsx("strong",{children:s.tratamiento.nombre})]}),e.jsxs("li",{children:["Sesiones:",e.jsx("strong",{children:s.tratamiento.descripcionSesion})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("strong",{children:s.observaciones})]}),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:s.estado})]}),e.jsxs("li",{children:["Valor:",e.jsxs("strong",{className:"strongEstado",children:["$ ",s.precio.toFixed(2)]})]})]})]}),s.pacienteNombre==="admin"&&e.jsxs("ul",{className:"tareasAdmin",children:[e.jsx("li",{children:"Lista:"}),s.observaciones.split(",").map(u=>e.jsx("li",{className:"liTarea",children:e.jsx("span",{children:u})},u)),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:s.estado})]})]})]}),e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx($,{texto:"Editar",className:"btnEditar",onClickFunction:p}),e.jsx($,{texto:"⭮ Estado",className:`btnCompletada ${s.estado}`,onClickFunction:d})]}),r?e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx($,{texto:"Cerrar",className:"btnCerrarReserva",onClickFunction:g,tipo:"button"}),e.jsx($,{texto:"Eliminar",className:"btnCerrar Cancelada",onClickFunction:()=>o(s)})]}):e.jsx("div",{className:"reserva-container-botones",children:e.jsx($,{texto:"Eliminar",className:"btnCerrar",onClickFunction:()=>o(s)})})]})})};const pe=({titulo:a,mensaje:n,onConfirm:r,onCancel:l})=>{const o=t.useRef();return t.useEffect(()=>{o.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",ref:o,children:[e.jsx("h3",{children:a}),e.jsx("p",{children:n}),e.jsxs("div",{children:[e.jsx("button",{onClick:r,children:"Confirmar"}),e.jsx("button",{onClick:l,children:"Cancelar"})]})]})})},ve=({reservas:a,actualizarReservas:n,actualizarReservaEliminada:r,cerrarReserva:l,className:o})=>{const[s,c]=t.useState(!1),[i,m]=t.useState(!1),[v,d]=t.useState(!1),{accessToken:g}=t.useContext(P),p=h=>{m(h),c(!0)},u=async()=>{const h=`${C.reservas.eliminar}${i._id}`,S={method:"DELETE",headers:{authorization:`Bearer ${g}`}};await F(h,S,r),d(!1)},x=()=>{d(!1)},f=h=>{m(h),d(!0)};return s?e.jsx(me,{editar:!0,reserva:{...i,fecha:i.horario.horaInicio,nombre:i.pacienteNombre},actualizarReserva:n,setForm:()=>{c(!1)}}):v?e.jsx(pe,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${i.pacienteNombre} el dia ${T({fecha:i.horario.horaInicio})} a las ${w(new Date(i.horario.horaInicio))}?`,onConfirm:u,onCancel:x}):e.jsx("section",{className:`ContenedorReservas ${o||""}`,children:(a==null?void 0:a.length)>0&&a.map(h=>e.jsx(he,{setModal:f,setForm:p,cerrarReserva:l,actualizarReservaEliminada:r,actualizarReserva:n,reserva:h},h._id))})};export{ve as C,me as F,ce as L,le as S,se as a,pe as b,oe as c,re as d,ie as e,B as o,de as u};
