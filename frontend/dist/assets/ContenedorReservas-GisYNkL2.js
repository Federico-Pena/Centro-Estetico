import{j as e,c as g,a as k,k as R,R as f,E as x,l as j,u as z,r as h}from"./index-bGblmpTd.js";import{f as N,u as C}from"./useReservasContext-bDli98VY.js";import{C as D}from"./LoaderChico-zbRwC7-4.js";import{u as V}from"./useObserver-oB8vhmWg.js";import{f as S}from"./formatHoraUser-TJ92Iw1g.js";import{B as u}from"./Button-9xCFGcvS.js";import{f as $,b as A,u as T,a as L}from"./useUserContext-ZLo1aMkK.js";const B=({reserva:a})=>{var t,s,o,n;return e.jsxs("ul",{className:"grid text-white",children:[e.jsxs("li",{className:"capitalize grid grid-flow-col justify-between p-4 border-b",children:["Fecha:",e.jsx("span",{children:N(a.horario.horaInicio)})]}),e.jsxs("li",{className:"p-4 border-b grid grid-flow-col justify-between",children:["Hora: ",e.jsx("span",{children:S(new Date(a.horario.horaInicio))})]}),((t=a.paciente)==null?void 0:t.nombre)!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"p-4 border-b capitalize grid gap-2",children:["Servicio:",e.jsx("span",{className:"grid justify-end",children:((s=a.servicio)==null?void 0:s.nombre)||e.jsx(g,{})})]}),e.jsxs("li",{className:"p-4 border-b grid gap-2",children:["Tratamiento:",e.jsx("span",{className:"grid justify-end",children:((o=a.tratamiento)==null?void 0:o.descripcion)||e.jsx(g,{})})]}),e.jsxs("li",{className:"p-4 border-b grid gap-2",children:["Observaciones:",e.jsx("span",{className:"grid justify-end",children:a.observaciones||e.jsx(g,{})})]}),e.jsxs("li",{className:"p-4 pb-8 grid grid-flow-col justify-between",children:["Valor:",e.jsxs("span",{children:["$ ",(n=a.tratamiento)==null?void 0:n.costoPorSesion]})]})]})]})},U=({reserva:a})=>{var t;return((t=a.paciente)==null?void 0:t.nombre)==="admin"&&e.jsx(e.Fragment,{children:e.jsxs("ul",{className:"pb-4 gap-4 items-start grid text-white",children:[e.jsx("li",{className:"list-none text-center border-t pt-4",children:"Compromisos"}),a.observaciones.split(",").map(s=>e.jsx("li",{className:"pl-6",children:s},s))]})})},M=({reserva:a,handleEditarEstadoReserva:t,handleEliminarReserva:s,loading:o,contenedorRef:n})=>{const m=k(),r=R().pathname===f.admin.calendario,{dispatch:d}=C(),c=()=>{m(f.admin.editarReserva,{state:{reserva:a}})},i=()=>{n.current.classList.replace("animate-fadeIn","animate-growOut"),setTimeout(()=>{d({type:j.SET_RESERVAS_SELECCIONADAS,payload:[]})},500)};return e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-full",texto:"Editar",tipo:"button",onClickFunction:c}),e.jsx(u,{disabled:o,texto:"Estado",tipo:"button",className:`${a.estado} w-full text-white`,onClickFunction:t}),r&&e.jsx(u,{className:"w-full",texto:"Cerrar",onClickFunction:i,tipo:"button"}),e.jsx(u,{className:`w-full ${x.cancelada} text-white`,texto:"Eliminar",tipo:"button",onClickFunction:s})]})},P=async(a,t)=>{const s=`${A.reservas.deleteReserva}${t}`,o={method:"DELETE",headers:{Authorization:`Bearer ${a||""}`}};return await $(s,o)},b=[x.pendiente,x.pago,x.cancelada];function H(a){const t=b.indexOf(a);if(t!==-1){const s=(t+1)%b.length;return b[s]}else return}const q=async(a,t)=>{const s=H(t.estado),o=`${A.reservas.putEstadoReserva}${t._id}`,n={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},body:JSON.stringify({estado:s})};return await $(o,n)},J=()=>{const{setLoading:a}=T(),{accessToken:t}=L(),{setMensaje:s}=z(),{dispatch:o}=C();return{borrarReserva:async l=>{try{a(!0);const r=await P(t,l._id),{status:d,error:c,mensaje:i}=r;d===200?(s(i),o({type:j.DELETE_RESERVA,payload:l})):s(c||"Ocurrió un error al eliminar el paciente")}catch{s("Ocurrió un error al eliminar el paciente")}finally{a(!1)}},cambiarEstadoReserva:async l=>{try{a(!0);const r=await q(t,l),{status:d,datos:c,error:i,mensaje:p}=r;if(d===200)return s(p),o({type:j.SET_RESERVA_NUEVA,payload:c}),a(!1),c;s(i||"Error al actualizar el estado de la reserva")}catch{s("Error al actualizar el estado de la reserva")}finally{a(!1)}}}},G=({datos:a,contenedorRef:t})=>{var w,v,y;const o=R().pathname===f.admin.calendario,{loading:n}=T(),{borrarReserva:m,cambiarEstadoReserva:l}=J(),[r,d]=h.useState(a),[c,i]=h.useState(!1),p=h.useRef(),{isVisible:E}=V(p),_=async()=>{await m(r),i(!1)},I=()=>{i(!0)},F=async()=>{const O=await l(r);d(O)};return e.jsxs(e.Fragment,{children:[c&&e.jsx(D,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${(w=r.paciente)==null?void 0:w.nombre} el dia ${N((v=r.horario)==null?void 0:v.horaInicio)} a las ${S(new Date((y=r.horario)==null?void 0:y.horaInicio))}?`,onConfirm:_,onCancel:()=>i(!1)}),e.jsxs("article",{className:`${E&&!o?"animate-fadeIn":E&&o?"animate-growIn":""} border border-slate-500 grid grid-rows-[50px_1fr_auto] rounded-lg max-w-96 w-full mx-auto overflow-auto snap-center min-w-80 ${r.estado}`,ref:p,children:[r.paciente&&e.jsx("h3",{className:"font-betonga font-bold text-xl text-white capitalize grid place-content-center tracking-wider",children:r.paciente.nombre||"Paciente eliminado"}),e.jsxs("section",{className:"grid border-t border-b border-slate-50",children:[e.jsx(B,{reserva:r}),e.jsx(U,{reserva:r})]}),e.jsx("section",{className:"grid gap-4 p-4 grid-cols-2 justify-evenly bg-white",children:e.jsx(M,{contenedorRef:t,reserva:r,handleEditarEstadoReserva:F,handleEliminarReserva:I,loading:n})})]})]})},ae=({reservas:a})=>{const t=h.useRef(),o=R().pathname===f.admin.calendario;return e.jsx("section",{className:`${o?"animate-fadeIn fixed inset-0 z-30 py-8 px-4 bg-white bg-opacity-30 backdrop-blur-sm grid items-center grid-flow-col gap-4 overflow-x-auto snap-x snap-proximity scroll-smooth":"grid gap-4 m-auto w-full max-w-5xl md:grid-cols-2 xl:grid-cols-3"} `,ref:t,children:a.length>0?a.map(n=>e.jsx(G,{datos:n,contenedorRef:t},n._id)):e.jsx("h2",{className:"text-xl text-center col-span-full",children:"No hay reservas"})})};export{ae as C};
