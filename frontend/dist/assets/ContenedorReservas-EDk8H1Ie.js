import{j as e,g as R,k as _,i as b,R as g,l as E,B as m,E as p,o as j,f as v,c as w,m as y,b as T,a as F,r as x,u as I}from"./index-6lSq4eNo.js";import{C as O}from"./LoaderChico-eJFhAvFb.js";import{f as C}from"./formatHoraUser-TJ92Iw1g.js";const k=({reserva:a})=>{var t,s,r;return e.jsxs("ul",{className:"grid [&>li]:p-4 [&>li]:grid [&>li]:grid-flow-col [&>li]:grid-cols-[1fr_2fr] [&>li]:justify-between [&>li>span]:text-end",children:[e.jsxs("li",{children:["Fecha:",e.jsx("span",{children:R(a.horario.horaInicio)})]}),e.jsxs("li",{children:["Hora: ",e.jsx("span",{children:C(new Date(a.horario.horaInicio))})]}),a.paciente.nombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"capitalize",children:["Servicio: ",e.jsx("span",{children:((t=a.servicio)==null?void 0:t.nombre)||"-"})]}),e.jsxs("li",{children:["Tratamiento:",e.jsx("span",{children:((s=a.tratamiento)==null?void 0:s.descripcion)||"-"})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("span",{children:a.observaciones||"-"})]}),e.jsxs("li",{children:["Valor:",e.jsxs("span",{children:["$ ",(r=a.tratamiento)==null?void 0:r.costoPorSesion]})]})]})]})},D=({reserva:a})=>a.paciente.nombre==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"p-4 border-t",children:"Compromisos:"}),e.jsx("ul",{className:"px-6 pb-4 gap-4 grid list-decimal list-inside",children:a.observaciones.split(",").map(t=>e.jsx("li",{className:"",children:e.jsx("span",{children:t})},t))})]}),V=({reserva:a,handleEditarEstadoReserva:t,handleEliminarReserva:s,loading:r,contenedorRef:n})=>{const o=_(),c=b().pathname===g.admin.calendario,{dispatch:l}=E(),i=()=>{o(g.admin.editarReserva,{state:{reserva:a}})},d=()=>{n.current.classList.replace("animate-growIn","animate-growOut"),setTimeout(()=>{l({type:j.SET_RESERVAS_SELECCIONADAS,payload:[]})},500)};return e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-full",texto:"Editar",tipo:"button",onClickFunction:i}),e.jsx(m,{disabled:r,texto:"Estado",tipo:"button",className:`${a.estado} w-full text-white`,onClickFunction:t}),c&&e.jsx(m,{className:"w-full",texto:"Cerrar",onClickFunction:d,tipo:"button"}),e.jsx(m,{className:`w-full ${p.cancelada} text-white`,texto:"Eliminar",tipo:"button",onClickFunction:s})]})},z=async(a,t)=>{const s=`${w.reservas.deleteReserva}${t}`,r={method:"DELETE",headers:{Authorization:`Bearer ${a||""}`}};return await v(s,r)},f=[p.pendiente,p.pago,p.cancelada];function L(a){const t=f.indexOf(a);if(t!==-1){const s=(t+1)%f.length;return f[s]}else return}const B=async(a,t)=>{const s=L(t.estado),r=`${w.reservas.putEstadoReserva}${t._id}`,n={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},body:JSON.stringify({estado:s})};return await v(r,n)},U=()=>{const{setLoading:a}=y(),{accessToken:t}=T(),{setMensaje:s}=F(),{dispatch:r}=E();return{borrarReserva:async u=>{try{a(!0);const c=await z(t,u._id),{status:l,error:i,mensaje:d}=c;l===200?(s(d),r({type:j.DELETE_RESERVA,payload:u})):s(i||"Ocurrió un error al eliminar el paciente")}catch{s("Ocurrió un error al eliminar el paciente")}finally{a(!1)}},cambiarEstadoReserva:async u=>{try{a(!0);const c=await B(t,u),{status:l,datos:i,error:d,mensaje:h}=c;if(l===200)return s(h),r({type:j.SET_RESERVA_NUEVA,payload:i}),a(!1),i;s(d||"Error al actualizar el estado de la reserva")}catch{s("Error al actualizar el estado de la reserva")}finally{a(!1)}}}},P=({datos:a,contenedorRef:t})=>{const{loading:s}=y(),{borrarReserva:r,cambiarEstadoReserva:n}=U(),[o,u]=x.useState(a),[c,l]=x.useState(!1),i=x.useRef(),{isVisible:d}=I(i),h=async()=>{await r(o),l(!1)},S=()=>{l(!0)},N=async()=>{const A=await n(o);u(A)},$={Pago:"bg-color-paga text-white",Cancelada:"bg-color-cancelada text-white",Pendiente:"bg-color-pendiente text-white"}[o.estado]||"";return e.jsxs(e.Fragment,{children:[c&&e.jsx(O,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${o.paciente.nombre} el dia ${R(o.horario.horaInicio)} a las ${C(new Date(o.horario.horaInicio))}?`,onConfirm:h,onCancel:()=>l(!1)}),e.jsxs("article",{className:`${d?"animate-toastIn":""} border border-slate-500 grid grid-rows-[40px_1fr_130px] rounded-lg max-w-96 w-full m-auto overflow-auto snap-center min-w-80 ${$}`,ref:i,children:[e.jsx("h3",{className:"font-betonga font-bold text-xl capitalize grid place-content-center tracking-wider",children:o.paciente.nombre}),e.jsxs("section",{className:"grid border-t border-b border-slate-50",children:[e.jsx(k,{reserva:o}),e.jsx(D,{reserva:o})]}),e.jsx("section",{className:"grid gap-4 p-4 grid-cols-2 justify-evenly bg-white",children:e.jsx(V,{contenedorRef:t,reserva:o,handleEditarEstadoReserva:N,handleEliminarReserva:S,loading:s})})]})]})},G=({reservas:a})=>{const t=b(),s=x.useRef(),r=t.pathname===g.admin.calendario;return e.jsx("section",{className:`${r?"animate-growIn fixed inset-0 z-30 m-0 p-4 bg-white bg-opacity-30 backdrop-blur-sm flex gap-4 justify-start overflow-x-auto snap-x snap-proximity scroll-smooth":"grid gap-4 m-auto w-full max-w-5xl md:grid-cols-2 xl:grid-cols-3"} `,ref:s,children:a.length>0?a.map(n=>e.jsx(P,{datos:n,contenedorRef:s},n._id)):e.jsx("h2",{className:"text-xl text-center col-span-full",children:"No hay reservas"})})};export{G as C};
