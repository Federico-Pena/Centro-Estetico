import{I as k,H as q,a as V,D as U,u as y,r as m,j as e,E as I,b as X,A as $}from"./index-BN4e8_cD.js";import{O as B,C as P}from"./OpenInfo-B7pHdtxZ.js";import{a as C,f as F,u as D,b as E}from"./useLoaderContext-CL4xz49p.js";import{f as A}from"./formatFechaParaUser-B35bwiOM.js";import{L as T}from"./LabelInput-BKKsOyNx.js";import{u as G}from"./useForm-CXfPmMIm.js";import{T as Y}from"./TextAreaLabel-Y44F5u-S.js";import{f as Z,c as J}from"./fechasDelCalendarioSemanal-CLG0XsWG.js";import{B as R}from"./Button-D70TNmHc.js";import{D as K}from"./Dropdown-B46kqRJn.js";import{T as Q}from"./TextErrorForm-BKvfVkcs.js";import"./useObserver-lcFBawrA.js";import"./formatHoraUser-DhkUKUiJ.js";function w(t){return t&&t.split(" ").map(s=>s[0].toUpperCase()+s.substring(1)).join(" ")}const W=t=>{const s="59894539587",o=`Me interesa hacer la siguiente reserva. 
  Nombre: ${w(t.nombre)}.
  Fecha: ${w(A(`${t.fecha} ${t.hora}`))}.
  Hora: ${t.hora}. 
  Servicio: ${w(t.servicio)}. 
  Tratamiento: ${w(t.tratamiento)}. 
  ${t.observaciones&&`Observaciones: ${w(t.observaciones)}.`}`;window.open(`https://wa.me/${s}?text=${encodeURIComponent(o)}`,"_blank")},ee=async(t,s)=>{const o=new Date(t).getDay(),i=Z(t,U,V,q,k)[o];try{const c=`${C.publicas.reservasDia}${t}`,n={headers:{Authorization:`Bearer ${s||""}`}},l=await F(c,n),{datos:r,error:d}=l;return d?{error:d}:{horas:te(i.horas,r),datos:r}}catch(c){console.log(c)}},te=(t,s)=>t.map(o=>J(o,s)),se=t=>{const{accessToken:s}=D(),{setMensaje:o}=y(),{setLoading:a}=E(),[i,c]=m.useState([]);return m.useEffect(()=>{t&&(async()=>{a(!0);try{const l=await ee(t,s),{horas:r,error:d}=l;d?(o(d),c([])):c(r)}catch{o("Error al obtener lar horas disponibles")}finally{a(!1)}})()},[s,o,t,a]),{horasDisponibles:i}},re=({values:t,handleSetHora:s,horasDisponibles:o})=>e.jsxs("ul",{className:"grid gap-2 grid-cols-4",children:[e.jsx("li",{className:"col-span-full",children:"Horas disponibles"}),o.map((a,i)=>i!==0&&i!==1&&a.estado!==I.pendiente&&a.estado!==I.pago&&!a.proximaHoraNoDisponible&&e.jsx("li",{className:`p-2 rounded-xl w-full grid place-content-center shadow-md ${a.id.split("T")[1]===t.hora?"col-span-full row-start-2 bg-color-violeta text-slate-50 max-w-md transition-[max-width]":"bg-slate-50 max-w-20 hover:opacity-50 cursor-pointer transition-opacity"}`,onClick:()=>s(a.id.split("T")[1]),children:a.id.split("T")[1]},a.id))]}),oe=({values:t,horasDisponibles:s})=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-betonga text-color-violeta font-bold capitalize text-center underline underline-offset-4 text-2xl px-4",children:"Resumen"}),t.nombre&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Nombre ",e.jsx("strong",{className:"text-end text-balance",children:t.nombre})]}),t.fecha&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Dia",e.jsx("strong",{className:"text-end text-balance",children:A(`${t.fecha} ${t.hora}`)})]}),t.hora&&s.length>0&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Hora ",e.jsx("strong",{className:"text-end text-balance",children:t.hora})]}),t.servicio&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Servicio",e.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:t.servicio})]}),t.tratamiento&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Tratamiento",e.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:t.tratamiento})]}),t.observaciones&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Observaci贸n",e.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:t.observaciones})]})]}),ae={nombre:{required:!0},fecha:{required:!0},hora:{required:!0},servicio:{required:!0},tratamiento:{required:!0}},O=({servicio:t,cerrarFormulario:s})=>{const{loading:o}=E(),{setMensaje:a}=y(),i=m.useRef(),c={nombre:"",fecha:"",hora:"",observaciones:"",servicio:t.nombre||"",tratamiento:""},{errors:n,handleChange:l,values:r,onSubmitForm:d}=G(c,ae),{horasDisponibles:f}=se(r.fecha),g=new Date(r.fecha).getDay()===6,b=new Date(r.fecha).getDay()===5,x=u=>{g?a("Faltan campos requeridos."):(W(u),p())},p=()=>{i.current.classList.add("animate-fadeOut")},v=u=>{l({target:{name:"hora",value:u}})},h=u=>{const N={target:{name:"tratamiento",value:u.target.textContent}};l(N)},S=u=>u.map(j=>`${j.descripcion} - ${j.sesiones} ${j.sesiones>1?"Sesiones":"Sesi贸n"}`);return e.jsxs("section",{id:"sectionForm",ref:i,className:"grid grid-rows-[50px_1fr] p-4 py-8",onAnimationEnd:u=>{u.target.id==="sectionForm"&&u.animationName!=="fadeIn"&&s()},children:[e.jsx("h1",{className:"font-betonga text-color-violeta font-bold capitalize text-center underline underline-offset-4 text-2xl px-4",children:"Reserva"}),e.jsxs("form",{onSubmit:u=>d(u,x),className:"animate-fadeIn grid w-full max-w-md py-8 px-4 rounded-lg gap-4 m-auto bg-color-verde-blanco border border-gray-300 shadow-lg",children:[e.jsx(T,{errors:n,labelText:"Nombre",name:"nombre",onChange:l,placeholder:"Nombre",type:"text",value:r.nombre}),e.jsx(T,{className:"w-full",errors:n,labelText:"Fecha",name:"fecha",onChange:u=>{l(u),v("")},type:"date",value:r.fecha,min:X.split("T")[0]}),g||b?e.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los fines de semana no se realizan reservas"}):null,f.length>0&&!g&&!b&&e.jsxs(e.Fragment,{children:[e.jsx(re,{horasDisponibles:f,handleSetHora:v,values:r}),n.hora&&e.jsx("small",{className:"text-red-600",children:"* Este campo es requerido"})]}),e.jsx(T,{className:"w-full capitalize",errors:n,labelText:"Servicio",name:"servicio",disabled:!0,type:"text",value:r.servicio}),e.jsx("label",{children:"Tratamientos"}),n&&n.tratamiento&&e.jsxs("small",{className:"text-red-600",children:["* ",n.tratamiento]}),e.jsx(K,{defaultValue:r.tratamiento,name:"tratamiento",list:S(t.tratamientos),onClickFunction:h}),e.jsx(Y,{value:r.observaciones,placeholder:"Observaci贸n",onChange:l,name:"observaciones",labelText:"Observaci贸n",error:n.observaciones}),e.jsx(oe,{horasDisponibles:f,values:r}),e.jsx(Q,{errors:n}),e.jsxs("footer",{className:"grid grid-flow-col pt-8 px-4 gap-4",children:[e.jsx(R,{className:"w-full",tipo:"button",onClickFunction:p,texto:"Volver"}),e.jsx(R,{className:"w-full",bgColor:!0,tipo:"submit",texto:"Enviar",disabled:o})]})]})]})},ne=()=>{const[t,s]=m.useState(0),[o,a]=m.useState([]),{setMensaje:i}=y(),{accessToken:c}=D();return m.useEffect(()=>{(async()=>{const d=C.publicas.getPromociones,f={headers:{authorization:`Bearer ${c}`}},g=await F(d,f),{error:b,datos:x,status:p}=g;p===200?a(x):i(b||"Error al obtener los datos")})()},[i,c]),m.useEffect(()=>{const d=setInterval(()=>{const f=(t+1)%o.length;s(f)},5e3);return()=>{clearInterval(d)}},[t,o.length]),{promos:o,nextSlide:()=>{const r=(t+1)%o.length;s(r)},prevSlide:()=>{const r=(t-1+o.length)%o.length;s(r)},currentIndex:t}},ie=({promos:t,handleReservar:s,currentIndex:o})=>e.jsx("div",{className:"overflow-hidden flex rounded-lg border border-slate-500",children:t.map(a=>{var i,c;return e.jsxs("figure",{className:"transition-transform duration-500 relative flex-[0_0_100%]",style:{transform:`translateX(-${o*100}%)`},children:[e.jsx("img",{className:"object-cover w-full h-full bg-slate-50 aspect-square max-h-[500px]",src:((i=a.imagen)==null?void 0:i.secure_url)||((c=a.servicio.imagen)==null?void 0:c.secure_url),alt:a.nombre}),e.jsx("button",{className:"absolute w-full max-w-64 bottom-4 left-1/2 -translate-x-1/2 font-bold text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent",onClick:()=>s(a),children:"Reservar"})]},a._id)})}),ce=()=>{const[t,s]=m.useState(!1),[o,a]=m.useState(""),{nextSlide:i,prevSlide:c,promos:n,currentIndex:l}=ne(),r=m.useRef(null),d=x=>{r.current=x.touches[0].clientX},f=()=>{r.current},g=x=>{if(r.current===null)return;const p=x.touches[0].clientX,v=r.current-p;v>50?i():v<-50&&c()},b=x=>{const p=`${x.servicio.nombre} - ${x.descripcion}`;a(p),s(!0)};return n instanceof Array?n.length>0&&e.jsxs(e.Fragment,{children:[t&&e.jsx(O,{observaciones:o,cerrarFormulario:()=>s(!1)}),e.jsxs("section",{className:"relative flex justify-center max-w-4xl m-auto mb-8",onTouchStart:d,onTouchMove:g,onTouchEnd:f,children:[n.length>1&&e.jsx("span",{className:"rounded-md cursor-pointer text-4xl absolute z-10 left-0 top-1/2 flex justify-center items-center rotate-90 transition-transform px-4 bg-[#00000025] hover:bg-[#0000003f] hover:scale-95",onClick:c,children:e.jsx($,{})}),e.jsx(ie,{currentIndex:l,handleReservar:b,promos:n}),n.length>1&&e.jsx("span",{className:"rounded-md cursor-pointer text-4xl absolute z-10 right-0 top-1/2 flex justify-center items-center -rotate-90 transition-transform px-4 bg-[#00000025] hover:bg-[#0000003f] hover:scale-95",onClick:i,children:e.jsx($,{})}),e.jsx("div",{className:" overflow-hidden absolute rounded-xl px-4 py-2 bg-[#00000025] -bottom-10 flex justify-center gap-x-4 m-auto",children:Array.from(n).map((x,p)=>e.jsx("span",{className:`${p===l?"bg-color-violeta translate-y-0":"translate-y-8"} rounded-full w-4 h-4 transition duration-500`},p))})]})]}):null},le=ce;function Ne(){const{setMensaje:t}=y(),{setLoading:s}=E(),{accessToken:o}=D(),[a,i]=m.useState([]),[c,n]=m.useState(null),[l,r]=m.useState(!1),[d,f]=m.useState(!1),[g,b]=m.useState(""),x=m.useRef();m.useEffect(()=>{try{s(!0),(async()=>{const S=C.publicas.getServicios,u={headers:{authorization:`Bearer ${o}`}},j=await F(S,u),{error:N,datos:_,status:z}=j;if(z===200){const H=_.filter(L=>L.tratamientos.some(M=>M.costoTotal!==0));i(H)}else t(N||"Error al obtener los servicios")})()}catch{s(!1),t("Error al obtener los servicios")}finally{s(!1)}},[t,o,s]);const p=h=>{n(h),f(!0),x.current.scrollIntoView()},v=(h,S)=>{x.current.scrollIntoView(),b(S),n(h),r(!0)};return e.jsxs("main",{className:"animate-fadeIn grid py-8 px-4 gap-8 ",ref:x,children:[!d&&e.jsx("h1",{className:"font-betonga text-color-violeta font-bold text-3xl text-center",children:"Servicios"}),!d&&!l&&e.jsx(le,{}),d&&e.jsx(O,{servicio:c,cerrarFormulario:()=>f(!1)}),e.jsxs("section",{className:`grid gap-8 grid-cols-1 ${l?"md:grid-cols-1 lg:grid-cols-1":"md:grid-cols-2 lg:grid-cols-3"} max-w-5xl mx-auto`,children:[l&&!d&&e.jsx(B,{setOpenInfo:r,imgSrc:g,servicio:c,reservar:p}),a instanceof Array&&!d&&!l&&a.map(h=>e.jsx(P,{servicio:h,abrirMasInfo:v,reservar:p,setServicio:n},h._id))]})]})}export{Ne as default};
