import{r as s,M as H,U as T,j as e,B as S}from"./index-4e232b89.js";import{f as E,L,d as ee,c as ae}from"./diasSemanaConHoras-71219598.js";import{f as F,a as $,E as P,H as O,T as z}from"./constantes-5af98ff7.js";import{f as y}from"./fetchData-919cca5f.js";import{B as _}from"./BotonPrimario-8972ad95.js";function A(a,n){if(a&&n){const i=new Date(a.horario.horaInicio),l=new Date(n.horario.horaInicio);return i>l?-1:i<l?1:0}}const se=a=>{const[n,i]=s.useState([]),[l,o]=s.useState([]),[t,c]=s.useState(!1),{setMensaje:r}=s.useContext(H),{accessToken:m}=s.useContext(T);return s.useEffect(()=>{const p={headers:{"Content-Type":"application/json",Authorization:`Bearer ${m||""}`}};a&&(async()=>{c(!0);const j=`${$.reservas.deUnPaciente}${a}`;try{const x=await fetch(j,p);if(x.ok){const h=await x.json();i(h.sort(A))}}catch(x){console.log(x)}c(!1)})()},[m,a]),{setPacientes:o,getPaciente:async p=>{const u={headers:{"Content-Type":"application/json",Authorization:`Bearer ${m||""}`}};if(o([]),c(!0),p){const j=`${$.paciente.porNombre}${p}`,h=await(await fetch(j,u)).json();o(h)}else o([]);c(!1)},actualizarReservaPaciente:p=>{const{reserva:u}=p,j=`Reserva nueva de ${u.pacienteNombre} el dia ${E({fecha:u.horario.horaInicio})} a las  ${F(new Date(u.horario.horaInicio))}`,x=n.filter(h=>h._id!==u._id);r(j),i(x.concat(u).sort(A))},eliminarReservaPaciente:p=>{const{reserva:u}=p,j=n.filter(h=>h._id!==u._id),x=`Reserva eliminada de ${u.pacienteNombre}. El dia ${E({fecha:u.fecha.split("T")[0]})} a las ${u.hora}`;r(x),i(j.sort(A))},reservasPaciente:n,pacientes:l,loading:t,setReservasPaciente:i}};const te=a=>{const[n,i]=s.useState(1),[l,o]=s.useState(null),[t,c]=s.useState([]),[r,m]=s.useState(!1),{setMensaje:v}=s.useContext(H),{accessToken:d}=s.useContext(T);return s.useEffect(()=>{a&&(async()=>{if(m(!0),a.length<1){v("Dos letras como mínimo"),m(!1),c([]);return}const p={headers:{"Content-Type":"application/json",Authorization:`Bearer ${d||""}`}},u=`${$.paciente.nombres}${n}?nombre=${a}`,j=await fetch(u,p),{pacientes:x,page:h,totalPages:C}=await j.json();x&&x.length>0?(o(C),i(h),c(x.sort((R,D)=>R.nombre.toLowerCase()<D.nombre.toLowerCase()?-1:1))):(v("No se encontraron pacientes"),c([]),o(0),i(1)),m(!1)})()},[d,n,a,v]),{totalPages:l,pagina:n,nombres:t,setPagina:i,loading:r}},ne=({onChangeNombre:a})=>{const[n,i]=s.useState(""),[l,o]=s.useState(),{totalPages:t,nombres:c,pagina:r,setPagina:m,loading:v}=te(l);return e.jsxs("div",{className:"selectNombre-container",children:[e.jsxs("div",{className:"formBuscarPorNombre",children:[e.jsx("input",{name:"nombre",id:"buscarPaciente",type:"text",placeholder:"Buscar Nombre",onChange:d=>i(d.target.value)}),e.jsx(_,{tipo:"button",texto:"Buscar",className:"formBuscarBtn",onClickFunction:()=>o(n)})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pagination-buttons",children:[e.jsx("div",{className:"encabezado",children:v?e.jsx(L,{className:"loaderPacientes"}):e.jsxs("strong",{children:["Página: ",r," / ",t]})}),e.jsx(S,{tipo:"button",className:"pagination-buttons-Anterior",texto:"Pág anterior",onClickFunction:()=>r>1&&m(r-1)}),e.jsx(S,{tipo:"button",className:"pagination-buttons-Siguiente",onClickFunction:()=>r!==t&&m(r+1),texto:"Siguiente pág"})]}),c.map((d,N)=>e.jsxs("div",{className:d.nombre==="admin"?"selectNombre-option admin":"selectNombre-option",onClick:()=>a(d.nombre),children:[e.jsx("img",{src:d.foto.secure_url,alt:d.nombre,className:"imagen"}),e.jsx("span",{className:"nombre",children:d.nombre}),e.jsxs("span",{className:"numero",children:["Numero de reservas: ",d.totalReservas]})]},N))]})]})},oe=ne,re=(a,n)=>{const[i,l]=s.useState([]),[o,t]=s.useState([]);return s.useEffect(()=>{const r=ee(new Date(`${a} ${n}`)).filter(m=>m.dia.getDay()===new Date(`${a} ${n}`).getDay());t(r),l(r[0].horas)},[a,n]),{horas:i,diaConHoras:o}},ie=(a,n)=>a.reduce((i,l)=>{const o=new Date(l.horario.horaInicio),t=new Date(l.horario.horaDeFin),c=l.estado,r=l.pacienteNombre,m=n.reduce((v,d)=>{const N=d.horas.filter(p=>p>=o&&p<=t).map(p=>({hora:p,estado:c===P.cancelada?"":c,nombreReserva:r==="admin"?r:""}));return[...v,...N]},[]);return[...i,...m]},[]),ce=({reservas:a,diaConHoras:n,horas:i,onClickReservar:l})=>i.map((o,t)=>{const c=ie(a,n).find(m=>m.hora.toISOString()===o.toISOString());let r="liHora";return(t==0||t==1)&&(r+=" paraReservaAdmin"),c&&c.nombreReserva==="admin"&&(r+=" paraReservaAdmin"),c&&(r+=` ${c.estado}`),e.jsx("li",{"data-fecha":o,onClick:l,className:r,children:F(o)},o.toISOString())}),le=({reserva:a,setMotivo:n,className:i,name:l})=>e.jsxs("div",{className:i||"",children:[e.jsx("label",{children:"Tratamiento"}),e.jsxs("select",{required:!0,name:l,onChange:o=>n&&n(o.target.value),children:[e.jsx("option",{defaultValue:a.tratamiento?a.tratamiento.nombre:"",children:a.tratamiento?a.tratamiento.nombre:""}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Drenaje Linfático",children:"Drenaje Linfático"}),e.jsx("option",{value:"Masaje Estético",children:"Masaje Estético"}),e.jsx("option",{value:"Exfoliación Corporal",children:"Exfoliación Corporal"}),e.jsx("option",{value:"Masaje Cérvico-Craneal",children:"Masaje Cérvico-Craneal"}),e.jsx("option",{value:"Masaje Con Piedras Calientes",children:"Masaje Con Piedras Calientes"}),e.jsx("option",{value:"Masaje Descontracturante",children:"Masaje Descontracturante"}),e.jsx("option",{value:"Masaje Relajante",children:"Masaje Relajante"}),e.jsx("option",{value:"Masaje Prenatal",children:"Masaje Prenatal"}),e.jsx("option",{value:"Barras De access",children:"Barras De Access"})]})]}),de=({reserva:a,setForm:n,editar:i,actualizarReserva:l})=>{var B;const[o,t]=s.useState(new Date(`${a.fecha}`).toISOString().split("T")[0]||O.split("T")[0]),[c,r]=s.useState(F(new Date(`${a.fecha}`))||""),[m,v]=s.useState([]),[d,N]=s.useState(((B=a.tratamiento)==null?void 0:B.nombre)||""),[p,u]=s.useState(a.observaciones),[j,x]=s.useState(a.pacienteNombre),[h,C]=s.useState(!1),R=s.useRef(),{setMensaje:D}=s.useContext(H),{accessToken:w}=s.useContext(T),{nombres:U,pagina:V,setPagina:q,totalPacientes:G,totalPaginas:J}=se(),{diaConHoras:k,horas:Y}=re(o,c);s.useEffect(()=>{R.current.scrollIntoView({behavior:"smooth",block:"start"})},[]);const K=()=>{R.current.parentElement.classList.add("animationOut"),setTimeout(()=>{n()},300)};s.useEffect(()=>{o&&(async()=>{const f=await fetch(`${$.reservas.deUnDia}${o}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${w||""}`}}),{data:b}=await f.json();v(b)})()},[o,w,a]);const Q=g=>{const f=g.target.textContent;r(f);const b=ae(new Date(`${o} ${f}`),m);(b.estado||b.proximaHoraNoDisponible)&&(D("Hora no disponible para hacer una reserva"),r(""))},W=async g=>{g.preventDefault(),C(!0);const f=R.current,b={pacienteNombre:f.pacienteNombre.value,fecha:new Date(`${f.fecha.value} ${c}`),tratamiento:f.tratamiento.value,observaciones:f.observaciones.value,sesionSeleccionada:f.sesiones.value};if(b.pacienteNombre.trim()&&b.fecha instanceof Date&&b.sesionSeleccionada.trim()&&b.tratamiento.trim()){const M={method:"POST",body:JSON.stringify(b),headers:{"Content-Type":"application/json",authorization:`Bearer ${w}`}};await y(`${$.reservas.agregar}`,M,l),f.classList.add("formOut"),n()}else D("Faltan campos");C(!1)},X=async g=>{g.preventDefault(),C(!0);const f=R.current,b={_id:a._id,pacienteNombre:f.pacienteNombre.value,fecha:new Date(`${f.fecha.value} ${c}`),tratamiento:f.tratamiento.value,observaciones:f.observaciones.value,sesionSeleccionada:f.sesiones.value,estado:a.estado||P.pendiente};if(b.pacienteNombre.trim()&&b.fecha instanceof Date&&b.sesionSeleccionada.trim()&&b.tratamiento.trim()){const M=`${$.reservas.editar}${b._id}`,Z={method:"PUT",body:JSON.stringify(b),headers:{"Content-Type":"application/json",authorization:`Bearer ${w}`}};await y(M,Z,l),n()}else D("Faltan campos");C(!1)};return e.jsxs("section",{className:"formReservaContainer",children:[e.jsx(S,{className:"cerrarForm",texto:"Cerrar Formulario",onClickFunction:K,tipo:"button"}),e.jsxs("form",{onSubmit:i?X:W,className:"formReserva",ref:R,children:[e.jsx("h3",{children:"Reserva"}),!j=="admin"||!a.pacienteNombre&&e.jsx(oe,{totalPacientes:G,totalPaginas:J,nombres:U,pagina:V,setPagina:q,onChangeNombre:x}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"pacienteNombre",children:"Nombre"}),e.jsx("input",{id:"pacienteNombre",type:"text",name:"pacienteNombre",defaultValue:j,disabled:!!j,required:!0})]}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"fecha",children:"Fecha"}),e.jsx("input",{id:"fecha",type:"date",name:"fecha",required:!0,disabled:!(j==="admin"||a.pacienteNombre),defaultValue:o||O.split("T")[0],onChange:g=>{const f=g.target.value.split("T")[0];t(f),r("")}})]}),k&&e.jsx("div",{className:"input",children:e.jsx("ul",{className:"horasDisplay",children:e.jsx(ce,{diaConHoras:k,horas:Y,onClickReservar:Q,reservas:m})})}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"observaciones",children:j==="admin"?"Tareas. Separadas por comas":"Observaciones"}),e.jsx("input",{defaultValue:a.observaciones,id:"observaciones",type:"text",name:"observaciones",onChange:g=>u(g.target.value)})]}),e.jsx(le,{className:"input",reserva:a,setMotivo:N,name:"tratamiento"}),d&&e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"sesiones",children:"Sesiones"}),e.jsxs("select",{name:"sesiones",required:!0,children:[d==="Admin"&&e.jsx("option",{value:"Admin",children:"Admin (sin costo)"}),e.jsx("option",{value:"1 sesion",children:"1 sesion"}),d===z.masajeDescontracturante&&e.jsx("option",{value:"4 sesiones (cuerpo completo)",children:"4 sesiones (cuerpo completo)"}),d===z.masajeEstético&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"4 sesiones (una zona a elección)",children:"4 sesiones (una zona a elección)"}),e.jsx("option",{value:"8 sesiones (una zona a elección)",children:"8 sesiones (una zona a elección)"}),e.jsx("option",{value:"8 sesiones (dos zonas a elección)",children:"8 sesiones (dos zonas a elección)"}),e.jsx("option",{value:"8 sesiones (cuerpo completo)",children:"8 sesiones (cuerpo completo)"})]})]})]}),e.jsxs("div",{className:"input",children:[j&&e.jsxs("span",{className:"spanHora",children:["Nombre ",e.jsx("strong",{children:j})]}),o&&e.jsxs("span",{className:"spanHora",children:["Dia"," ",e.jsx("strong",{children:E({fecha:new Date(`${o} ${c}`)})})]}),c&&e.jsxs("span",{className:"spanHora",children:["Hora ",e.jsx("strong",{children:c})]}),p&&e.jsxs("span",{className:"spanHora",children:["Observaciones",e.jsx("strong",{children:p})]}),d&&e.jsxs("span",{className:"spanHora",children:["Tratamiento ",e.jsx("strong",{children:d})]})]}),e.jsx(_,{tipo:"submit",className:"submitAdmin",texto:h?e.jsx(L,{}):"Guardar"})]})]})};const I=[P.pendiente,P.pago,P.cancelada];function me(a){const n=I.indexOf(a);if(n!==-1){const i=(n+1)%I.length;return I[i]}else return}const ue=({actualizarReserva:a,reserva:n,cerrarReserva:i,setForm:l,setModal:o})=>{const[t,c]=s.useState(n),r=s.useRef(),{accessToken:m}=s.useContext(T),{setMensaje:v}=s.useContext(H),d=async()=>{const u=me(t.estado),j=`${$.reservas.editarEstado}${t._id}`,x={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${m}`},body:JSON.stringify({estado:u})};await y(j,x,h=>{a(h),c(h.reserva),v(h.mensaje)})},N=()=>{i(r)},p=()=>{l(t)};return e.jsx(e.Fragment,{children:e.jsxs("article",{className:"containerReserva",ref:r,children:[e.jsx("div",{className:`reserva-container-titulo  ${t.estado}`,children:e.jsx("h3",{children:"Detalles de la reserva"})}),e.jsxs("div",{className:`reserva-container-cuerpo  ${t.estado}`,children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Paciente: ",e.jsx("strong",{children:t.pacienteNombre})]}),e.jsxs("li",{children:["Fecha:",e.jsx("strong",{children:E({fecha:t.horario.horaInicio})})]}),e.jsxs("li",{children:["Hora:"," ",e.jsx("strong",{children:F(new Date(t.horario.horaInicio))})]}),t.pacienteNombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Tratamiento: ",e.jsx("strong",{children:t.tratamiento.nombre})]}),e.jsxs("li",{children:["Sesiones:",e.jsx("strong",{children:t.tratamiento.descripcionSesion})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("strong",{children:t.observaciones})]}),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:t.estado})]}),e.jsxs("li",{children:["Valor:",e.jsxs("strong",{className:"strongEstado",children:["$ ",t.precio]})]})]})]}),t.pacienteNombre==="admin"&&e.jsxs("ul",{className:"tareasAdmin",children:[e.jsx("li",{children:"Lista:"}),t.observaciones.split(",").map(u=>e.jsx("li",{className:"liTarea",children:e.jsx("span",{children:u})},u)),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:t.estado})]})]})]}),e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(S,{texto:"Editar",className:"btnEditar",onClickFunction:p}),e.jsx(S,{texto:"⭮ Estado",className:`btnCompletada ${t.estado}`,onClickFunction:d})]}),i?e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(S,{texto:"Cerrar",className:"btnCerrarReserva",onClickFunction:N,tipo:"button"}),e.jsx(S,{texto:"Eliminar",className:"btnCerrar Cancelada",onClickFunction:()=>o(t)})]}):e.jsx("div",{className:"reserva-container-botones",children:e.jsx(S,{texto:"Eliminar",className:"btnCerrar",onClickFunction:()=>o(t)})})]})})};const he=({titulo:a,mensaje:n,onConfirm:i,onCancel:l})=>{const o=s.useRef();return s.useEffect(()=>{o.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",ref:o,children:[e.jsx("h3",{children:a}),e.jsx("p",{children:n}),e.jsxs("div",{children:[e.jsx("button",{onClick:i,children:"Confirmar"}),e.jsx("button",{onClick:l,children:"Cancelar"})]})]})})},ve=({reservas:a,actualizarReservas:n,actualizarReservaEliminada:i,cerrarReserva:l,className:o})=>{const[t,c]=s.useState(!1),[r,m]=s.useState(!1),[v,d]=s.useState(!1),{accessToken:N}=s.useContext(T),p=h=>{m(h),c(!0)},u=async()=>{const h=`${$.reservas.eliminar}${r._id}`,C={method:"DELETE",headers:{authorization:`Bearer ${N}`}};await y(h,C,i),d(!1)},j=()=>{d(!1)},x=h=>{m(h),d(!0)};return t?e.jsx(de,{editar:!0,reserva:{...r,fecha:r.horario.horaInicio,nombre:r.pacienteNombre},actualizarReserva:n,setForm:()=>{c(!1)}}):v?e.jsx(he,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${r.pacienteNombre} el dia ${E({fecha:r.horario.horaInicio})} a las ${F(new Date(r.horario.horaInicio))}?`,onConfirm:u,onCancel:j}):e.jsx("section",{className:`ContenedorReservas ${o||""}`,children:(a==null?void 0:a.length)>0&&a.map(h=>e.jsx(ue,{setModal:x,setForm:p,cerrarReserva:l,actualizarReservaEliminada:i,actualizarReserva:n,reserva:h},h._id))})};export{ve as C,de as F,ce as L,le as S,he as a,oe as b,re as c,ie as e,A as o,se as u};
