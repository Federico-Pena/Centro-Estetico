import{j as o,e as H,g as V,E as k,h as q,i as _,R as h,r as R,T as O,k as z,b as L,l as B,B as S,D as U,c as y,S as G,d as M,m as J}from"./index-TJkQKCZh.js";import{f as K}from"./formatHoraUser-TJ92Iw1g.js";const Q=({values:e})=>{const r=new Date(e.horaInicio).getDay()===6;return o.jsxs("ul",{className:"grid gap-2 border-t border-b border-slate-500 py-4",children:[o.jsx("li",{className:"text-color-violeta text-xl text-center mb-4",children:"Resumen de la reserva"}),e.nombre&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Nombre ",o.jsx("strong",{className:"text-end",children:e.nombre})]}),e.horaInicio&&!r&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Dia"," ",o.jsx("strong",{className:"text-end",children:H(new Date(`${e.horaInicio} 00:00:00`))})]}),e.hora&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Hora ",o.jsx("strong",{className:"text-end",children:e.hora})]}),e.observaciones&&o.jsxs("li",{className:"grid  gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Observaciones",o.jsx("strong",{className:"text-end",children:e.observaciones})]}),e.servicio&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Servicio",o.jsx("strong",{className:"capitalize text-end",children:e.servicio})]}),e.tratamiento&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta ",children:["Tratamiento",o.jsx("strong",{className:"text-end",children:e.tratamiento})]})]})},W=({horasDisponibles:e,values:r,reservasDelDia:m,handleChange:i,setMensaje:l,errors:s})=>{const x=n=>{const t=n.target.textContent,a=V(new Date(`${r.horaInicio} ${t}`),m);if(a.estado&&a.estado!==k.cancelada||a.proximaHoraNoDisponible){l("Hora no disponible para hacer una reserva");return}else i({target:{name:"hora",value:t}})};return o.jsxs(o.Fragment,{children:[o.jsxs("ul",{className:"grid gap-4 grid-cols-5",children:[o.jsx("li",{className:"col-span-full",children:"Hora"}),e.map(n=>o.jsx("li",{className:`p-2 rounded-xl w-full grid place-content-center shadow-md max-w-20  transition-[max-width]  ${F(n,r)} ${F(n,r).includes("cursor-not-allowed")?"":"cursor-pointer"}`,onClick:x,children:n.id.split("T")[1]},n.id))]}),s.hora&&o.jsxs("small",{className:"text-red-600",children:["* ",s.hora]}),o.jsxs("ul",{className:"grid grid-flow-col grid-rows-3 gap-4 border border-slate-500 p-4 rounded-lg",children:[o.jsx("li",{className:"col-span-full opacity-50 p-2 rounded-xl w-full grid place-content-center shadow-md m-auto bg-slate-50",children:"No disponible"}),o.jsx("li",{className:"p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50",children:"Disponible"}),o.jsx("li",{className:`${d.Pago} p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Paga"}),o.jsx("li",{className:`${d.Pendiente} p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Pendiente"}),o.jsx("li",{className:`${d.Cancelada} p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Cancelada"})]})]})},d={Pago:"text-color-paga font-bold",Cancelada:"text-color-cancelada font-bold",Pendiente:"text-color-pendiente font-bold"},F=(e,r)=>{const m=e.proximaHoraNoDisponible,i=e.id.split("T")[1]===r.hora,l=d[e.estado]===d.Pago||d[e.estado]===d.Pendiente;return[m&&"opacity-50 cursor-not-allowed",d[e.estado],i?"bg-color-violeta col-span-full row-start-2 text-white max-w-xl font-bold opacity-100 cursor-not-allowed":"bg-slate-50 ",l&&" opacity-50 cursor-not-allowed"].filter(Boolean).join(" ")},X=e=>({pacienteNombre:e.nombre,fecha:new Date(`${e.horaInicio} ${e.hora}`),observaciones:e.observaciones,servicio:e.servicio,tratamiento:e.tratamiento,estado:e.estado||""}),Y={nombre:{required:!0},horaInicio:{required:!0},servicio:{required:!0},tratamiento:{required:!0},hora:{required:!0}},Z=(e,r,m)=>{var l,s,x,n,t;return{nombre:((l=e==null?void 0:e.paciente)==null?void 0:l.nombre)||"",horaInicio:((s=e==null?void 0:e.horario)==null?void 0:s.horaInicio.split("T")[0])||"",hora:(r||m)&&K((x=e==null?void 0:e.horario)==null?void 0:x.horaInicio)||"",observaciones:(e==null?void 0:e.observaciones)||"",servicio:((n=e==null?void 0:e.servicio)==null?void 0:n.nombre)||"",tratamiento:((t=e==null?void 0:e.tratamiento)==null?void 0:t.descripcion)||"",estado:(e==null?void 0:e.estado)||""}},te=()=>{var D;const e=q(),r=_(),m=(D=e.state)==null?void 0:D.from,i=e.pathname===h.admin.editarReserva,l=e.pathname===h.admin.agregarReserva&&m===h.admin.calendario,{setMensaje:s}=R.useContext(O),{reserva:x,dispatch:n}=R.useContext(z),{handleChange:t,values:a,errors:p,validateForm:v,resetForm:I}=L(Z(x,i,l),Y),{horasDisponibles:u,reservasDelDia:T,loading:j,agregarReserva:E,editarReserva:P,pacientesNombres:f}=B(a.horaInicio),N=new Date(a.horaInicio).getDay()===6,A=c=>{t({target:{name:"hora",value:""}}),t(c)},$=async c=>{c.preventDefault();const g=v()&&!N;if(console.log(g),g){const b=X(a);(i?await P(b,x._id):await E(b))?w():s("Ocurrió un error al guardar el paciente.")}else s("Faltan campos requeridos.")},w=()=>{I(),n({type:J.SET_RESERVA,payload:null}),r(-1)},C=c=>{const b={target:{name:"nombre",value:c.target.textContent}};t(b)};return o.jsxs("section",{className:"bg-gradient-to-b from-slate-900 to-black fixed inset-0 z-50 grid grid-rows-[auto_1fr] gap-4 p-4 overflow-auto",children:[o.jsx(S,{className:"border border-color-violeta bg-color-violeta text-white  flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity",tipo:"button",onClickFunction:w,texto:"Cerrar"}),o.jsxs("form",{className:"animate-toastIn bg-color-logo rounded-lg p-4 max-w-xl m-auto w-full grid gap-4 ",onSubmit:$,children:[o.jsxs("h2",{className:"font-betonga font-bold text-color-violeta text-2xl tracking-wider text-center mb-4",children:[i?"Editar":"Crear"," Reserva"]}),!i&&o.jsxs(U,{name:"Pacientes",className:"gap-4",children:[o.jsx("p",{className:"min-h-10 text-center p-2 border-b hover:bg-slate-300 transition-colors cursor-pointer",onClick:C}),f.length>0&&f.map(c=>o.jsx("p",{className:"min-h-10 text-center p-2 border-b hover:bg-slate-300 transition-colors cursor-pointer capitalize",onClick:C,children:c.nombre},c._id))]}),o.jsx(y,{placeholder:"Nombre",value:a.nombre,labelText:"Nombre",name:"nombre",type:"text",errors:p,onChange:t}),o.jsx(y,{value:a.horaInicio.split("T")[0],labelText:"Fecha",name:"horaInicio",type:"date",errors:p,onChange:A}),N?o.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los días domingos no se realizan reservas"}):null,u.length>0&&a.horaInicio&&o.jsx(o.Fragment,{children:o.jsx(W,{horasDisponibles:u,values:a,setMensaje:s,handleChange:t,reservasDelDia:T,errors:p})}),o.jsx(G,{values:a,handleChange:t,errors:p}),o.jsx(M,{value:a.observaciones,onChange:t,name:"observaciones",labelText:a.nombre==="admin"?"Compromisos separados por comas":"Observaciones"}),o.jsx(Q,{values:a}),o.jsx(S,{className:`${j?"opacity-65 cursor-not-allowed":""} font-bold text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent cursor-pointer`,tipo:"submit",texto:"Guardar",disabled:j})]})]})};export{te as default};
