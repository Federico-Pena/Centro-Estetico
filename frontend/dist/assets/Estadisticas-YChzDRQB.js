import{j as e,r as x,o as u,c as h,t as R,u as $,v as f,w as k}from"./index-YAdz76Jm.js";import{T as I}from"./TransitionNumber-nHdbKKCB.js";import{u as y}from"./useObserver-k1XNW9GD.js";import{f as N,b as v,u as C,a as D}from"./useLoaderContext-_SMLR0xo.js";import{u as E}from"./useForm-kpLBmbY3.js";import{B as j}from"./Button-qbGwCLcH.js";import{L as A}from"./LabelInput-iD2B8GI7.js";import{D as L}from"./Dropdown-UufBkZzb.js";const V=({cantidadEstados:s})=>{const r=Object.values(s).reduce((t,n)=>t+n);return s&&e.jsxs("article",{className:"grid gap-4 py-8 px-4 border border-black rounded-lg md:col-span-2 md:text-xl",children:[e.jsx("h2",{className:"font-betonga font-bold text-color-violeta text-xl text-center md:text-2xl",children:"Estados de reservas"}),e.jsxs("ul",{className:"grid gap-4 grid-cols-2",children:[Object.entries(s).map(([t,n])=>e.jsxs("li",{className:`text-center grid justify-center text-white rounded-lg ${t}`,children:[t," ",e.jsx(I,{to:n})]},t)),e.jsxs("li",{className:"grid w-full text-center text-white rounded-lg bg-color-violeta",children:["Total ",e.jsx("span",{children:r})]})]})]})},_=({horario:s,index:r})=>{const t=x.useRef(),{isVisible:n}=y(t);return e.jsxs("ul",{className:`${n?"animate-fadeIn":""} grid gap-2 p-4 pb-2 border border-black rounded-lg bg-color-logo font-semibold`,ref:t,children:[e.jsx("li",{className:"bg-color-violeta text-white rounded-full m-auto w-8 h-8 grid place-content-center",children:r+1}),e.jsxs("li",{className:"grid py-4 grid-flow-col justify-between border-b border-black ",children:[e.jsx("span",{children:"Día"}),s.dia]}),e.jsxs("li",{className:"grid py-4 grid-flow-col justify-between border-b border-black ",children:[e.jsx("span",{children:"Hora"}),s.hora]}),e.jsxs("li",{className:"text-end grid py-4 grid-flow-col justify-between ",children:[e.jsx("span",{children:"Reservas"}),s.cantidad]})]},s.dia+s.hora)},F=({horarios:s})=>s instanceof Array&&e.jsxs("article",{className:"grid grid-rows-[auto_1fr] grid-cols-2 gap-4 pt-8 md:col-span-4 text-color-violeta tracking-wider",children:[e.jsx("h2",{className:"font-betonga font-bold text-color-violeta text-xl text-center col-span-full md:text-2xl",children:"Horarios Más Solicitados"}),s.map((r,t)=>e.jsx(_,{horario:r,index:t},t))]}),z=({gananciasTotales:s,perdidasTotales:r,pendientesTotales:t})=>s&&e.jsxs("article",{className:"grid grid-cols-2 border gap-2 border-black text-color-violeta py-8 rounded-lg md:text-xl md:col-span-2",children:[e.jsxs("ul",{className:"text-center grid  items-center col-span-full",children:[e.jsx("li",{className:"font-betonga font-bold text-xl md:text-2xl ",children:"Pagas"}),e.jsxs("li",{className:"font-bold Pago m-auto p-2 rounded-xl text-white",children:["$ ",s.toLocaleString(u)]})]}),e.jsxs("ul",{className:"text-center grid  items-center",children:[e.jsx("li",{className:"font-betonga font-bold text-xl md:text-2xl",children:"Pendientes"}),e.jsxs("li",{className:"font-bold Pendiente m-auto p-2 rounded-xl text-white",children:["$ ",t.toLocaleString(u)]})]}),e.jsxs("ul",{className:"text-center grid  items-center",children:[e.jsx("li",{className:"font-betonga font-bold text-xl md:text-2xl",children:"Canceladas"}),e.jsxs("li",{className:"font-bold Cancelada m-auto p-2 rounded-xl text-white",children:["$ ",r.toLocaleString(u)]})]})]}),O=({servicio:s,index:r})=>{var a;const t=x.useRef(),{isVisible:n}=y(t);return e.jsxs("ul",{className:`${n?"animate-fadeIn":""} relative grid gap-2 p-4 pb-2 border border-black rounded-lg text-lg bg-color-logo font-semibold`,ref:t,children:[n&&e.jsx("img",{src:(a=s.imagen)==null?void 0:a.secure_url,alt:s.servicio,className:"aspect-square w-full object-cover h-52 rounded-lg"}),e.jsx("li",{className:"bg-color-violeta text-white rounded-full m-auto w-8 h-8 grid place-content-center",children:r+1}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 border-b border-black",children:["Servicio",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:s.servicio})]}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 border-b border-black ",children:["Tratamiento",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:s.tratamiento})]}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 border-b border-black ",children:["Sesiones",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:s.sesiones})]}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 justify-between",children:["Cantidad",e.jsxs("span",{className:"text-end text-nowrap overflow-auto",children:[" ",s.cantidad]})]})]})},P=({servicios:s})=>s&&e.jsxs("article",{className:"grid grid-rows-[auto_1fr] md:grid-cols-2 gap-4 pt-8 md:col-span-4 text-color-violeta",children:[e.jsx("h2",{className:"font-betonga font-bold text-xl text-center col-span-full md:text-2xl",children:"Servicios y Tratamientos Más Solicitados"}),s instanceof Array&&s.map((r,t)=>e.jsx(O,{index:t,servicio:r},t))]}),B=({mes:s,cantidadReservas:r,estados:t,pacienteMasReservas:n,servicioMasSolicitado:a,ganancias:c})=>{const o=x.useRef(),{isVisible:l}=y(o);return e.jsxs("section",{className:`${l?"animate-fadeIn":""} grid gap-2 w-full border border-black bg-color-logo  rounded-lg pt-4 px-2 font-bold [&>ul>li>span>svg]:text-red-600`,ref:o,children:[e.jsx("h3",{className:"grid text-center text-xl uppercase",children:s}),e.jsxs("ul",{className:"border-b border-black grid gap-4 p-4 ",children:[e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Reservas: ",e.jsx("span",{children:r||0})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Ganancias: ",e.jsxs("span",{children:["$ ",c.toLocaleString(u)||0]})]})]}),e.jsxs("ul",{className:"border-b border-black grid gap-4 p-4 ",children:[e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Paciente con mas reservas:"," ",e.jsx("span",{className:"capitalize",children:(n==null?void 0:n.nombre)||e.jsx(h,{})})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Cantidad: ",e.jsx("span",{children:(n==null?void 0:n.cantidad)||0})]})]}),e.jsxs("ul",{className:"border-b border-black grid gap-4 p-4 ",children:[e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Servicio mas solicitado:",e.jsx("span",{className:"capitalize",children:(a==null?void 0:a.servicio)||e.jsx(h,{})})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Tratamiento mas solicitado:",e.jsxs("span",{children:[" ",(a==null?void 0:a.tratamiento)||e.jsx(h,{})]})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Cantidad:",e.jsxs("span",{children:[" ",(a==null?void 0:a.cantidad)||e.jsx(h,{})]})]})]}),e.jsxs("ul",{className:"grid gap-4 p-4 ",children:[e.jsx("li",{className:"text-center font-bold",children:"Reservas"}),e.jsxs("li",{className:"Cancelada grid grid-flow-col justify-between rounded-md px-4 text-white py-2",children:["Canceladas: ",e.jsx("span",{children:t.Cancelada})]}),e.jsxs("li",{className:"Pendiente grid grid-flow-col justify-between rounded-md px-4 text-white py-2",children:["Pendientes ",e.jsx("span",{children:t.Pendiente})]}),e.jsxs("li",{className:"Pago grid grid-flow-col justify-between rounded-md px-4 text-white py-2",children:["Pagas: ",e.jsx("span",{children:t.Pago})]})]})]})},q=({datos:s})=>{const[r,t]=x.useState(window.innerWidth),n=Math.max(...s.map(a=>a.ganancias));return x.useEffect(()=>{const a=()=>{t(window.innerWidth)};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[]),s&&s.length>1&&e.jsxs("div",{className:"w-full grid grid-rows-[auto_1fr] gap-2 bg-color-logo rounded-lg p-4 pb-2 border border-black md:col-span-full md:grid-cols-12 md:h-80",children:[e.jsx("h2",{className:"text-lg font-semibold text-color-violeta font-betonga text-center col-span-full md:text-2xl",children:"Ingresos"}),n&&e.jsxs("small",{className:"absolute",children:["* Máximo $",n.toLocaleString(u)]}),s.map((a,c)=>e.jsxs("div",{className:"grid gap-2 relative md:grid-rows-[1fr_auto] md:items-end ",children:[e.jsx("div",{className:"bg-blue-500 text-xs text-white grid items-center rounded [&>span]:hover:opacity-100 [&>span]:hover:scale-100 h-8",style:r>768?{height:`${a.ganancias/n*100||0}%`}:{width:`${a.ganancias/n*100||0}%`},title:`$ ${a.ganancias}`,children:e.jsxs("span",{className:"absolute text-center opacity-0 scale-0 top-1/2 -translate-y-1/2 right-0 bg-color-violeta font-bold p-2 rounded-lg transition-[opacity_scale] md:right-1/2 md:translate-x-1/2 md:w-full",children:["$",a.ganancias]})}),e.jsx("p",{className:`text-xs text-gray-700 border-b border-black pb-2 ${c===s.length-1?"border-none":""} md:text-center md:border-none`,children:a.mes})]},a.mes))]})},w=()=>x.useContext(R),H=()=>{const{reservas:s}=w(),r=x.useRef();return x.useEffect(()=>{r.current&&r.current.scrollIntoView({behavior:"smooth",block:"start"})},[]),s instanceof Array&&e.jsxs("article",{className:"grid gap-2 col-span-full md:grid-cols-2  md:gap-4",ref:r,children:[e.jsx(q,{datos:s}),s.map(t=>e.jsx(B,{mes:t.mes,cantidadReservas:t.cantidadReservas,estados:t.estados,ganancias:t.ganancias,pacienteMasReservas:t.pacienteMasReservas,servicioMasSolicitado:t.servicioMasSolicitado},t.mes))]})},G=async s=>{const r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},t=v.estadisticas.reservas;return await N(t,r)},W=async(s,r)=>{const t={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},n=`${v.estadisticas.reservasAno}${r}`;return await N(n,t)},U=async(s,r,t)=>{const n={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},a=`${v.estadisticas.reservasMes}${r}/${t}`;return await N(a,n)},S=()=>{const{setLoading:s}=C(),{accessToken:r}=D(),{setMensaje:t}=$(),{dispatch:n}=w();return x.useEffect(()=>{(async()=>{s(!0);try{const l=await G(r),{status:i,error:d,datos:m}=l;i===200?n({type:f.SET_ESTADISTICAS_RESERVAS_TODAS,payload:m}):t(d||"Ocurrió un error el obtener las estadísticas de las reservas del año")}catch{t("Ocurrió un error el obtener las estadisticas de las reservas del año")}finally{s(!1)}})()},[n,t,r,s]),{obtenerReservasDelAno:async o=>{try{s(!0);const l=await W(r,o),{status:i,error:d,datos:m}=l;i===200?n({type:f.SET_ESTADISTICAS_RESERVAS,payload:m}):t(d||"Ocurrió un error el obtener las estadísticas de las reservas del año")}catch{t("Ocurrió un error el obtener las estadisticas de las reservas del año")}finally{s(!1)}},obtenerReservasDelMes:async(o,l)=>{try{s(!0);const i=await U(r,o,l),{status:d,error:m,datos:g}=i;d===200?n({type:f.SET_ESTADISTICAS_RESERVAS,payload:g}):t(m||"Ocurrió un error el obtener las estadísticas de las reservas del mes")}catch{t("Ocurrió un error el obtener las estadisticas de las reservas del mes")}finally{s(!1)}}}},J={year:""},K={year:{required:!0,minLength:4,maxLength:4}},Q=({setAno:s})=>{const{loading:r}=C(),{obtenerReservasDelAno:t}=S(),{errors:n,values:a,handleChange:c,validateForm:o,resetForm:l}=E(J,K),i=async d=>{d.preventDefault();const m=a.year;o()&&(s(m),await t(m),l())};return e.jsxs("form",{className:"grid gap-2 bg-color-verde-blanco border border-gray-300 shadow-lg p-4 rounded-lg md:col-start-2 md:col-end-4 ",children:[e.jsx(A,{errors:n,labelText:"Ingresa un Año",min:4,name:"year",onChange:c,type:"number",placeholder:2024,value:a.year,maxLength:4,minLength:4}),e.jsx(j,{bgColor:!0,className:"mt-4  w-full",disabled:r,tipo:"submit",texto:"Buscar",onClickFunction:i})]})},X={year:"",mes:""},Y={year:{required:!0,minLength:4,maxLength:4},mes:{required:!0}},Z=({setAno:s,setMes:r})=>{const{loading:t}=C(),{obtenerReservasDelMes:n}=S(),{errors:a,values:c,handleChange:o,validateForm:l,resetForm:i}=E(X,Y),d=async g=>{g.preventDefault();const p=c.year,b=c.mes;s(p),l()&&(await n(p,b),i())},m=(g,p)=>{const b=p.target.textContent;r(b),o({target:{name:g,value:b}})};return e.jsxs("form",{className:"grid gap-2 p-4 rounded-lg md:col-start-2 md:col-end-4 bg-color-verde-blanco border border-gray-300 shadow-lg",children:[e.jsx(A,{className:"mb-4",errors:a,labelText:"Ingresa un Año",min:4,name:"year",onChange:o,type:"number",placeholder:2024,value:c.year,maxLength:4,minLength:4}),e.jsx("label",{children:"Elige un mes"}),a.mes&&e.jsxs("small",{className:"text-red-600",children:["* ",a.mes]}),e.jsx(L,{name:"Meses",list:k,onClickFunction:g=>{m("mes",g)}}),e.jsx(j,{bgColor:!0,disabled:t,tipo:"submit",texto:"Buscar",onClickFunction:d,className:"mt-4 w-full"})]})},M=()=>{const[s,r]=x.useState(""),[t,n]=x.useState(""),[a,c]=x.useState(!1),{dispatch:o,reservas:l}=w(),i=()=>{o({type:f.SET_ESTADISTICAS_RESERVAS,payload:null})},d=()=>{r(""),n(""),i(),c(!a)};return e.jsxs("section",{className:"text-color-violeta flex flex-col gap-4 md:grid md:col-span-4 md:grid-cols-4",children:[e.jsxs("h2",{className:"text-xl font-bold font-betonga text-center grid col-span-full md:text-2xl ",children:["Datos del ",a?"mes":"año",e.jsxs("span",{className:"text-sm font-semibold text-gray-500 md:text-base",children:[t?`${t} de`:""," ",s]})]}),a?e.jsx(Z,{setAno:r,setMes:n}):e.jsx(Q,{setAno:r}),e.jsx(j,{className:"grid grid-flow-col gap-2 col-start-2 col-end-4 w-full",texto:`Buscar por ${a?"año":"mes"}`,onClickFunction:d}),l&&e.jsx(j,{tipo:"button",texto:"Limpiar",onClickFunction:i,className:"grid grid-flow-col gap-2 col-start-2 col-end-4 w-full"}),l&&e.jsx(H,{})]})},ce=()=>{const{reservasTodas:s}=w();return e.jsx("main",{className:"flex flex-col py-4 px-2",children:e.jsxs("section",{className:"grid gap-4 max-w-6xl m-auto w-full h-full md:grid-cols-4 md:gap-y-8",children:[e.jsx(z,{gananciasTotales:s.gananciasTotales,perdidasTotales:s.perdidasTotales,pendientesTotales:s.pendientesTotales}),e.jsx(V,{cantidadEstados:s.cantidadEstados}),e.jsx(F,{horarios:s.horarios}),e.jsx(P,{servicios:s.servicios}),e.jsx(M,{})]})})};export{ce as default};
