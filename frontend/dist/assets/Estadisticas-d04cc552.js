import{r as n,j as s,U as y,M as A}from"./index-015050c8.js";import{T as r}from"./TransitionNumber-09f03ba9.js";import{H as F,M as P,a as G}from"./constantes-122ae6b5.js";import{f as I}from"./fetchData-26851f92.js";function O(e){const i=Object.values(e).reduce((a,t)=>a+t.cantidad,0),o={};for(const a in e){const t=e[a].tratamiento,l=e[a].cantidad;o[t]=(l/i*100).toFixed(1)}const d=Object.entries(o).map(([a,t])=>({tratamiento:a,porcentaje:parseFloat(t)}));return d.sort((a,t)=>t.porcentaje-a.porcentaje),d}function N({datos:e}){const i=O(e),[o,d]=n.useState(!1);return n.useEffect(()=>{const a=setTimeout(()=>{d(!0)},300);return()=>clearTimeout(a)},[]),s.jsxs("article",{className:"porcentajes",children:[s.jsx("h3",{children:"Tratamientos Preferidos"}),s.jsx("ul",{className:`bar-chart ${o?"animate":""}`,children:i.map(({tratamiento:a,porcentaje:t})=>s.jsxs("li",{children:[a," ",t.toFixed(1)," %",s.jsx("div",{className:"bar",children:s.jsx("div",{className:"fill",style:{width:`${o?t:0}%`}})})]},a))})]})}const k=({estadisticasPacientes:e,tratamientosPacientes:i})=>s.jsxs("section",{className:"pacientesDatos",children:[s.jsx("h2",{children:"Datos de Pacientes"}),s.jsxs("ul",{className:"ulPacientesDatos",children:[s.jsxs("li",{children:["Pacientes",s.jsx("strong",{children:s.jsx(r,{from:0,to:e.totalPacientes,duration:2e3})})]}),s.jsxs("li",{children:["Promedio De Edad",s.jsxs("strong",{children:[s.jsx(r,{from:0,to:e.promedioDeEdades,duration:2e3})," ",s.jsx("span",{children:" años"})]})]})]}),s.jsx("section",{className:"pacientesPorcentaje",children:s.jsx(N,{datos:i})})]}),w={estadosMes:{reservasCanceladas:0,reservasPendientes:0,reservasTerminadas:0,reservasTodas:0},estadosTodas:{reservasCanceladas:0,reservasPendientes:0,reservasTerminadas:0,reservasTodas:0}};function f(e){return e>=1&&e<=12?P[e-1]:"Mes no válido"}const L=()=>{var u;const[e,i]=n.useState(F.split("-")[1]),[o,d]=n.useState({totalPacientes:0,promedioDeEdades:0}),[a,t]=n.useState(w),[l,E]=n.useState({}),[g,S]=n.useState({}),[m,M]=n.useState({totales:0,mes:0}),{accessToken:x}=n.useContext(y),{setMensaje:h}=n.useContext(A);return n.useEffect(()=>{const c=`${G.estadisticas.estadisticas}${e}`,j={headers:{"Content-Type":"application/json",Authorization:`Bearer ${x||""}`}};(async()=>{await I(c,j,C=>{const{estadisticasPaciente:v,estadosMes:D,estadosTodas:R,reservaMotivo:$,gananciasReservas:b,error:p}=C;p?h(p):(M(b),t({estadosMes:D,estadosTodas:R}),d(v),E(v.tratamientosPacientes),S($))})})()},[x,e,h]),s.jsxs("main",{className:"mainEstadisticas",children:[s.jsx(k,{estadisticasPacientes:o,tratamientosPacientes:l}),s.jsxs("section",{className:"reservasEstadisticas",children:[s.jsx("h2",{children:"Datos de Reservas"}),s.jsxs("article",{className:"reservasEstadisticasArticle",children:[s.jsx("h3",{children:"Reservas del mes"}),s.jsxs("select",{className:"selectMeses",value:e,onChange:c=>i(c.target.value),children:[s.jsx("option",{value:e,children:`${f(e)}`},e),P.map((c,j)=>c!==`${f(e)}`&&s.jsx("option",{value:j+1,children:c},c))]}),s.jsxs("ul",{className:"ulReservasDatos",children:[s.jsxs("li",{children:["Ganancias",s.jsxs("strong",{children:["$ ",s.jsx(r,{from:0,to:m.mes,duration:500})]})]}),s.jsxs("li",{children:["Todas",s.jsx("strong",{children:s.jsx(r,{from:0,to:(u=a.estadosMes)==null?void 0:u.reservasTodas,duration:500})})]}),s.jsx(T,{datos:a.estadosMes})]})]}),s.jsxs("article",{className:"reservasEstadisticasArticle",children:[s.jsx("h3",{children:"Total de las Reservas"}),s.jsxs("ul",{className:"ulReservasDatos",children:[s.jsxs("li",{children:["Ganancias",s.jsxs("strong",{children:["$ ",s.jsx(r,{from:0,to:m.totales,duration:500})]})]}),s.jsxs("li",{children:["Todas",s.jsx("strong",{children:s.jsx(r,{from:0,to:a.estadosTodas.reservasTodas,duration:500})})]}),s.jsx(T,{datos:a==null?void 0:a.estadosTodas})]})]}),s.jsx(N,{datos:g})]})]})},T=({datos:e})=>s.jsxs(s.Fragment,{children:[s.jsxs("li",{className:"Pago",children:["Terminadas",s.jsx("strong",{children:s.jsx(r,{from:0,to:e.reservasTerminadas,duration:500})})]}),s.jsxs("li",{className:"Pendiente",children:["Pendientes",s.jsx("strong",{children:s.jsx(r,{from:0,to:e.reservasPendientes,duration:500})})]}),s.jsxs("li",{className:"Cancelada",children:["Canceladas",s.jsx("strong",{children:s.jsx(r,{from:0,to:e.reservasCanceladas,duration:500})})]})]});export{L as default};
