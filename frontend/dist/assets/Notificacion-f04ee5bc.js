import{r as s,M as Y,U as _,j as e,B as M}from"./index-cf9ec04b.js";import{E as y,h as J,b as T,f as k,H as W,d as Z,e as ee,L as ae,a as se}from"./FormularioReserva-07bb3ef5.js";import{B as te}from"./BotonPrimario-90c17ac2.js";const ne=(a,i,o)=>{if(a.target.className.includes(y.pendiente)||a.target.className.includes(y.pago))return!1;const l=a.target.textContent,r=i+" "+l,t=new Date(r);t.setMinutes(t.getMinutes()+30);const n=J(t);return!o.filter(p=>p.fecha===new Date(i).toISOString()&&(p.hora.includes(n)||p.horaFin.includes(n))).find(p=>p.estado===y.pago||p.estado===y.pendiente)};function q(a,i){if(a&&i){const o=a.fecha.split("T")[0],l=i.fecha.split("T")[0],r=new Date(`${o}T${a.hora}`),t=new Date(`${l}T${i.hora}`);return r>t?-1:r<t?1:0}}const oe=a=>{const[i,o]=s.useState([]),[l,r]=s.useState(null),[t,n]=s.useState(!1),[c,f]=s.useState([]),[p,N]=s.useState(1),[P,v]=s.useState(0),[$,C]=s.useState(1),{setMensaje:S}=s.useContext(Y),{accessToken:u}=s.useContext(_);s.useEffect(()=>{p&&(async()=>{n(!0);const m={headers:{"Content-Type":"application/json",Authorization:`Bearer ${u||""}`}},j=`${T.paciente.nombres}/${p}`,x=await fetch(j,m),{pacientes:b,page:F,totalPages:O,totalPacientes:z}=await x.json();v(z),C(O),N(F),b.length?f(b.sort((I,g)=>I.nombre.toLowerCase()<g.nombre.toLowerCase()?-1:1)):f([]),n(!1)})()},[u,p]),s.useEffect(()=>{const d={headers:{"Content-Type":"application/json",Authorization:`Bearer ${u||""}`}};a&&(async()=>{n(!0);const j=`${T.reservas.deUnPaciente}${a}`;try{const x=await fetch(j,d);if(x.ok){const b=await x.json();o(b.sort(q))}}catch(x){console.log(x)}n(!1)})()},[u,a]);const w={headers:{"Content-Type":"application/json",Authorization:`Bearer ${u||""}`}};return{setPaciente:r,agregarPaciente:d=>{if(d.error){S(d.mensaje);return}d.totalReservas=0,f([...c,d].sort((j,x)=>j.nombre.toLowerCase()<x.nombre.toLowerCase()?-1:1)),v(j=>j+1);const m=`Paciente nuevo ${d.nombre}.`;S(m)},getPaciente:async d=>{if(r(null),n(!0),d){const m=c.find(F=>F.nombre===d),j=`${T.paciente.porId}${m._id}`,b=await(await fetch(j,w)).json();r(b)}else r(null);n(!1)},eliminarPaciente:d=>{const{mensaje:m,userExistente:j}=d;S(m),console.log(d);const x=c.filter(b=>b._id!==j._id).sort((b,F)=>b.nombre.toLowerCase()<F.nombre.toLowerCase()?-1:1);f(x)},actualizarReservaPaciente:d=>{const{reserva:m}=d,j=`Reserva nueva de ${m.pacienteNombre}. El dia ${k({fecha:m.fecha.split("T")[0]})} a las ${m.hora}`,x=i.filter(b=>b._id!==m._id);S(j),o(x.concat(m).sort(q))},eliminarReservaPaciente:d=>{const{reserva:m}=d,j=i.filter(b=>b._id!==m._id),x=`Reserva eliminada de ${m.pacienteNombre}. El dia ${k({fecha:m.fecha.split("T")[0]})} a las ${m.hora}`;S(x),o(j.sort(q))},reservasPaciente:i,nombres:c,paciente:l,loading:t,setNombres:f,editarPaciente:d=>{const m={_id:d._id,nombre:d.nombre,foto:{secure_url:d.foto.secure_url},totalReservas:0},j=c.filter(b=>b._id!==d._id);console.log(d),console.log(j),f([...j,m]);const x=`Paciente nuevo ${d.nombre}.`;S(x),r(null)},setReservasPaciente:o,pagina:p,setPagina:N,totalPaginas:$,totalPacientes:P}},B=async(a,i,o)=>{try{const r=await(await fetch(a,i)).json();return o(r),r}catch(l){return o(l),l}};const G=({from:a,to:i,duration:o=1e3})=>{const[l,r]=s.useState(a),t=s.useRef(i);return s.useEffect(()=>{let n,c;const f=t.current,p=N=>{n||(n=N);const P=N-n,v=Math.min(1,P/o),$=Math.floor(f+(i-f)*v);r($),v<1&&(c=requestAnimationFrame(p))};return i!==f&&(t.current=i,n=null,c=requestAnimationFrame(p)),()=>cancelAnimationFrame(c)},[a,i,o]),e.jsx("span",{children:l})},re=({nombres:a,onChangeNombre:i,pagina:o,totalPaginas:l,setPagina:r,totalPacientes:t})=>e.jsxs("div",{className:"selectNombre-container",children:[e.jsxs("div",{className:"encabezado",children:[e.jsxs("strong",{children:["Pacientes:"," ",e.jsx(G,{from:0,to:t,duration:2e3})]}),e.jsxs("strong",{children:["Páginas:"," ",e.jsx(G,{from:0,to:l,duration:1e3})]}),e.jsxs("strong",{children:["Página actual:"," ",e.jsx(G,{from:1,to:o,duration:200})]})]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsx(M,{tipo:"button",className:"pagination-buttons-Anterior",texto:"Anterior",onClickFunction:()=>o>1&&r(o-1)}),e.jsx(M,{tipo:"button",className:"pagination-buttons-Siguiente",onClickFunction:()=>o!==l&&r(o+1),texto:"Siguiente"})]}),a.length>0&&a.map((n,c)=>e.jsxs("div",{className:n.nombre==="admin"||n.pacienteNombre==="admin"?"selectNombre-option admin":"selectNombre-option",onClick:()=>i(n.nombre||n.pacienteNombre),children:[e.jsx("img",{src:n.foto.secure_url,alt:n.nombre||n.pacienteNombre,className:"imagen"}),e.jsx("span",{className:"nombre",children:n.nombre||n.pacienteNombre}),e.jsxs("span",{className:"numero",children:["Numero de reservas: ",n.totalReservas]})]},c))]}),ie=re,ce=({reserva:a,setForm:i,editar:o,actualizarReserva:l})=>{const[r,t]=s.useState(a.fecha||W.split("T")[0]),[n,c]=s.useState([]),[f,p]=s.useState(a.motivo),[N,P]=s.useState(a.observaciones),[v,$]=s.useState(a.hora||""),[C,S]=s.useState(a.pacienteNombre),[u,w]=s.useState(!1),[A,K]=s.useState([]),D=s.useRef(),{setMensaje:L}=s.useContext(Y),{accessToken:H}=s.useContext(_),{nombres:Q,pagina:d,setPagina:m,totalPacientes:j,totalPaginas:x}=oe(),b=()=>{D.current.parentElement.classList.add("animationOut"),setTimeout(()=>{i()},300)};s.useEffect(()=>{D.current.scrollIntoView({behavior:"smooth",block:"start"}),r&&(async()=>{const h=await fetch(`${T.reservas.deUnDia}${r}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${H||""}`}}),{data:R}=await h.json();c(R)})()},[r,H,a]),s.useEffect(()=>{const h=Z(r,n).find(R=>R.dia.getDay()===new Date(`${r} ${v}`).getDay());K(h==null?void 0:h.horaID)},[r,n,v]);const F=g=>{$(g.target.textContent),ne(g,r,n)||(L("Hora no disponible para hacer una reserva"),$(""))},O=async g=>{g.preventDefault(),w(!0);const h=D.current,R=new Date(`${h.fecha.value.split("T")[0]} ${v}`);R.setMinutes(R.getMinutes()+30);const E={pacienteNombre:h.pacienteNombre.value,fecha:h.fecha.value,hora:v,horaFin:J(R),motivo:h.motivo?h.motivo.value:void 0,observaciones:h.observaciones.value};if(E.pacienteNombre.trim()&&E.hora&&E.fecha){const V={method:"POST",body:JSON.stringify(E),headers:{"Content-Type":"application/json",authorization:`Bearer ${H}`}};await B(`${T.reservas.agregar}`,V,l),h.classList.add("formOut"),i()}else L("Faltan campos");w(!1)},z=async g=>{g.preventDefault(),w(!0);const h=D.current,R=new Date(`${h.fecha.value.split("T")[0]} ${v}`);R.setMinutes(R.getMinutes()+30);const E={_id:a._id,pacienteNombre:h.pacienteNombre.value,fecha:h.fecha.value,hora:v,horaFin:J(R),motivo:h.motivo?h.motivo.value:void 0,observaciones:h.observaciones.value};if(E.pacienteNombre.trim()&&E.hora&&E.fecha){const V=`${T.reservas.editar}${E._id}`,X={method:"PUT",body:JSON.stringify(E),headers:{"Content-Type":"application/json",authorization:`Bearer ${H}`}};await B(V,X,l),i()}else L("Faltan campos");w(!1)},I=g=>{S(g)};return e.jsxs("section",{className:"formReservaContainer",children:[e.jsx(M,{className:"cerrarForm",texto:"Cerrar Formulario",onClickFunction:b,tipo:"button"}),e.jsxs("form",{onSubmit:o?z:O,className:"formReserva",ref:D,children:[e.jsx("h3",{children:"Reserva"}),!C=="admin"||!a.pacienteNombre&&e.jsx(ie,{totalPacientes:j,totalPaginas:x,nombres:Q,pagina:d,setPagina:m,onChangeNombre:I}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"pacienteNombre",children:"Nombre"}),e.jsx("input",{id:"pacienteNombre",type:"text",name:"pacienteNombre",defaultValue:C,disabled:!!C,required:!0})]}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"fecha",children:"Fecha"}),e.jsx("input",{id:"fecha",type:"date",name:"fecha",required:!0,disabled:!(C==="admin"||a.pacienteNombre),defaultValue:a.fecha||W.split("T")[0],onChange:g=>{const h=g.target.value.split("T")[0];t(h)}})]}),(A==null?void 0:A.length)>0&&e.jsx("div",{className:"input",children:e.jsx(ee,{horas:A,onClickReservar:F})}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"observaciones",children:C==="admin"?"Tareas. Separadas por comas":"Observaciones"}),e.jsx("input",{defaultValue:a.observaciones,id:"observaciones",type:"text",name:"observaciones",onChange:g=>P(g.target.value)})]}),C==="admin"?null:e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"motivo",children:"Motivo"}),e.jsxs("select",{name:"motivo",onChange:g=>p(g.target.value),children:[e.jsx("option",{defaultValue:a.motivo,children:a.motivo?a.motivo:""}),e.jsx("option",{value:"Drenaje Linfático",children:"Drenaje Linfático"}),e.jsx("option",{value:"Masaje Estético",children:"Masaje Estético"}),e.jsx("option",{value:"Exfoliación Corporal",children:"Exfoliación Corporal"}),e.jsx("option",{value:"Masaje Cérvico-Craneal",children:"Masaje Cérvico-Craneal"}),e.jsx("option",{value:"Masaje Con Piedras Calientes",children:"Masaje Con Piedras Calientes"}),e.jsx("option",{value:"Masaje Descontracturante",children:"Masaje Descontracturante"}),e.jsx("option",{value:"Masaje Relajante",children:"Masaje Relajante"}),e.jsx("option",{value:"Masaje Prenatal",children:"Masaje Prenatal"}),e.jsx("option",{value:"Barras De access",children:"Barras De Access"})]})]}),e.jsxs("div",{className:"input",children:[C&&e.jsxs("span",{className:"spanHora",children:["Nombre ",e.jsx("strong",{children:C})]}),r&&e.jsxs("span",{className:"spanHora",children:["Dia ",e.jsx("strong",{children:k({fecha:r})})]}),v&&e.jsxs("span",{className:"spanHora",children:["Hora ",e.jsx("strong",{children:v})]}),N&&e.jsxs("span",{className:"spanHora",children:["Observaciones",e.jsx("strong",{children:N})]}),f&&e.jsxs("span",{className:"spanHora",children:["Motivo ",e.jsx("strong",{children:f})]})]}),e.jsx(te,{tipo:"submit",className:"submitAdmin",texto:u?e.jsx(ae,{}):"Guardar"})]})]})};const le=({titulo:a,mensaje:i,onConfirm:o,onCancel:l})=>{const r=s.useRef();return s.useEffect(()=>{r.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",ref:r,children:[e.jsx("h3",{children:a}),e.jsx("p",{children:i}),e.jsxs("div",{children:[e.jsx("button",{onClick:o,children:"Confirmar"}),e.jsx("button",{onClick:l,children:"Cancelar"})]})]})})},U=[y.pendiente,y.cancelada,y.pago];function de(a){const i=U.indexOf(a);if(i!==-1){const o=(i+1)%U.length;return U[o]}else return}const ue=({actualizarReserva:a,reserva:i,cerrarReserva:o,setForm:l,setModal:r})=>{const[t,n]=s.useState(i),c=s.useRef(),{accessToken:f}=s.useContext(_),{setMensaje:p}=s.useContext(Y),N=async()=>{const $=de(t.estado),C=`${T.reservas.editarEstado}${t._id}`,S={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${f}`},body:JSON.stringify({estado:$})};await B(C,S,u=>{a(u),n(u.reserva),p(u.mensaje)})},P=()=>{o(c)},v=()=>{l(t)};return e.jsx(e.Fragment,{children:e.jsxs("article",{className:"containerReserva",ref:c,children:[e.jsx("div",{className:`reserva-container-titulo  ${t.estado}`,children:e.jsx("h3",{children:"Detalles de la reserva"})}),e.jsxs("div",{className:`reserva-container-cuerpo  ${t.estado}`,children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Paciente: ",e.jsx("strong",{children:t.pacienteNombre})]}),e.jsxs("li",{children:["Fecha:",e.jsx("strong",{children:k(t)})]}),e.jsxs("li",{children:["Hora: ",e.jsx("strong",{children:t.hora})]}),t.pacienteNombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Motivo: ",e.jsx("strong",{children:t.motivo})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("strong",{children:t.observaciones})]}),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:t.estado})]})]})]}),t.pacienteNombre==="admin"&&e.jsxs("ul",{className:"tareasAdmin",children:[e.jsx("li",{children:"Lista:"}),t.observaciones.split(",").map($=>e.jsx("li",{className:"liTarea",children:e.jsx("span",{children:$})},$)),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:t.estado})]})]})]}),e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(M,{texto:"Editar",className:"btnEditar",onClickFunction:v}),e.jsx(M,{texto:"Cambiar Estado",className:`btnCompletada ${t.estado}`,onClickFunction:N})]}),o?e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(M,{texto:"Cerrar",className:"btnCerrarReserva",onClickFunction:P,tipo:"button"}),e.jsx(M,{texto:"Eliminar",className:"btnCerrar Cancelada",onClickFunction:()=>r(t)})]}):e.jsx("div",{className:"reserva-container-botones",children:e.jsx(M,{texto:"Eliminar",className:"btnCerrar",onClickFunction:()=>r(t)})})]})})};const je=({reservas:a,actualizarReservas:i,actualizarReservaEliminada:o,cerrarReserva:l,className:r})=>{const[t,n]=s.useState(!1),[c,f]=s.useState(!1),[p,N]=s.useState(!1),{accessToken:P}=s.useContext(_),v=u=>{n(!0),f(u)},$=async()=>{const u=`${T.reservas.eliminar}${c._id}`,w={method:"DELETE",headers:{authorization:`Bearer ${P}`}};await B(u,w,o),N(!1)},C=()=>{N(!1)},S=u=>{console.log(u),f(u),N(!0)};return t?e.jsx(ce,{editar:!0,reserva:{...c,fecha:c.fecha.split("T")[0],nombre:c.pacienteNombre},actualizarReserva:u=>{f(u.reserva),i(u)},setForm:()=>{n(!1)}}):p?e.jsx(le,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${c.pacienteNombre} el dia ${k(c)} a las ${c.hora}?`,onConfirm:$,onCancel:C}):e.jsx("section",{className:`ContenedorReservas ${r||""}`,children:(a==null?void 0:a.length)>0&&a.map(u=>e.jsx(ue,{setModal:S,setForm:v,cerrarReserva:l,actualizarReservaEliminada:o,actualizarReserva:i,reserva:u},u._id))})},me=()=>{const[a,i]=s.useState([]),{accessToken:o}=s.useContext(_);return s.useEffect(()=>{o&&(async()=>{let r=se.toISOString().split("T")[0];const t={headers:{"Content-Type":"application/json",Authorization:`Bearer ${o||""}`}};try{const n=`${T.publicas.fechasHorasReservadasDeLaSemana}${r}`;await B(n,t,c=>{i(c.reservas)})}catch(n){console.log(n)}})()},[o]),{reservasSemanales:a}},xe=()=>{const{isAllowedAccess:a}=s.useContext(_),{reservasSemanales:i}=me();return s.useEffect(()=>{"Notification"in window&&a&&i.forEach(o=>{const l=new Date(`${o.fecha.split("T")[0]} ${o.hora}`),t=(l-new Date)/(24*60*60*1e3),n={body:"Mensaje de Prueba",icon:"/assets/icons/icon-192.png",vibrate:[200,100,200],tag:"notificacion"};t===1&&setTimeout(()=>{new Notification("Recordatorio",n).addEventListener("click",()=>{window.location.href="https://www.masajistanataliapena.com/#/calendario"})},l-new Date)})},[a]),null};export{je as C,ce as F,xe as N,ie as S,G as T,le as a,ne as c,B as f,q as o,oe as u};
