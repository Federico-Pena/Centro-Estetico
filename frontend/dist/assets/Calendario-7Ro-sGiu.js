import{Q as A,V as L,W as $,X as F,Y as M,Z as U,f as B,a as P,r as c,_ as R,T as w,U as T,l as _,k as S,n as b,j as e,B as E,g as O,E as l,e as k,$ as C,i as Z,a0 as z,R as N}from"./index-rKMOL2j9.js";import{L as Y}from"./LoaderChico-f-07DJwF.js";import{f as G}from"./formatHoraUser-TJ92Iw1g.js";import{C as Q}from"./ContenedorReservas-5187YOyA.js";const I=6,W=0,X=(t,a,s)=>!(t===20&&a===30)&&!(s.getDay()===I&&t===12&&a===30)&&s.getDay()!==W,q=t=>{const a=new Date(t);return Number.isNaN(a.getTime())?[]:(a.setDate(a.getDate()-a.getDay()),Array.from({length:A},(o,i)=>{const r=new Date(a),p=[],g=r.getDay()===I?L:$;r.setDate(a.getDate()+i);for(let u=U;u<=g;u++)for(let x=0;x<F;x+=M)if(X(u,x,r)){const m=new Date(r);m.setHours(u,x,0),p.push(m)}return{dia:r,horas:p}}))},J=async(t,a)=>{const s={headers:{"Content-Type":"application/json",Authorization:`Bearer ${t||""}`}},o=`${P.reservas.deLaSemana}${a}`;return await B(o,s)},K=()=>{const[t,a]=c.useState(R.split("T")[0]),{setMensaje:s}=c.useContext(w),{accessToken:o}=c.useContext(T),{setLoading:i}=c.useContext(_),{dispatch:r}=c.useContext(S),p=q(t);return c.useEffect(()=>{t&&(async()=>{i(!0);const d=await J(o,t),{datos:v,error:f,status:D}=d;D===200?r({type:b.SET_RESERVAS,payload:v}):v?s(f||"Ocurrió un error al obtener las reservas de la semana"):r({type:b.SET_RESERVAS,payload:[]}),i(!1)})()},[o,s,t,r,i]),{semanaAnterior:()=>{const n=new Date(`${t} 00:00:00.000Z`);n.setDate(n.getDate()-A);const d=n.toISOString().split("T")[0];a(d)},semanaSiguiente:()=>{const n=new Date(`${t} 00:00:00.000Z`);n.setDate(n.getDate()+A);const d=n.toISOString().split("T")[0];a(d)},diasSemana:p,setSeleccionadas:n=>{r({type:b.SET_RESERVAS_SELECCIONADAS,payload:n})},seleccionarDia:n=>{a(n)}}},y=({loading:t,semanaAnterior:a,semanaSiguiente:s})=>e.jsxs("section",{className:"flex justify-between border-t border-black p-2",children:[e.jsx(E,{className:"font-bold  max-w-fit h-max text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md grid place-content-center py-2 px-4 transition-colors hover:text-color-violeta hover:bg-slate-50 md:mx-0",onClickFunction:a,texto:"Anterior",tipo:"button"}),t&&e.jsx(Y,{className:"self-center"}),e.jsx(E,{className:"col-start-3 col-end-4 font-bold  max-w-fit h-max text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md grid place-content-center py-2 px-4 transition-colors hover:text-color-violeta hover:bg-slate-50 md:mx-0",onClickFunction:s,texto:"Siguiente",tipo:"button"})]}),ee=({horas:t,reservarHora:a})=>{const{reservas:s}=c.useContext(S);return e.jsx("ul",{className:"grid gap-2",children:t.map((o,i)=>{const r=O(o,s);return e.jsx("li",{"data-fecha":r.id,onClick:a,className:`${r.reservaAdmin&&"outline outline-2 outline-color-violeta px-1 horaAdmin"} ${te(i,r)} text-center rounded-md cursor-pointer hover:scale-105 transition-transform`,children:G(o)},o)})})},ae=t=>t===l.pendiente?"bg-color-pendiente text-white":t===l.pago?"bg-color-paga text-white":t===l.cancelada?"bg-color-cancelada text-white":"",te=(t,a)=>t==0||t==1?"outline outline-2 outline-color-violeta px-1 horaAdmin":ae(a.estado),se=({diasSemana:t,reservarHora:a})=>e.jsx("section",{className:"grid grid-cols-3 md:grid-cols-6 border-t border-black",children:t.map(s=>{const o=new Date(s.dia);return o.getDay()!==0&&e.jsxs("div",{className:"grid grid-rows-[50px,1fr] p-2 gap-4",children:[e.jsx("h3",{className:`grid place-content-center text-center capitalize text-md p-2 text-color-violeta font-betonga font-bold tracking-wide text-pretty rounded ${o.getDate()===new Date().getDate()&&o.getDay()===new Date().getDay()?"bg-color-verde-blanco":""}`,children:k(s.dia)}),e.jsx(ee,{horas:s.horas,reservarHora:a})]},o)})}),oe=({handleSeleccionarDia:t})=>e.jsxs("section",{className:"grid gap-x-4",children:[e.jsxs("h1",{onClick:()=>t(R.split("T")[0]),className:"capitalize p-4 text-xl bg-color-verde-blanco text-center text-color-violeta cursor-pointer rounded-t-lg font-betonga font-bold",children:["Hoy ",k(R)]}),e.jsxs("label",{htmlFor:"fecha",className:"justify-center items-center flex flex-col gap-4 py-4",children:["Seleccionar día"," ",e.jsx("input",{type:"date",className:"border text-center px-4 py-2 rounded-lg",id:"fecha",onChange:a=>{const s=a.target.value;s&&t(s)}})]})]});function re(t){const a=t.reduce((s,o)=>(o.estado===l.pago?s.terminadas++:o.estado===l.cancelada?s.canceladas++:o.estado===l.pendiente&&s.pendientes++,s),{terminadas:0,canceladas:0,pendientes:0});return{reservasCanceladas:a.canceladas,reservasPendientes:a.pendientes,reservasTerminadas:a.terminadas,reservasTodas:a.canceladas+a.pendientes+a.terminadas}}function ne({setSeleccionadas:t}){const[a,s]=c.useState(!1),{reservas:o}=c.useContext(S),{reservasCanceladas:i,reservasPendientes:r,reservasTerminadas:p,reservasTodas:g}=re(o),u=n=>{if(n==="Todas")t(o);else{const d=o.filter(v=>v.estado===n);t(d)}},x=()=>{s(!a)},m=n=>{const d=n.currentTarget.id;u(d)};return e.jsxs("div",{className:"m-auto w-full max-w-4xl flex flex-col items-center gap-4 mb-4",children:[e.jsx(E,{className:"text-white w-fit h-fit self-center font-bold bg-color-violeta border-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent",tipo:"button",texto:`${a?"Ocultar Contador":"Mostrar Contador"}`,onClickFunction:x}),e.jsxs("section",{className:`w-full flex flex-wrap gap-4 [&>div]:flex-1 [&>div]:p-3 [&>div]:text-center [&>div]:rounded-md [&>div]:cursor-pointer [&>div]:transition-colors [&>div]:text-white [&>div]:font-betonga [&>div]:tracking-wider [&>div]:border hover:[&>div]:bg-slate-200 hover:[&>div]:text-color-violeta ${a?"opacity-100 h-auto max-h-[500px] transition-[opacity_max-height] pointer-events-auto":"opacity-0  max-h-0 transition-[opacity_max-height] pointer-events-none"}`,children:[e.jsxs("div",{id:l.pendiente,className:l.pendiente,onClick:m,children:[e.jsx("p",{className:"font-bold",children:"Pendientes"}),e.jsx("strong",{className:"text-2xl",children:r})]}),e.jsxs("div",{id:l.cancelada,className:l.cancelada,onClick:m,children:[e.jsx("p",{className:"font-bold",children:"Canceladas"}),e.jsx("strong",{className:"text-2xl",children:e.jsx(C,{to:i})})]}),e.jsxs("div",{id:l.pago,className:l.pago,onClick:m,children:[e.jsx("p",{className:"font-bold",children:"Pagas"}),e.jsx("strong",{className:"text-2xl",children:e.jsx(C,{to:p})})]}),e.jsxs("div",{id:"Todas",className:"border-slate-400",onClick:m,children:[e.jsx("p",{className:"font-bold text-color-violeta",children:"Todas"}),e.jsx("strong",{className:"text-2xl text-color-violeta",children:e.jsx(C,{to:g})})]})]})]})}function me(){const{setMensaje:t}=c.useContext(w),{loading:a}=c.useContext(T),{loading:s}=c.useContext(_),{reservas:o,dispatch:i,seleccionadas:r}=c.useContext(S),{semanaAnterior:p,semanaSiguiente:g,diasSemana:u,setSeleccionadas:x,seleccionarDia:m}=K(),n=()=>{x([])},d=Z(),v=f=>{const D="admin",H=f.target.getAttribute("data-fecha"),h=O(new Date(`${H}`),o),V=h.estado&&h.estado!==l.cancelada||h.proximaHoraNoDisponible;if(h.estado&&x(h.reservadas),V){t("Hora no disponible para hacer una reserva");return}if(f.target.className.includes("horaAdmin")){const j={horario:{horaInicio:h.id},paciente:{nombre:D}};i({type:b.SET_RESERVA,payload:j}),d(N.admin.agregarReserva,{state:{from:N.admin.calendario}})}else{const j={horario:{horaInicio:h.id}};i({type:b.SET_RESERVA,payload:j}),d(N.admin.agregarReserva,{state:{from:N.admin.calendario}})}};return e.jsxs(e.Fragment,{children:[a&&e.jsx(z,{}),(r==null?void 0:r.length)>0?e.jsx(Q,{reservas:r,cerrarReserva:n}):null,e.jsxs("main",{className:"grid py-8 px-2 w-full ",children:[e.jsx(ne,{setSeleccionadas:x}),e.jsxs("article",{className:"max-w-4xl grid  mx-auto border rounded-lg border-black",children:[e.jsx(oe,{handleSeleccionarDia:m}),e.jsx(y,{loading:s,semanaAnterior:p,semanaSiguiente:g}),e.jsx(se,{diasSemana:u,reservarHora:v}),e.jsx(y,{loading:s,semanaAnterior:p,semanaSiguiente:g})]})]})]})}export{me as default};
