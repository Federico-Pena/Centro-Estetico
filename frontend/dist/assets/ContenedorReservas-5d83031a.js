import{r as t,M as w,U as E,j as e,B as P}from"./index-015050c8.js";import{L as V,d as re,f as U,c as ie}from"./diasSemanaConHoras-89f7742d.js";import{a as C,E as F,f as I,H as Y}from"./constantes-122ae6b5.js";import{f as y}from"./fetchData-26851f92.js";import{B as K}from"./BotonPrimario-387205b8.js";function L(s,i){if(s&&i){const c=new Date(s.horario.horaInicio),d=new Date(i.horario.horaInicio);return c>d?-1:c<d?1:0}}const ce=s=>{const[i,c]=t.useState([]),[d,r]=t.useState([]),[a,o]=t.useState(!1),{setMensaje:n}=t.useContext(w),{accessToken:m}=t.useContext(E);return t.useEffect(()=>{const h={headers:{"Content-Type":"application/json",Authorization:`Bearer ${m||""}`}};s&&(async()=>{o(!0);const l=`${C.reservas.deUnPaciente}${s}`;try{const x=await fetch(l,h);if(x.ok){const u=await x.json();c(u.sort(L))}}catch(x){console.log(x)}finally{o(!1)}})()},[m,s]),{setPacientes:r,getPaciente:async h=>{const j={headers:{"Content-Type":"application/json",Authorization:`Bearer ${m||""}`}};if(r([]),o(!0),h){const l=`${C.paciente.porNombre}${h}`,u=await(await fetch(l,j)).json(),{error:v,pacientes:$}=u;v&&n(v),r($)}else r([]);o(!1)},actualizarReservaPaciente:h=>{const j=i.filter(l=>l._id!==h._id);c(j.concat(h).sort(L))},eliminarReservaPaciente:h=>{const{reserva:j,mensaje:l,error:x}=h;if(x)n(x);else{const u=i.filter(v=>v._id!==j._id);n(l),c(u.sort(L))}},reservasPaciente:i,pacientes:d,loading:a,setReservasPaciente:c}};const le=s=>{const[i,c]=t.useState(1),[d,r]=t.useState(null),[a,o]=t.useState([]),[n,m]=t.useState(!1),{setMensaje:f}=t.useContext(w),{accessToken:p}=t.useContext(E);return t.useEffect(()=>{s&&(async()=>{if(m(!0),s.length<1){f("Dos letras como mínimo"),m(!1),o([]);return}const h={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}},j=`${C.paciente.nombres}${i}?nombre=${s}`,x=await(await fetch(j,h)).json();if(x.error)f(x.error);else{const{pacientes:u,page:v,totalPages:$}=x;u&&u.length>0?(r($),c(v),o(u.sort((R,T)=>R.nombre.toLowerCase()<T.nombre.toLowerCase()?-1:1))):(f("No se encontraron pacientes"),o([]),r(0),c(1))}m(!1)})()},[p,i,s,f]),{totalPages:d,pagina:i,nombres:a,setPagina:c,loading:n}},de=({onChangeNombre:s})=>{const[i,c]=t.useState(""),[d,r]=t.useState(),{totalPages:a,nombres:o,pagina:n,setPagina:m,loading:f}=le(d);return e.jsxs("div",{className:"selectNombre-container",children:[e.jsxs("div",{className:"formBuscarPorNombre",children:[e.jsx("input",{name:"nombre",id:"buscarPaciente",type:"text",placeholder:"Buscar Nombre",onChange:p=>c(p.target.value)}),e.jsx(K,{tipo:"button",texto:f?e.jsx(V,{}):"Buscar",className:"formBuscarBtn",onClickFunction:()=>r(i)})]}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pagination-buttons",children:[e.jsx("div",{className:"encabezado",children:f?e.jsx(V,{className:"loaderPacientes"}):e.jsxs("strong",{children:["Página: ",n," / ",a]})}),e.jsx(P,{tipo:"button",className:"pagination-buttons-Anterior",texto:"Pág anterior",onClickFunction:()=>n>1&&m(n-1)}),e.jsx(P,{tipo:"button",className:"pagination-buttons-Siguiente",onClickFunction:()=>n!==a&&m(n+1),texto:"Siguiente pág"})]}),o.map((p,N)=>e.jsxs("div",{className:p.nombre==="admin"?"selectNombre-option admin":"selectNombre-option",onClick:()=>s(p.nombre),children:[e.jsx("img",{src:p.foto.secure_url,alt:p.nombre,className:"imagen"}),e.jsx("span",{className:"nombre",children:p.nombre}),e.jsxs("span",{className:"numero",children:["Numero de reservas: ",p.totalReservas]})]},N))]})]})},me=de,ue=(s,i)=>{const[c,d]=t.useState([]),[r,a]=t.useState([]);return t.useEffect(()=>{const n=re(new Date(`${s} ${i}`)).filter(m=>m.dia.getDay()===new Date(`${s} ${i}`).getDay());a(n),d(n[0].horas)},[s,i]),{horas:c,diaConHoras:r}},he=(s,i)=>s.reduce((c,d)=>{const r=new Date(d.horario.horaInicio),a=new Date(d.horario.horaDeFin),o=d.estado,n=d.pacienteNombre,m=i.reduce((f,p)=>{const N=p.horas.filter(h=>h>=r&&h<=a).map(h=>({hora:h,estado:o===F.cancelada?"":o,nombreReserva:n==="admin"?n:""}));return[...f,...N]},[]);return[...c,...m]},[]),pe=({reservas:s,diaConHoras:i,horas:c,onClickReservar:d})=>c.map((r,a)=>{const o=he(s,i).find(m=>m.hora.toISOString()===r.toISOString());let n="liHora";return(a==0||a==1)&&(n+=" paraReservaAdmin"),o&&o.nombreReserva==="admin"&&(n+=" paraReservaAdmin"),o&&(n+=` ${o.estado}`),e.jsx("li",{"data-fecha":r,onClick:d,className:n,children:I(r)},r.toISOString())}),xe=()=>{const[s,i]=t.useState([]),{accessToken:c}=t.useContext(E),{setMensaje:d}=t.useContext(w);return t.useEffect(()=>{(async()=>{const a={headers:{"Content-Type":"application/json",Authorization:`Bearer ${c||""}`}},o=C.tratamientos.todos;await y(o,a,n=>{const{error:m,tratamientos:f}=n;m?d(m):i(f)})})()},[c,d]),{tratamientos:s}},fe=({reserva:s,setMotivo:i,setSesion:c,className:d,name:r,formReserva:a})=>{var j;const[o,n]=t.useState(s!=null&&s.tratamiento?s.tratamiento.nombre:""),[m,f]=t.useState(s!=null&&s.tratamiento?(j=s.tratamiento)==null?void 0:j.descripcionSesion:""),[p,N]=t.useState([]),{tratamientos:h}=xe();return t.useEffect(()=>{if(o&&h.length>0){const l=h.find(x=>x.nombre===o).sesiones;N(l)}},[o,h]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:d||"",children:[e.jsx("label",{children:"Tratamiento"}),e.jsxs("select",{required:!0,name:r,onChange:l=>{i(l.target.value),n(l.target.value),f("")},children:[e.jsx("option",{defaultValue:s!=null&&s.tratamiento?s.tratamiento.nombre:"",children:s!=null&&s.tratamiento?s.tratamiento.nombre:""}),h&&h.length&&h.map(l=>{var x;return s?((x=s.tratamiento)==null?void 0:x.descripcionSesion)!==l.nombre&&e.jsx("option",{value:l.nombre,children:l.nombre},l._id):e.jsx("option",{value:l.nombre,children:l.nombre},l._id)})]})]}),o&&a&&e.jsxs("div",{className:d||"",children:[e.jsx("label",{children:"Sesiones"}),e.jsxs("select",{name:"sesiones",required:!0,onChange:l=>c(l.target.value),children:[e.jsx("option",{defaultValue:m,children:m}),p.length>0&&p.map(l=>l.descripcion!==m&&e.jsx("option",{defaultValue:l.descripcion,children:l.descripcion},l._id))]})]})]})},je=({reserva:s,setForm:i,editar:c,actualizarReserva:d})=>{var G,J;const[r,a]=t.useState(new Date(`${s.fecha}`).toISOString().split("T")[0]||Y.split("T")[0]),[o,n]=t.useState(I(new Date(`${s.fecha}`))||""),[m,f]=t.useState([]),[p,N]=t.useState(((G=s.tratamiento)==null?void 0:G.nombre)||""),[h,j]=t.useState(((J=s.tratamiento)==null?void 0:J.descripcionSesion)||""),[l,x]=t.useState(s.observaciones),[u,v]=t.useState(s.pacienteNombre),[$,R]=t.useState(!1),T=t.useRef(),{setMensaje:D}=t.useContext(w),{accessToken:H}=t.useContext(E),{nombres:Q,pagina:W,setPagina:X,totalPacientes:Z,totalPaginas:ee}=ce(),{diaConHoras:q,horas:se}=ue(r,o);t.useEffect(()=>{T.current.scrollIntoView({behavior:"smooth",block:"start"})},[]);const O=()=>{T.current.parentElement.classList.add("animationOut"),setTimeout(()=>{i()},300)};t.useEffect(()=>{r&&(async()=>{const b=await fetch(`${C.reservas.deUnDia}${r}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${H||""}`}}),{data:g}=await b.json();f(g)})()},[r,H,s]);const te=S=>{const b=S.target.textContent;n(b);const g=ie(new Date(`${r} ${b}`),m);(g.estado||g.proximaHoraNoDisponible)&&(D("Hora no disponible para hacer una reserva"),n(""))},ae=async S=>{S.preventDefault(),R(!0);const b=T.current,g={pacienteNombre:b.pacienteNombre.value,fecha:new Date(`${b.fecha.value} ${o}`),tratamiento:b.tratamiento.value,observaciones:b.observaciones.value,sesionSeleccionada:b.sesiones.value};if(g.pacienteNombre.trim()&&g.fecha instanceof Date&&g.sesionSeleccionada.trim()&&g.tratamiento.trim()){const _={method:"POST",body:JSON.stringify(g),headers:{"Content-Type":"application/json",authorization:`Bearer ${H}`}};await y(`${C.reservas.agregar}`,_,A=>{const{reserva:M,error:k,mensaje:B}=A;k?D(k):(D(B),d(M),O())}),b.classList.add("formOut")}else D("Faltan campos");R(!1)},ne=async S=>{S.preventDefault(),R(!0);const b=T.current,g={_id:s._id,pacienteNombre:b.pacienteNombre.value,fecha:new Date(`${b.fecha.value} ${o}`),tratamiento:b.tratamiento.value,observaciones:b.observaciones.value,sesionSeleccionada:b.sesiones.value,estado:s.estado||F.pendiente};if(g.pacienteNombre.trim()&&g.fecha instanceof Date&&g.sesionSeleccionada.trim()&&g.tratamiento.trim()){const _=`${C.reservas.editar}${g._id}`,A={method:"PUT",body:JSON.stringify(g),headers:{"Content-Type":"application/json",authorization:`Bearer ${H}`}};await y(_,A,M=>{const{reserva:k,error:B,mensaje:oe}=M;B?D(B):(D(oe),d(k),O())}),b.classList.add("formOut")}else D("Faltan campos");R(!1)};return e.jsxs("section",{className:"formReservaContainer",children:[e.jsx(P,{className:"cerrarForm",texto:"Cerrar Formulario",onClickFunction:O,tipo:"button"}),e.jsxs("form",{onSubmit:c?ne:ae,className:"formReserva",ref:T,children:[e.jsx("h3",{children:"Reserva"}),!u=="admin"||!s.pacienteNombre&&e.jsx(me,{totalPacientes:Z,totalPaginas:ee,nombres:Q,pagina:W,setPagina:X,onChangeNombre:v}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"pacienteNombre",children:"Nombre"}),e.jsx("input",{id:"pacienteNombre",type:"text",name:"pacienteNombre",defaultValue:u,disabled:!!u,required:!0})]}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"fecha",children:"Fecha"}),e.jsx("input",{id:"fecha",type:"date",name:"fecha",required:!0,disabled:!(u==="admin"||s.pacienteNombre),defaultValue:r||Y.split("T")[0],onChange:S=>{const b=S.target.value.split("T")[0];a(b),n("")}})]}),q&&e.jsx("div",{className:"input",children:e.jsx("ul",{className:"horasDisplay",children:e.jsx(pe,{diaConHoras:q,horas:se,onClickReservar:te,reservas:m})})}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"observaciones",children:u==="admin"?"Tareas. Separadas por comas":"Observaciones"}),e.jsx("input",{defaultValue:s.observaciones,id:"observaciones",type:"text",name:"observaciones",onChange:S=>x(S.target.value)})]}),e.jsx(fe,{className:"input",reserva:s,setMotivo:S=>{N(S),j("")},setSesion:j,name:"tratamiento",formReserva:!0}),e.jsxs("div",{className:"input",children:[u&&e.jsxs("span",{className:"spanHora",children:["Nombre ",e.jsx("strong",{children:u})]}),r&&e.jsxs("span",{className:"spanHora",children:["Dia ",e.jsx("strong",{children:U({fecha:new Date(`${r} ${o}`)})})]}),o&&e.jsxs("span",{className:"spanHora",children:["Hora ",e.jsx("strong",{children:o})]}),l&&e.jsxs("span",{className:"spanHora",children:["Observaciones",e.jsx("strong",{children:l})]}),p&&e.jsxs("span",{className:"spanHora",children:["Tratamiento"," ",e.jsxs("span",{className:"spanHora2",children:[e.jsx("strong",{children:p}),e.jsx("strong",{children:h})]})]})]}),e.jsx(K,{tipo:"submit",className:"submitAdmin",texto:$?e.jsx(V,{}):"Guardar"})]})]})};const z=[F.pendiente,F.pago,F.cancelada];function be(s){const i=z.indexOf(s);if(i!==-1){const c=(i+1)%z.length;return z[c]}else return}const ge=({actualizarReserva:s,reserva:i,cerrarReserva:c,setForm:d,setModal:r})=>{const[a,o]=t.useState(i),n=t.useRef(),{accessToken:m}=t.useContext(E),{setMensaje:f}=t.useContext(w),p=async()=>{const j=be(a.estado),l=`${C.reservas.editarEstado}${a._id}`,x={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${m}`},body:JSON.stringify({estado:j})};await y(l,x,u=>{const{reserva:v,error:$,mensaje:R}=u;$?f($):(f(R),s(v),o(v))})},N=()=>{c(n)},h=()=>{d(a)};return e.jsx(e.Fragment,{children:e.jsxs("article",{className:"containerReserva",ref:n,children:[e.jsx("div",{className:`reserva-container-titulo  ${a.estado}`,children:e.jsx("h3",{children:"Detalles de la reserva"})}),e.jsxs("div",{className:`reserva-container-cuerpo  ${a.estado}`,children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Paciente: ",e.jsx("strong",{children:a.pacienteNombre})]}),e.jsxs("li",{children:["Fecha:",e.jsx("strong",{children:U({fecha:a.horario.horaInicio})})]}),e.jsxs("li",{children:["Hora:"," ",e.jsx("strong",{children:I(new Date(a.horario.horaInicio))})]}),a.pacienteNombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Tratamiento: ",e.jsx("strong",{children:a.tratamiento.nombre})]}),e.jsxs("li",{children:["Sesiones:",e.jsx("strong",{children:a.tratamiento.descripcionSesion})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("strong",{children:a.observaciones})]}),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:a.estado})]}),e.jsxs("li",{children:["Valor:",e.jsxs("strong",{className:"strongEstado",children:["$ ",a.precio]})]})]})]}),a.pacienteNombre==="admin"&&e.jsxs("ul",{className:"tareasAdmin",children:[e.jsx("li",{children:"Lista:"}),a.observaciones.split(",").map(j=>e.jsx("li",{className:"liTarea",children:e.jsx("span",{children:j})},j)),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:a.estado})]})]})]}),e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(P,{texto:"Editar",tipo:"button",className:"btnEditar",onClickFunction:h}),e.jsx(P,{texto:"Estado",tipo:"button",className:`btnCompletada ${a.estado}`,onClickFunction:p})]}),c?e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(P,{texto:"Cerrar",className:"btnCerrarReserva",onClickFunction:N,tipo:"button"}),e.jsx(P,{texto:"Eliminar",tipo:"button",className:"btnCerrar Cancelada",onClickFunction:()=>r(a)})]}):e.jsx("div",{className:"reserva-container-botones",children:e.jsx(P,{texto:"Eliminar",className:"btnCerrar",onClickFunction:()=>r(a)})})]})})};const Ne=({titulo:s,mensaje:i,onConfirm:c,onCancel:d})=>{const r=t.useRef();return t.useEffect(()=>{r.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",ref:r,children:[e.jsx("h3",{children:s}),e.jsx("p",{children:i}),e.jsxs("div",{children:[e.jsx("button",{onClick:c,children:"Confirmar"}),e.jsx("button",{onClick:d,children:"Cancelar"})]})]})})},Pe=({reservas:s,actualizarReservas:i,actualizarReservaEliminada:c,cerrarReserva:d,className:r})=>{const[a,o]=t.useState(!1),[n,m]=t.useState(!1),[f,p]=t.useState(!1),{accessToken:N}=t.useContext(E),h=u=>{m(u),o(!0)},j=async()=>{const u=`${C.reservas.eliminar}${n._id}`,v={method:"DELETE",headers:{authorization:`Bearer ${N}`}};await y(u,v,c),p(!1)},l=()=>{p(!1)},x=u=>{m(u),p(!0)};return a?e.jsx(je,{editar:!0,reserva:{...n,fecha:n.horario.horaInicio,nombre:n.pacienteNombre},actualizarReserva:u=>{i(u)},setForm:()=>{o(!1)}}):f?e.jsx(Ne,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${n.pacienteNombre} el dia ${U({fecha:n.horario.horaInicio})} a las ${I(new Date(n.horario.horaInicio))}?`,onConfirm:j,onCancel:l}):e.jsx("section",{className:`ContenedorReservas ${r||""}`,children:(s==null?void 0:s.length)>0&&s.map(u=>e.jsx(ge,{setModal:x,setForm:h,cerrarReserva:d,actualizarReservaEliminada:c,actualizarReserva:i,reserva:u},u._id))})};export{Pe as C,je as F,pe as L,me as S,Ne as a,ue as b,he as e,L as o,ce as u};
