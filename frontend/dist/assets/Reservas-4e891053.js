import{r as s,U as y,M as z,j as e,a as P}from"./index-6fbdeef3.js";import{b as Y,H as S,d as w,g as H,f as F,e as A,a as D,L as I}from"./FormularioReserva-7bfb559d.js";import{u as k,C as B}from"./ContadorReservas-df2f0f06.js";import{F as G,T as U,c as J,N as q,C as E,o as R}from"./Notificacion-bc66807f.js";import"./BotonPrimario-2bd0cf02.js";const K=async(p,v)=>{const f=`${Y.reservas.dias}${v}`,r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}};try{const m=await fetch(f,r);if(m.ok){const{fechas:i,cantidad:o}=await m.json();return{fechas:i,cantidad:o}}}catch(m){return m}},T=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],Q=({setDiaPadre:p,reservas:v,actualizarReservas:f})=>{const[r,m]=s.useState(S.split("T")[0]),[i,o]=s.useState(S.split("-")[1]),[l,C]=s.useState(""),[x,j]=s.useState([]),[d,b]=s.useState([]),[N,n]=s.useState(0),[t,h]=s.useState(!1),[g,u]=s.useState(!1),{accessToken:$}=s.useContext(y),{setMensaje:M}=s.useContext(z);s.useEffect(()=>{i&&(async()=>{u(!0);const c=await K($,i);if(n(c.cantidad),c.cantidad>0)b(c.fechas);else{u(!1);return}u(!1)})()},[$,i]),s.useEffect(()=>{u(!0);const c=w(r,v).find(_=>_.dia.getDay()===new Date(`${r} ${l}`).getDay());j(c.horaID),u(!1)},[r,v,l]);const L=a=>{C(a.target.textContent),J(a,r,v)?h(!0):M("Hora no disponible para hacer una reserva")};function O(a){return a>=1&&a<=12?T[a-1]:"Mes no vÃ¡lido"}return e.jsxs("section",{className:"containerFechasYHoras",children:[t&&e.jsx(e.Fragment,{children:e.jsx(G,{reserva:{fecha:r,hora:l,pacienteNombre:l==="08:00"||l==="08:30"?"admin":null},fecha:r,hora:l,setForm:()=>h(!1),actualizarReserva:f})}),e.jsxs("div",{className:"select-container-container",children:[e.jsx("div",{className:"select-container",children:e.jsx("select",{value:i,onChange:a=>o(a.target.value),children:T.map((a,c)=>e.jsx("option",{value:c+1,children:a},a))})}),e.jsxs("h2",{children:["Fechas con reservas del mes de ",`${O(i)}`,e.jsx("div",{children:e.jsx(U,{from:0,to:N,duration:500})})]}),e.jsxs("select",{className:"selectedFecha",name:"selectedFecha",onChange:a=>{const c=a.target.value.split("T")[0];p(c),m(c)},children:[e.jsxs("option",{value:H(D),children:["Hoy ",F({fecha:H(D)})]}),(d==null?void 0:d.length)>0&&(d==null?void 0:d.map(a=>e.jsx("option",{className:"selectedComponent-option",value:a.fecha,children:F(a)},a.fecha)))]}),x.length>0&&e.jsx(A,{horas:x,onClickReservar:L})]})]})};function ae(){const[p,v]=s.useState(S.split("T")[0]),[f,r]=s.useState([]),{loading:m}=s.useContext(y),{loading:i,delDia:o,setDelDia:l,loadingSemana:C}=k(!1,p),{setMensaje:x}=s.useContext(z),j=n=>{const{reserva:t}=n,h=`Reserva nueva de ${t.pacienteNombre} el dia ${F({fecha:t.fecha})} a las ${t.hora}`;x(h);const g=o.filter(u=>u._id!==t._id);l(g.concat(t).sort(R))},d=n=>{const{reserva:t}=n,h=`Reserva borrada de ${t.pacienteNombre} el dia ${F({fecha:t.fecha})} a las ${t.hora}`;x(h);const g=o.filter(u=>u._id!==t._id);l(g.sort(R))},b=n=>{if(n==="Toda")r(o.sort(R));else{const t=o.filter(h=>h.estado===n);r(t.sort(R))}},N=n=>{n.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{n.current.parentElement.classList.remove("animationReservaOut"),r([])},500)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{}),(m||i)&&e.jsx(P,{}),e.jsx("main",{className:"divPageReservas",children:f.length>0?e.jsx(E,{reservas:f,actualizarReservas:j,actualizarReservaEliminada:d,cerrarReserva:N}):e.jsxs(e.Fragment,{children:[e.jsx(B,{reservas:o,mostrarReservadas:b}),e.jsx(Q,{actualizarReservas:j,reservas:o,setDiaPadre:v}),C?e.jsx(I,{}):null,e.jsx(E,{reservas:o,actualizarReservas:j,actualizarReservaEliminada:d})]})})]})}export{ae as default};
