import{j as e,c as u,a as z,k as w,R as g,E as f,l as j,u as D,r as h}from"./index-YAdz76Jm.js";import{f as C,u as S}from"./useReservasContext-D-al89pr.js";import{C as V}from"./LoaderChico-KZMPlRzu.js";import{u as L}from"./useObserver-k1XNW9GD.js";import{f as $}from"./formatHoraUser-TJ92Iw1g.js";import{B as x}from"./Button-qbGwCLcH.js";import{f as A,b as T,u as _,a as B}from"./useLoaderContext-_SMLR0xo.js";const U=({reserva:a})=>{var t,s,r,n,l;return e.jsxs("ul",{className:"grid text-white",children:[e.jsxs("li",{className:"capitalize grid grid-flow-col justify-between p-4 border-b",children:["Fecha:",e.jsx("span",{children:C(a.horario.horaInicio)})]}),e.jsxs("li",{className:"p-4 border-b grid grid-flow-col justify-between",children:["Hora: ",e.jsx("span",{children:$(new Date(a.horario.horaInicio))})]}),((t=a.paciente)==null?void 0:t.nombre)!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"p-4 border-b capitalize grid justify-between grid-flow-col gap-4",children:["Servicio:",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:((s=a.servicio)==null?void 0:s.nombre)||e.jsx(u,{})})]}),e.jsxs("li",{className:"p-4 border-b grid justify-between grid-flow-col gap-4",children:["Tratamiento:",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:((r=a.tratamiento)==null?void 0:r.descripcion)||e.jsx(u,{})})]}),e.jsxs("li",{className:"p-4 border-b grid grid-flow-col justify-between gap-4",children:["Sesiones:",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:((n=a.tratamiento)==null?void 0:n.sesiones)||e.jsx(u,{})})]}),e.jsxs("li",{className:"p-4 border-b grid justify-between grid-flow-col gap-4",children:["Observaciones:",e.jsx("span",{className:"grid  text-end text-nowrap overflow-auto",children:a.observaciones||e.jsx(u,{})})]}),e.jsxs("li",{className:"p-4 pb-8 grid grid-flow-col  gap-4",children:["Valor:",e.jsxs("span",{className:"grid text-end text-nowrap overflow-auto",children:["$ ",((l=a.tratamiento)==null?void 0:l.costoPorSesion)||0]})]})]})]})},M=({reserva:a})=>{var t;return((t=a.paciente)==null?void 0:t.nombre)==="admin"&&e.jsx(e.Fragment,{children:e.jsxs("ul",{className:"pb-4 gap-4 items-start grid text-white",children:[e.jsx("li",{className:"list-none text-center border-t pt-4",children:"Compromisos"}),a.observaciones.split(",").map(s=>e.jsx("li",{className:"pl-6",children:s},s))]})})},P=({reserva:a,handleEditarEstadoReserva:t,handleEliminarReserva:s,loading:r,contenedorRef:n})=>{const l=z(),o=w().pathname===g.admin.calendario,{dispatch:m}=S(),c=()=>{l(g.admin.editarReserva,{state:{reserva:a}})},i=()=>{n.current.classList.replace("animate-growIn","animate-growOut"),setTimeout(()=>{m({type:j.SET_RESERVAS_SELECCIONADAS,payload:[]})},500)};return e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-full",texto:"Editar",tipo:"button",onClickFunction:c}),e.jsx(x,{disabled:r,texto:"Estado",tipo:"button",className:`${a.estado} w-full text-white`,onClickFunction:t}),o&&e.jsx(x,{className:"w-full",texto:"Cerrar",onClickFunction:i,tipo:"button"}),e.jsx(x,{className:`w-full ${f.cancelada} text-white`,texto:"Eliminar",tipo:"button",onClickFunction:s})]})},H=async(a,t)=>{const s=`${T.reservas.deleteReserva}${t}`,r={method:"DELETE",headers:{Authorization:`Bearer ${a||""}`}};return await A(s,r)},b=[f.pendiente,f.pago,f.cancelada];function q(a){const t=b.indexOf(a);if(t!==-1){const s=(t+1)%b.length;return b[s]}else return}const J=async(a,t)=>{const s=q(t.estado),r=`${T.reservas.putEstadoReserva}${t._id}`,n={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},body:JSON.stringify({estado:s})};return await A(r,n)},G=()=>{const{setLoading:a}=_(),{accessToken:t}=B(),{setMensaje:s}=D(),{dispatch:r}=S();return{borrarReserva:async d=>{try{a(!0);const o=await H(t,d._id),{status:m,error:c,mensaje:i}=o;m===200?(s(i),r({type:j.DELETE_RESERVA,payload:d})):s(c||"Ocurrió un error al eliminar el paciente")}catch{s("Ocurrió un error al eliminar el paciente")}finally{a(!1)}},cambiarEstadoReserva:async d=>{try{a(!0);const o=await J(t,d),{status:m,datos:c,error:i,mensaje:p}=o;if(m===200)return s(p),r({type:j.SET_RESERVA_NUEVA,payload:c}),a(!1),c;s(i||"Error al actualizar el estado de la reserva")}catch{s("Error al actualizar el estado de la reserva")}finally{a(!1)}}}},K=({datos:a,contenedorRef:t})=>{var E,v,N,y;const r=w().pathname===g.admin.calendario,{loading:n}=_(),{borrarReserva:l,cambiarEstadoReserva:d}=G(),[o,m]=h.useState(a),[c,i]=h.useState(!1),p=h.useRef(),{isVisible:R}=L(p),F=async()=>{await l(o),i(!1)},I=()=>{i(!0)},O=async()=>{const k=await d(o);m(k)};return e.jsxs(e.Fragment,{children:[c&&e.jsx(V,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${(E=o.paciente)==null?void 0:E.nombre} el dia ${C((v=o.horario)==null?void 0:v.horaInicio)} a las ${$(new Date((N=o.horario)==null?void 0:N.horaInicio))}?`,onConfirm:F,onCancel:()=>i(!1)}),e.jsxs("article",{className:`${R&&!r?"animate-fadeIn":""} border border-slate-500 grid grid-rows-[50px_1fr_auto] rounded-lg max-w-96 w-full mx-auto overflow-auto snap-center min-w-80 ${o.estado}`,ref:p,children:[o.paciente&&e.jsx("h3",{className:"font-betonga font-bold text-xl text-white capitalize grid place-content-center tracking-wider",children:((y=o.paciente)==null?void 0:y.nombre)||"Paciente eliminado"}),e.jsxs("section",{className:"grid border-t border-b border-slate-50",children:[e.jsx(U,{reserva:o}),e.jsx(M,{reserva:o})]}),e.jsx("section",{className:"grid gap-4 p-4 grid-cols-2 justify-evenly bg-white",children:e.jsx(P,{contenedorRef:t,reserva:o,handleEditarEstadoReserva:O,handleEliminarReserva:I,loading:n})})]})]})},se=({reservas:a})=>{const t=h.useRef(),r=w().pathname===g.admin.calendario;return e.jsx("section",{className:`${r?"animate-growIn fixed inset-0 z-30 py-8 px-4 bg-white bg-opacity-30 backdrop-blur-sm grid items-center grid-flow-col gap-4 overflow-x-auto snap-x snap-proximity scroll-smooth":"grid gap-4 m-auto w-full max-w-5xl md:grid-cols-2 xl:grid-cols-3"} `,ref:t,children:a.length>0?a.map(n=>e.jsx(K,{datos:n,contenedorRef:t},n._id)):e.jsx("h2",{className:"text-xl text-center col-span-full",children:"No hay reservas"})})};export{se as C};
