import{r as s,U as L,M as _,j as e,a as w}from"./index-a69d4063.js";import{b as I,H as b,M as T,f as M,a as D}from"./apiConfig-6444a406.js";import{u as k,C as B}from"./ContadorReservas-3f53d4db.js";import{F as G,c as U,N as A,C as y,o as F}from"./Notificacion-c76e5d87.js";import{d as q,f as S,H as J,L as K}from"./FormularioReserva-21624bdd.js";import{T as z}from"./TransitionNumber-857acc96.js";import"./BotonPrimario-3445e247.js";const Q=async(p,m)=>{const v=`${I.reservas.dias}${m}`,n={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}};try{const u=await fetch(v,n);if(u.ok){const{fechas:t,cantidad:c,totalReservasMes:i}=await u.json();return{fechas:t,cantidad:c,totalReservasMes:i}}}catch(u){return u}},V=({setDiaPadre:p,reservas:m,actualizarReservas:v})=>{const[n,u]=s.useState(b.split("T")[0]),[t,c]=s.useState(b.split("-")[1]),[i,$]=s.useState(""),[x,j]=s.useState([]),[d,N]=s.useState([]),[H,l]=s.useState(0),[r,h]=s.useState(0),[R,f]=s.useState(!1),[W,g]=s.useState(!1),{accessToken:E}=s.useContext(L),{setMensaje:O}=s.useContext(_);s.useEffect(()=>{t&&(async()=>{g(!0);const o=await Q(E,t);if(l(o.cantidad),console.log(o),h(o.totalReservasMes),o.cantidad>0)N(o.fechas);else{g(!1);return}g(!1)})()},[E,t]),s.useEffect(()=>{g(!0);const o=q(n,m).find(Y=>Y.dia.getDay()===new Date(`${n} ${i}`).getDay());j(o.horaID),g(!1)},[n,m,i]);const P=a=>{$(a.target.textContent),U(a,n,m)?f(!0):O("Hora no disponible para hacer una reserva")};function C(a){return a>=1&&a<=12?T[a-1]:"Mes no vÃ¡lido"}return e.jsxs("section",{className:"containerFechasYHoras",children:[R&&e.jsx(e.Fragment,{children:e.jsx(G,{reserva:{fecha:n,hora:i,pacienteNombre:i==="08:00"||i==="08:30"?"admin":null},fecha:n,hora:i,setForm:()=>f(!1),actualizarReserva:v})}),e.jsxs("div",{className:"select-container-container",children:[e.jsxs("div",{className:"select-container",children:[e.jsxs("h3",{children:["Fechas en ",`${C(t)}`," ",e.jsx(z,{from:0,to:H,duration:500})]}),e.jsxs("select",{value:t,onChange:a=>c(a.target.value),children:[e.jsx("option",{value:t,children:`${C(t)}`},t),T.map((a,o)=>a!==`${C(t)}`&&e.jsx("option",{value:o+1,children:a},a))]}),e.jsxs("h3",{children:["Reservas en ",`${C(t)}`," ",e.jsx(z,{from:0,to:r,duration:500})]})]}),e.jsxs("select",{className:"selectedFecha",name:"selectedFecha",onChange:a=>{const o=a.target.value.split("T")[0];p(o),u(o),console.log(o)},children:[e.jsxs("option",{value:M(D),children:["Hoy ",S({fecha:M(D)})]}),(d==null?void 0:d.length)>0&&(d==null?void 0:d.map(a=>e.jsx("option",{className:"selectedComponent-option",value:a.fecha,children:S(a)},a.fecha)))]}),x.length>0&&e.jsx(J,{horas:x,onClickReservar:P})]})]})};function oe(){const[p,m]=s.useState(b.split("T")[0]),[v,n]=s.useState([]),{loading:u}=s.useContext(L),{loading:t,delDia:c,setDelDia:i,loadingSemana:$}=k(!1,p),{setMensaje:x}=s.useContext(_),j=l=>{const{reserva:r}=l,h=`Reserva nueva de ${r.pacienteNombre} el dia ${S({fecha:r.fecha})} a las ${r.hora}`;x(h);const R=c.filter(f=>f._id!==r._id);i(R.concat(r).sort(F))},d=l=>{const{reserva:r}=l,h=`Reserva borrada de ${r.pacienteNombre} el dia ${S({fecha:r.fecha})} a las ${r.hora}`;x(h);const R=c.filter(f=>f._id!==r._id);i(R.sort(F))},N=l=>{if(l==="Toda")n(c.sort(F));else{const r=c.filter(h=>h.estado===l);n(r.sort(F))}},H=l=>{l.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{l.current.parentElement.classList.remove("animationReservaOut"),n([])},500)};return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),(u||t)&&e.jsx(w,{}),e.jsx("main",{className:"divPageReservas",children:v.length>0?e.jsx(y,{reservas:v,actualizarReservas:j,actualizarReservaEliminada:d,cerrarReserva:H}):e.jsxs(e.Fragment,{children:[e.jsx(B,{reservas:c,mostrarReservadas:N}),e.jsx(V,{actualizarReservas:j,reservas:c,setDiaPadre:m}),$?e.jsx(K,{}):null,e.jsx(y,{reservas:c,actualizarReservas:j,actualizarReservaEliminada:d,className:"ContenedorReservas"})]})})]})}export{oe as default};
