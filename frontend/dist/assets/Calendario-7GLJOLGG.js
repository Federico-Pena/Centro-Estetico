import{q as A,H as $,s as F,M,I as V,t as U,r as C,v as R,u as T,m as y,p as j,j as e,g as c,a as B,w as P,R as v}from"./index-eyZDGxlY.js";import{c as _}from"./compararFechas-CWI27YET.js";import{f as z,a as Z,u as O}from"./useUserContext-o9xrNTqb.js";import{u as b}from"./useReservasContext-7CxyEjNX.js";import{B as w}from"./Button-gaWcEQck.js";import{L as q}from"./LoaderChico-GUMo0G8g.js";import{f as k}from"./formatFechaParaUser-QfX3A7Bl.js";import{f as G}from"./formatHoraUser-TJ92Iw1g.js";import{L as Y}from"./LabelInput-hKgQ6xdJ.js";import{C as J}from"./ContenedorReservas-lbV-lV1T.js";import{T as S}from"./TransitionNumber-UPsjx5NY.js";import"./useObserver-6YU-PPv7.js";const I=6,K=0,Q=(s,a,t)=>!(s===20&&a===30)&&!(t.getDay()===I&&s===12&&a===30)&&t.getDay()!==K,W=s=>{const a=new Date(s);return Number.isNaN(a.getTime())?[]:(a.setDate(a.getDate()-a.getDay()),Array.from({length:A},(r,i)=>{const n=new Date(a),x=[],f=n.getDay()===I?$:F;n.setDate(a.getDate()+i);for(let l=U;l<=f;l++)for(let u=0;u<M;u+=V)if(Q(l,u,n)){const m=new Date(n);m.setHours(l,u,0),x.push(m)}return{dia:n,horas:x}}))},X=async(s,a)=>{const t={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},r=`${Z.reservas.deLaSemana}${a}`;return await z(r,t)},ee=()=>{const[s,a]=C.useState(R.split("T")[0]),{setMensaje:t}=T(),{accessToken:r}=O(),{setLoading:i}=y(),{dispatch:n}=b(),x=W(s);return C.useEffect(()=>{s&&(async()=>{i(!0);const d=await X(r,s),{datos:g,error:h,status:N}=d;N===200?n({type:j.SET_RESERVAS,payload:g}):g?t(h||"Ocurrió un error al obtener las reservas de la semana"):n({type:j.SET_RESERVAS,payload:[]}),i(!1)})()},[r,t,s,n,i]),{semanaAnterior:()=>{const o=new Date(`${s} 00:00:00.000Z`);o.setDate(o.getDate()-A);const d=o.toISOString().split("T")[0];a(d)},semanaSiguiente:()=>{const o=new Date(`${s} 00:00:00.000Z`);o.setDate(o.getDate()+A);const d=o.toISOString().split("T")[0];a(d)},diasSemana:x,setSeleccionadas:o=>{n({type:j.SET_RESERVAS_SELECCIONADAS,payload:o})},seleccionarDia:o=>{a(o)}}},E=({loading:s,semanaAnterior:a,semanaSiguiente:t})=>e.jsxs("section",{className:"grid grid-flow-col gap-4 border-t border-black p-4",children:[e.jsx(w,{className:"w-full",onClickFunction:a,texto:"Anterior",tipo:"button"}),s&&e.jsx(q,{className:"self-center"}),e.jsx(w,{className:"w-full",onClickFunction:t,texto:"Siguiente",tipo:"button"})]}),ae=({horas:s,reservarHora:a})=>{const{reservas:t}=b();return e.jsx("ul",{className:"grid gap-2 p-2",children:s.map((r,i)=>{const n=_(r,t);return e.jsx("li",{"data-fecha":n.id,onClick:a,className:`${n.reservaAdmin&&"outline outline-2 outline-color-violeta px-1 horaAdmin"} ${te(i,n)} text-center rounded-md cursor-pointer hover:scale-105 transition-transform`,children:G(r)},r)})})},se=s=>s===c.pendiente?"bg-color-pendiente text-white":s===c.pago?"bg-color-paga text-white":s===c.cancelada?"bg-color-cancelada text-white":"",te=(s,a)=>s==0||s==1?"outline outline-2 outline-color-violeta px-1 horaAdmin":se(a.estado),re=({diasSemana:s,reservarHora:a})=>e.jsx("section",{className:"grid grid-cols-3 md:grid-cols-6 border-t border-black",children:s.map(t=>{const r=new Date(t.dia);return r.getDay()!==0&&e.jsxs("div",{className:"grid grid-rows-[50px,1fr] gap-2",children:[e.jsx("h3",{className:`grid place-content-center text-center capitalize text-md p-2 text-color-violeta font-betonga font-bold tracking-wide text-pretty border-b border-black ${r.getDate()===new Date().getDate()&&r.getDay()===new Date().getDay()?"bg-color-verde-blanco":""}`,children:k(t.dia)}),e.jsx(ae,{horas:t.horas,reservarHora:a})]},r)})}),oe=({handleSeleccionarDia:s})=>{const a=t=>{const r=t.target.value;r&&s(r)};return e.jsxs("section",{className:"grid gap-x-4",children:[e.jsxs("h1",{onClick:()=>s(R.split("T")[0]),className:"capitalize p-4 text-xl bg-color-verde-blanco text-center text-color-violeta cursor-pointer rounded-t-lg font-betonga font-bold",children:["Hoy ",k(R)]}),e.jsx("div",{className:"grid gap-2 p-4 text-center",children:e.jsx(Y,{className:"text-center max-w-md justify-self-center",labelText:"Buscar día",type:"date",onChange:a})})]})};function ne(s){const a=s.reduce((t,r)=>(r.estado===c.pago?t.terminadas++:r.estado===c.cancelada?t.canceladas++:r.estado===c.pendiente&&t.pendientes++,t),{terminadas:0,canceladas:0,pendientes:0});return{reservasCanceladas:a.canceladas,reservasPendientes:a.pendientes,reservasTerminadas:a.terminadas,reservasTodas:a.canceladas+a.pendientes+a.terminadas}}function ie({setSeleccionadas:s}){const[a,t]=C.useState(!1),{reservas:r}=b(),{reservasCanceladas:i,reservasPendientes:n,reservasTerminadas:x,reservasTodas:f}=ne(r),l=o=>{if(o==="Todas")s(r);else{const d=r.filter(g=>g.estado===o);s(d)}},u=()=>{t(!a)},m=o=>{const d=o.currentTarget.id;l(d)};return e.jsxs("div",{className:"m-auto w-full max-w-4xl flex flex-col items-center gap-4 mb-4",children:[e.jsx(w,{tipo:"button",texto:`${a?"Ocultar Contador":"Mostrar Contador"}`,onClickFunction:u}),e.jsxs("section",{className:`w-full flex flex-wrap gap-4 [&>div]:flex-1 [&>div]:p-3 [&>div]:text-center [&>div]:rounded-md [&>div]:cursor-pointer [&>div]:transition-colors [&>div]:text-white [&>div]:font-betonga [&>div]:tracking-wider [&>div]:border hover:[&>div]:bg-slate-200 hover:[&>div]:text-color-violeta ${a?"opacity-100 h-auto max-h-[500px] transition-[opacity_max-height] pointer-events-auto":"opacity-0  max-h-0 transition-[opacity_max-height] pointer-events-none"}`,children:[e.jsxs("div",{id:c.pendiente,className:c.pendiente,onClick:m,children:[e.jsx("p",{className:"font-bold",children:"Pendientes"}),e.jsx("strong",{className:"text-2xl",children:n})]}),e.jsxs("div",{id:c.cancelada,className:c.cancelada,onClick:m,children:[e.jsx("p",{className:"font-bold",children:"Canceladas"}),e.jsx("strong",{className:"text-2xl",children:e.jsx(S,{to:i})})]}),e.jsxs("div",{id:c.pago,className:c.pago,onClick:m,children:[e.jsx("p",{className:"font-bold",children:"Pagas"}),e.jsx("strong",{className:"text-2xl",children:e.jsx(S,{to:x})})]}),e.jsxs("div",{id:"Todas",className:"border-slate-400",onClick:m,children:[e.jsx("p",{className:"font-bold text-color-violeta",children:"Todas"}),e.jsx("strong",{className:"text-2xl text-color-violeta",children:e.jsx(S,{to:f})})]})]})]})}function De(){const{setMensaje:s}=T(),{loading:a}=O(),{loading:t}=y(),{reservas:r,seleccionadas:i}=b(),{semanaAnterior:n,semanaSiguiente:x,diasSemana:f,setSeleccionadas:l,seleccionarDia:u}=ee(),m=()=>{l([])},o=B(),d=g=>{const h="admin",N=g.target.getAttribute("data-fecha"),p=_(new Date(`${N}`),r),H=p.estado&&p.estado!==c.cancelada||p.proximaHoraNoDisponible,L=p.estado;if(p.estado===c.pago||p.estado===c.pendiente){l(p.reservadas);return}if(L&&l(p.reservadas),H){s("Hora no disponible para hacer una reserva");return}if(g.target.className.includes("horaAdmin")){const D={horario:{horaInicio:p.id},paciente:{nombre:h}};o(v.admin.agregarReserva,{state:{from:v.admin.calendario,reserva:D}})}else{const D={horario:{horaInicio:p.id}};o(v.admin.agregarReserva,{state:{from:v.admin.calendario,reserva:D}})}};return e.jsxs(e.Fragment,{children:[a&&e.jsx(P,{}),(i==null?void 0:i.length)>0?e.jsx(J,{reservas:i,cerrarReserva:m}):null,e.jsxs("main",{className:"grid py-8 px-2 w-full ",children:[e.jsx(ie,{setSeleccionadas:l}),e.jsxs("article",{className:"max-w-4xl grid justify-self-center border rounded-lg border-black w-full",children:[e.jsx(oe,{handleSeleccionarDia:u}),e.jsx(E,{loading:t,semanaAnterior:n,semanaSiguiente:x}),e.jsx(re,{diasSemana:f,reservarHora:d}),e.jsx(E,{loading:t,semanaAnterior:n,semanaSiguiente:x})]})]})]})}export{De as default};
