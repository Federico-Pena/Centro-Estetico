import{r as a,U as N,M as H,j as e,a as B}from"./index-2cc50e4a.js";import{H as f,M,E as b,a as _}from"./constantes-122ae6b5.js";import{C as U}from"./ContadorReservas-58851a39.js";import{f as y,c as k,L as G}from"./diasSemanaConHoras-e85ef6eb.js";import{b as I,F as V,L as q,o as g,C as L}from"./ContenedorReservas-d65c717f.js";import{T as z}from"./TransitionNumber-7b383953.js";import{f as w}from"./fetchData-26851f92.js";import"./BotonPrimario-9f9d88b0.js";const J=({setDiaPadre:m,reservas:x,actualizarReservas:h})=>{const[l,j]=a.useState(f.split("T")[0]),[t,R]=a.useState(f.split("-")[1]),[r,p]=a.useState(f.split("T")[1]),[o,d]=a.useState([]),[C,T]=a.useState(0),[E,n]=a.useState(0),[v,i]=a.useState(!1),{accessToken:F}=a.useContext(N),{setMensaje:D}=a.useContext(H),{diaConHoras:S,horas:A}=I(l,r);a.useEffect(()=>{t&&(async()=>{const c={headers:{"Content-Type":"application/json",Authorization:`Bearer ${F||""}`}},u=`${_.reservas.dias}${t}`;await w(u,c,O)})()},[F,t]);const O=s=>{if(s.error)D(s.error);else{const{cantidad:c,totalReservasMes:u,fechas:Y}=s;T(c),n(u),c>0&&d(Y)}},P=s=>{const c=s.target.textContent;p(c);const u=k(new Date(`${l} ${c}`),x);if(u.proximaHoraNoDisponible===b.cancelada||u.estado===b.cancelada){i(!0);return}if(u.estado||u.proximaHoraNoDisponible){D("Hora no disponible para hacer una reserva"),p("");return}i(!0)};function $(s){return s>=1&&s<=12?M[s-1]:"Mes no vÃ¡lido"}return e.jsxs("section",{className:"containerFechasYHoras",children:[v&&e.jsx(e.Fragment,{children:e.jsx(V,{reserva:{fecha:new Date(`${l} ${r}`),pacienteNombre:r==="08:00"||r==="08:30"?"admin":null},setForm:()=>i(!1),actualizarReserva:s=>{h(s),s.reserva&&i(!1)}})}),e.jsxs("div",{className:"select-container-container",children:[e.jsxs("div",{className:"select-container",children:[e.jsxs("select",{value:t,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:t,children:`${$(t)}`},t),M.map((s,c)=>s!==`${$(t)}`&&e.jsx("option",{value:c+1,children:s},s))]}),e.jsxs("h3",{children:["Fechas en ",`${$(t)}`," ",e.jsx(z,{from:0,to:C,duration:500})]}),e.jsxs("h3",{children:["Reservas en ",`${$(t)}`," ",e.jsx(z,{from:0,to:E,duration:500})]})]}),e.jsxs("select",{className:"selectedFecha",name:"selectedFecha",onChange:s=>{const c=s.target.value.split("T")[0];m(c),j(c)},children:[e.jsxs("option",{value:f.split("T")[0],children:["Hoy"," ",y({fecha:new Date(f)})]}),(o==null?void 0:o.length)>0&&(o==null?void 0:o.map(s=>s!==f.split("T")[0]&&e.jsx("option",{className:"selectedComponent-option",value:s,children:y({fecha:new Date(`${s} ${r}`)})},s)))]}),S&&e.jsx("ul",{className:"horasDisplay",children:e.jsx(q,{diaConHoras:S,horas:A,onClickReservar:P,reservas:x})})]})]})},K=m=>{const[x,h]=a.useState([]),[l,j]=a.useState(!1),{setMensaje:t}=a.useContext(H),{accessToken:R}=a.useContext(N);return a.useEffect(()=>{m&&(async()=>{j(!0);const p={headers:{"Content-Type":"application/json",Authorization:`Bearer ${R||""}`}};try{const o=`${_.reservas.deUnDia}${m}`;await w(o,p,d=>{d.error?t(d.error):h(d.data.sort(g))})}catch(o){t(o.message)}finally{j(!1)}})()},[m,R,t]),{delDia:x,loading:l,setDelDia:h}},Q=K;function oe(){const[m,x]=a.useState(f.split("T")[0]),[h,l]=a.useState([]),{loading:j}=a.useContext(N),{setMensaje:t}=a.useContext(H),{loading:R,delDia:r,setDelDia:p,loadingSemana:o}=Q(m),d=n=>{const v=r.filter(i=>i._id!==n._id);p(v.concat(n).sort(g))},C=n=>{const{reserva:v,error:i,mensaje:F}=n;if(i)t(i);else{t(F);const D=r.filter(S=>S._id!==v._id);p(D.sort(g)),l([])}},T=n=>{if(n==="Toda")l(r.sort(g));else{const v=r.filter(i=>i.estado===n);l(v.sort(g))}},E=n=>{n.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{n.current.parentElement.classList.remove("animationReservaOut"),l([])},500)};return e.jsxs(e.Fragment,{children:[(j||R)&&e.jsx(B,{}),e.jsx("main",{className:"divPageReservas",children:h.length>0?e.jsx(L,{reservas:h,actualizarReservas:d,actualizarReservaEliminada:C,cerrarReserva:E}):e.jsxs(e.Fragment,{children:[e.jsx(U,{reservas:r,mostrarReservadas:T}),e.jsx(J,{actualizarReservas:d,reservas:r,setDiaPadre:x}),o?e.jsx(G,{}):null,e.jsx(L,{reservas:r,actualizarReservas:d,actualizarReservaEliminada:C})]})})]})}export{oe as default};
