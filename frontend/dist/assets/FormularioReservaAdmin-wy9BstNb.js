import{j as o,e as k,E as c,g as q,h as L,i as O,r as b,T as P,R as z,k as _,l as j,b as B,m as U,D as G,c as R,S as M,d as J,B as S,n as K}from"./index-eEc2nAUg.js";import{f as Q}from"./formatHoraUser-TJ92Iw1g.js";const W=({values:e})=>{const n=new Date(e.horaInicio).getDay()===6;return o.jsxs("ul",{className:"grid gap-2 border-t border-b border-slate-500 py-4",children:[o.jsx("li",{className:"text-color-violeta text-xl text-center mb-4",children:"Resumen de la reserva"}),e.nombre&&o.jsxs("li",{className:"capitalize grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Nombre ",o.jsx("strong",{className:"text-end",children:e.nombre})]}),e.horaInicio&&!n&&o.jsxs("li",{className:"capitalize grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Dia"," ",o.jsx("strong",{className:"text-end",children:k(new Date(`${e.horaInicio} 00:00:00`))})]}),e.hora&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Hora ",o.jsx("strong",{className:"text-end",children:e.hora})]}),e.observaciones&&o.jsxs("li",{className:"grid  gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Observaciones",o.jsx("strong",{className:"text-end",children:e.observaciones})]}),e.servicio&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta",children:["Servicio",o.jsx("strong",{className:"capitalize text-end",children:e.servicio})]}),e.tratamiento&&o.jsxs("li",{className:"grid gap-2 bg-color-verde-blanco p-4 rounded-lg text-color-violeta ",children:["Tratamiento",o.jsx("strong",{className:"text-end",children:e.tratamiento})]})]})},X=({horasDisponibles:e,values:n,reservasDelDia:d,handleChange:l,setMensaje:a,errors:m})=>{const x=s=>{const i=s.target.textContent,r=q(new Date(`${n.horaInicio} ${i}`),d);if(r.estado&&r.estado!==c.cancelada||r.proximaHoraNoDisponible){a("Hora no disponible para hacer una reserva");return}else l({target:{name:"hora",value:i}})};return o.jsxs(o.Fragment,{children:[o.jsxs("ul",{className:"grid gap-4 grid-cols-5",children:[o.jsx("li",{className:"col-span-full",children:"Hora"}),e.map(s=>o.jsx("li",{className:`p-2 rounded-xl w-full grid place-content-center shadow-md max-w-20 transition-[max-width] ${Y(s,n)}`,onClick:x,children:s.id.split("T")[1]},s.id))]}),m.hora&&o.jsxs("small",{className:"text-red-600",children:["* ",m.hora]}),o.jsxs("ul",{className:"grid grid-flow-col grid-rows-3 gap-4 border border-slate-500 p-4 rounded-lg",children:[o.jsx("li",{className:"col-span-full opacity-50 p-2 rounded-xl w-full grid place-content-center shadow-md m-auto",children:"No disponible"}),o.jsx("li",{className:"p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50",children:"Disponible"}),o.jsx("li",{className:`${c.pago} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Paga"}),o.jsx("li",{className:`${c.pendiente} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Pendiente"}),o.jsx("li",{className:`${c.cancelada} text-white p-2 rounded-xl w-full grid place-content-center shadow-md m-auto  bg-slate-50`,children:"Cancelada"})]})]})},Y=(e,n)=>{const d=e.proximaHoraNoDisponible,l=e.id.split("T")[1]===n.hora,a=e.estado;return[d&&"opacity-50 cursor-not-allowed",(a===c.pago||a===c.pendiente)&&`${a} cursor-not-allowed text-white`,a===c.cancelada&&`${a} text-white`,l&&"bg-color-violeta col-span-full row-start-2 text-white max-w-xl font-bold opacity-100 cursor-default",!d&&!l&&(a!==c.pago||a!==c.pendiente)&&"bg-slate-50 cursor-pointer"].filter(Boolean).join(" ")},Z=e=>({pacienteNombre:e.nombre,fecha:new Date(`${e.horaInicio} ${e.hora}`),observaciones:e.observaciones,servicio:e.servicio,tratamiento:e.tratamiento,estado:e.estado||""}),ee={nombre:{required:!0},horaInicio:{required:!0},servicio:{required:!0},tratamiento:{required:!0},hora:{required:!0}},oe=(e,n,d)=>{var a,m,x,s,i;return{nombre:((a=e==null?void 0:e.paciente)==null?void 0:a.nombre)||"",horaInicio:((m=e==null?void 0:e.horario)==null?void 0:m.horaInicio.split("T")[0])||"",hora:(n||d)&&Q((x=e==null?void 0:e.horario)==null?void 0:x.horaInicio)||"",observaciones:(e==null?void 0:e.observaciones)||"",servicio:((s=e==null?void 0:e.servicio)==null?void 0:s.nombre)||"",tratamiento:((i=e==null?void 0:e.tratamiento)==null?void 0:i.descripcion)||"",estado:(e==null?void 0:e.estado)||""}},re=()=>{var D,C;const e=L(),n=O(),d=(D=e.state)==null?void 0:D.reserva,{setMensaje:l}=b.useContext(P),{reserva:a,dispatch:m}=b.useContext(z),{loading:x}=b.useContext(_),s=e.pathname===j.admin.agregarReserva&&((C=e.state)==null?void 0:C.from)===j.admin.calendario,i=e.pathname===j.admin.editarReserva,{handleChange:r,values:t,errors:g,validateForm:F,resetForm:I}=B(oe(a||d,i,s),ee),{horasDisponibles:w,reservasDelDia:T,agregarReserva:y,editarReserva:E,pacientesNombres:A}=U(t.horaInicio),N=new Date(t.horaInicio).getDay()===6,$=p=>{r({target:{name:"hora",value:""}}),r(p)},v=async p=>{if(p.preventDefault(),F()&&!N){const u=Z(t);console.log(t),(i?await E(u,a._id):await y(u))?f():l("Ocurrió un error al guardar el paciente.")}else console.log(g),l("Faltan campos requeridos.")},f=()=>{I(),m({type:K.SET_RESERVA,payload:null}),n(-1)},H=p=>{const u={target:{name:"nombre",value:p.target.textContent}};r(u)},V=p=>p.map(h=>h.nombre);return!x&&o.jsxs("section",{className:"grid px-4 py-8",children:[o.jsxs("h1",{className:"font-betonga font-bold text-color-violeta text-2xl tracking-wider text-center mb-4",children:[i?"Editar":"Crear"," Reserva"]}),o.jsxs("form",{className:"animate-toastIn bg-color-logo rounded-lg p-4 max-w-xl m-auto w-full grid gap-4 border border-black",onSubmit:v,children:[!i&&o.jsx(G,{name:"Pacientes existentes",onClickFunction:H,list:V(A)}),o.jsx(R,{placeholder:"Nombre",value:t.nombre,labelText:"Nombre",name:"nombre",type:"text",errors:g,onChange:r}),o.jsx(R,{className:"w-full",value:t.horaInicio.split("T")[0],labelText:"Fecha",name:"horaInicio",type:"date",errors:g,onChange:$}),N?o.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los días domingos no se realizan reservas"}):null,w.length>0&&t.horaInicio&&o.jsx(o.Fragment,{children:o.jsx(X,{horasDisponibles:w,values:t,setMensaje:l,handleChange:r,reservasDelDia:T,errors:g})}),o.jsx("label",{children:"Servicio y Tratamiento"}),o.jsx(M,{values:t,handleChange:r,errors:g}),o.jsx(J,{value:t.observaciones,onChange:r,name:"observaciones",labelText:t.nombre==="admin"?"Compromisos separados por comas":"Observaciones"}),o.jsx(W,{values:t}),o.jsxs("footer",{className:"grid grid-flow-col gap-4",children:[o.jsx(S,{bgColor:!0,className:`${x?"opacity-65 cursor-not-allowed":""} w-full`,tipo:"submit",texto:"Guardar",disabled:x}),o.jsx(S,{className:"w-full",tipo:"button",onClickFunction:f,texto:"Cerrar"})]})]})]})};export{re as default};
