import{r as a,U as N,M as H,j as e,a as Y}from"./index-4e232b89.js";import{H as $,M as b,E as w,a as _,f as L}from"./constantes-5af98ff7.js";import{C as B}from"./ContadorReservas-38c56be7.js";import{f as S,c as k,L as G}from"./diasSemanaConHoras-71219598.js";import{c as V,F as q,L as J,o as C,C as y}from"./ContenedorReservas-38f36316.js";import{T as z}from"./TransitionNumber-4119ef34.js";import{f as I}from"./fetchData-919cca5f.js";import"./BotonPrimario-8972ad95.js";const K=({setDiaPadre:h,reservas:f,actualizarReservas:m})=>{const[l,x]=a.useState($.split("T")[0]),[t,j]=a.useState($.split("-")[1]),[r,v]=a.useState($.split("T")[1]),[n,p]=a.useState([]),[D,T]=a.useState(0),[E,i]=a.useState(0),[o,d]=a.useState(!1),{accessToken:R}=a.useContext(N),{setMensaje:g}=a.useContext(H),{diaConHoras:M,horas:A}=V(l,r);a.useEffect(()=>{t&&(async()=>{const c={headers:{"Content-Type":"application/json",Authorization:`Bearer ${R||""}`}},u=`${_.reservas.dias}${t}`;await I(u,c,O)})()},[R,t]);const O=s=>{const{cantidad:c,totalReservasMes:u,fechas:U}=s;T(c),i(u),c>0&&p(U)},P=s=>{const c=s.target.textContent;v(c);const u=k(new Date(`${l} ${c}`),f);if(u.proximaHoraNoDisponible===w.cancelada||u.estado===w.cancelada){d(!0);return}if(u.estado||u.proximaHoraNoDisponible){g("Hora no disponible para hacer una reserva"),v("");return}d(!0)};function F(s){return s>=1&&s<=12?b[s-1]:"Mes no vÃ¡lido"}return e.jsxs("section",{className:"containerFechasYHoras",children:[o&&e.jsx(e.Fragment,{children:e.jsx(q,{reserva:{fecha:new Date(`${l} ${r}`),pacienteNombre:r==="08:00"||r==="08:30"?"admin":null},setForm:()=>d(!1),actualizarReserva:m})}),e.jsxs("div",{className:"select-container-container",children:[e.jsxs("div",{className:"select-container",children:[e.jsxs("select",{value:t,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:t,children:`${F(t)}`},t),b.map((s,c)=>s!==`${F(t)}`&&e.jsx("option",{value:c+1,children:s},s))]}),e.jsxs("h3",{children:["Fechas en ",`${F(t)}`," ",e.jsx(z,{from:0,to:D,duration:500})]}),e.jsxs("h3",{children:["Reservas en ",`${F(t)}`," ",e.jsx(z,{from:0,to:E,duration:500})]})]}),e.jsxs("select",{className:"selectedFecha",name:"selectedFecha",onChange:s=>{const c=s.target.value.split("T")[0];h(c),x(c)},children:[e.jsxs("option",{value:$.split("T")[0],children:["Hoy"," ",S({fecha:new Date($)})]}),(n==null?void 0:n.length)>0&&(n==null?void 0:n.map(s=>e.jsx("option",{className:"selectedComponent-option",value:s,children:S({fecha:new Date(`${s} ${r}`)})},s)))]}),M&&e.jsx("ul",{className:"horasDisplay",children:e.jsx(J,{diaConHoras:M,horas:A,onClickReservar:P,reservas:f})})]})]})},Q=h=>{const[f,m]=a.useState([]),[l,x]=a.useState(!1),{setMensaje:t}=a.useContext(H),{accessToken:j}=a.useContext(N);return a.useEffect(()=>{h&&(async()=>{x(!0);const v={headers:{"Content-Type":"application/json",Authorization:`Bearer ${j||""}`}};try{const n=`${_.reservas.deUnDia}${h}`;await I(n,v,p=>{m(p.data.sort(C))})}catch(n){t(n.message)}x(!1)})()},[h,j,t]),{delDia:f,loading:l,setDelDia:m}},W=Q;function ne(){const[h,f]=a.useState($.split("T")[0]),[m,l]=a.useState([]),{loading:x}=a.useContext(N),{setMensaje:t}=a.useContext(H),{loading:j,delDia:r,setDelDia:v,loadingSemana:n}=W(h),p=i=>{const{reserva:o}=i,d=`Reserva nueva de ${o.pacienteNombre} el dia ${S({fecha:o.horario.horaInicio})} a las  ${L(new Date(o.horario.horaInicio))}`;t(d);const R=r.filter(g=>g._id!==o._id);v(R.concat(o).sort(C))},D=i=>{const{reserva:o}=i,d=`Reserva borrada de ${o.pacienteNombre} el dia ${S({fecha:o.horario.horaInicio})} a las  ${L(new Date(o.horario.horaInicio))}`;t(d);const R=r.filter(g=>g._id!==o._id);v(R.sort(C))},T=i=>{if(i==="Toda")l(r.sort(C));else{const o=r.filter(d=>d.estado===i);l(o.sort(C))}},E=i=>{i.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{i.current.parentElement.classList.remove("animationReservaOut"),l([])},500)};return e.jsxs(e.Fragment,{children:[(x||j)&&e.jsx(Y,{}),e.jsx("main",{className:"divPageReservas",children:m.length>0?e.jsx(y,{reservas:m,actualizarReservas:p,actualizarReservaEliminada:D,cerrarReserva:E}):e.jsxs(e.Fragment,{children:[e.jsx(B,{reservas:r,mostrarReservadas:T}),e.jsx(K,{actualizarReservas:p,reservas:r,setDiaPadre:f}),n?e.jsx(G,{}):null,e.jsx(y,{reservas:r,actualizarReservas:p,actualizarReservaEliminada:D})]})})]})}export{ne as default};
