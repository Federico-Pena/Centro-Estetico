import{O as R,Q as V,V as $,W as F,X as L,Y as M,f as U,a as B,r as d,Z as E,T,U as _,k as D,m as b,j as e,B as y,_ as P,g as O,E as c,e as k,$ as A,i as Z,s as z,R as N}from"./index-TJkQKCZh.js";import{f as Y}from"./formatHoraUser-TJ92Iw1g.js";import{C as G}from"./ContenedorReservas-9kflq2cG.js";import"./ConfirmationModal-TVivuumD.js";const I=6,Q=0,W=(s,a,t)=>!(s===20&&a===30)&&!(t.getDay()===I&&s===12&&a===30)&&t.getDay()!==Q,X=s=>{const a=new Date(s);return Number.isNaN(a.getTime())?[]:(a.setDate(a.getDate()-a.getDay()),Array.from({length:R},(o,i)=>{const r=new Date(a),l=[],g=r.getDay()===I?V:$;r.setDate(a.getDate()+i);for(let m=M;m<=g;m++)for(let x=0;x<F;x+=L)if(W(m,x,r)){const p=new Date(r);p.setHours(m,x,0),l.push(p)}return{dia:r,horas:l}}))},q=async(s,a)=>{const t={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},o=`${B.reservas.deLaSemana}${a}`;return await U(o,t)},J=()=>{const[s,a]=d.useState(!1),[t,o]=d.useState(E.split("T")[0]),{setMensaje:i}=d.useContext(T),{accessToken:r}=d.useContext(_),{dispatch:l}=d.useContext(D),g=X(t);return d.useEffect(()=>{t&&(async()=>{a(!0);const u=await q(r,t),{datos:f,error:S,status:j}=u;console.log(f),j===200?l({type:b.SET_RESERVAS,payload:f}):f?i(S||"Ocurrió un error al obtener las reservas de la semana"):l({type:b.SET_RESERVAS,payload:[]}),a(!1)})()},[r,i,t,l]),{loading:s,semanaAnterior:()=>{const n=new Date(`${t} 00:00:00.000Z`);n.setDate(n.getDate()-R);const u=n.toISOString().split("T")[0];o(u)},semanaSiguiente:()=>{const n=new Date(`${t} 00:00:00.000Z`);n.setDate(n.getDate()+R);const u=n.toISOString().split("T")[0];o(u)},diasSemana:g,setSeleccionadas:n=>{l({type:b.SET_RESERVAS_SELECCIONADAS,payload:n})},seleccionarDia:n=>{o(n)}}},w=({loading:s,semanaAnterior:a,semanaSiguiente:t})=>e.jsxs("section",{className:"flex justify-between border-t border-black p-2",children:[e.jsx(y,{className:"font-bold  max-w-fit h-max text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md grid place-content-center py-2 px-4 transition-colors hover:text-color-violeta hover:bg-slate-50 md:mx-0",onClickFunction:a,texto:"Anterior",tipo:"button"}),s&&e.jsx(P,{className:"self-center"}),e.jsx(y,{className:"col-start-3 col-end-4 font-bold  max-w-fit h-max text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md grid place-content-center py-2 px-4 transition-colors hover:text-color-violeta hover:bg-slate-50 md:mx-0",onClickFunction:t,texto:"Siguiente",tipo:"button"})]}),K=({horas:s,reservarHora:a})=>{const{reservas:t}=d.useContext(D);return e.jsx("ul",{className:"grid gap-2",children:s.map((o,i)=>{const r=O(o,t);return e.jsx("li",{"data-fecha":r.id,onClick:a,className:`${r.reservaAdmin&&"outline outline-2 outline-color-violeta px-1 horaAdmin"} ${ae(i,r)} text-center rounded-md cursor-pointer hover:scale-105 transition-transform`,children:Y(o)},o)})})},ee=s=>s===c.pendiente?"bg-color-pendiente text-white":s===c.pago?"bg-color-paga text-white":s===c.cancelada?"bg-color-cancelada text-white":"",ae=(s,a)=>s==0||s==1?"outline outline-2 outline-color-violeta px-1 horaAdmin":ee(a.estado),te=({diasSemana:s,reservarHora:a})=>e.jsx("section",{className:"grid grid-cols-3 md:grid-cols-6 border-t border-black",children:s.map(t=>{const o=new Date(t.dia);return o.getDay()!==0&&e.jsxs("div",{className:"grid grid-rows-[50px,1fr] p-2 gap-4",children:[e.jsx("h3",{className:`grid place-content-center text-center capitalize text-md p-2 text-color-violeta font-betonga font-bold tracking-wide text-pretty rounded ${o.getDate()===new Date().getDate()&&o.getDay()===new Date().getDay()?"bg-color-verde-blanco":""}`,children:k(t.dia)}),e.jsx(K,{horas:t.horas,reservarHora:a})]},o)})}),se=({diasSemana:s,handleSeleccionarDia:a})=>e.jsxs("section",{className:"grid gap-x-4",children:[e.jsxs("h1",{onClick:()=>a(E.split("T")[0]),className:"capitalize p-4 text-xl bg-color-verde-blanco text-center text-color-violeta cursor-pointer rounded-t-lg font-betonga font-bold",children:["Hoy ",k(E)]}),e.jsxs("label",{htmlFor:"fecha",className:"justify-center items-center flex flex-col gap-4 py-4",children:["Seleccionar día"," ",e.jsx("input",{type:"date",className:"border text-center px-4 py-2 rounded-lg",id:"fecha",onChange:t=>{const o=t.target.value;o&&a(o)}})]})]});function oe(s){const a=s.reduce((t,o)=>(o.estado===c.pago?t.terminadas++:o.estado===c.cancelada?t.canceladas++:o.estado===c.pendiente&&t.pendientes++,t),{terminadas:0,canceladas:0,pendientes:0});return{reservasCanceladas:a.canceladas,reservasPendientes:a.pendientes,reservasTerminadas:a.terminadas,reservasTodas:a.canceladas+a.pendientes+a.terminadas}}function ne({setSeleccionadas:s}){const[a,t]=d.useState(!1),{reservas:o}=d.useContext(D),{reservasCanceladas:i,reservasPendientes:r,reservasTerminadas:l,reservasTodas:g}=oe(o),m=h=>{if(h==="Todas")s(o);else{const n=o.filter(u=>u.estado===h);s(n)}},x=()=>{t(!a)},p=h=>{const n=h.currentTarget.id;console.log(n),m(n)};return e.jsxs("div",{className:"m-auto w-full max-w-4xl flex flex-col items-center gap-4 mb-4",children:[e.jsx(y,{className:"text-white w-fit h-fit self-center font-bold bg-color-violeta border-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent",tipo:"button",texto:`${a?"Ocultar Contador":"Mostrar Contador"}`,onClickFunction:x}),e.jsxs("section",{className:`w-full flex flex-wrap gap-4 [&>div]:flex-1 [&>div]:p-3 [&>div]:text-center [&>div]:rounded-md [&>div]:cursor-pointer [&>div]:transition-colors [&>div]:text-white [&>div]:font-betonga [&>div]:tracking-wider [&>div]:border hover:[&>div]:bg-slate-200 hover:[&>div]:text-color-violeta ${a?"opacity-100 h-auto max-h-[500px] transition-[opacity_max-height] pointer-events-auto":"opacity-0  max-h-0 transition-[opacity_max-height] pointer-events-none"}`,children:[e.jsxs("div",{id:c.pendiente,className:c.pendiente,onClick:p,children:[e.jsx("p",{className:"font-bold",children:"Pendientes"}),e.jsx("strong",{className:"text-2xl",children:r})]}),e.jsxs("div",{id:c.cancelada,className:c.cancelada,onClick:p,children:[e.jsx("p",{className:"font-bold",children:"Canceladas"}),e.jsx("strong",{className:"text-2xl",children:e.jsx(A,{to:i})})]}),e.jsxs("div",{id:c.pago,className:c.pago,onClick:p,children:[e.jsx("p",{className:"font-bold",children:"Pagas"}),e.jsx("strong",{className:"text-2xl",children:e.jsx(A,{to:l})})]}),e.jsxs("div",{id:"Todas",className:"border-slate-400",onClick:p,children:[e.jsx("p",{className:"font-bold text-color-violeta",children:"Todas"}),e.jsx("strong",{className:"text-2xl text-color-violeta",children:e.jsx(A,{to:g})})]})]})]})}function xe(){const{setMensaje:s}=d.useContext(T),{loading:a}=d.useContext(_),{reservas:t,dispatch:o,seleccionadas:i}=d.useContext(D),{semanaAnterior:r,semanaSiguiente:l,loading:g,diasSemana:m,setSeleccionadas:x,seleccionarDia:p}=J(),h=()=>{x([])},n=Z(),u=f=>{const S="admin",j=f.target.getAttribute("data-fecha"),v=O(new Date(`${j}`),t),H=v.estado&&v.estado!==c.cancelada||v.proximaHoraNoDisponible;if(v.estado&&x(v.reservadas),H){s("Hora no disponible para hacer una reserva");return}if(f.target.className.includes("horaAdmin")){const C={horario:{horaInicio:v.id},paciente:{nombre:S}};o({type:b.SET_RESERVA,payload:C}),n(N.admin.agregarReserva,{state:{from:N.admin.calendario}})}else{const C={horario:{horaInicio:v.id}};o({type:b.SET_RESERVA,payload:C}),n(N.admin.agregarReserva,{state:{from:N.admin.calendario}})}};return e.jsxs(e.Fragment,{children:[a&&e.jsx(z,{}),(i==null?void 0:i.length)>0?e.jsx(G,{reservas:i,cerrarReserva:h}):null,e.jsxs("main",{className:"grid py-8 px-2 w-full ",children:[e.jsx(ne,{setSeleccionadas:x}),e.jsxs("article",{className:"max-w-4xl grid  mx-auto border rounded-lg border-black",children:[e.jsx(se,{diasSemana:m,handleSeleccionarDia:p}),e.jsx(w,{loading:g,semanaAnterior:r,semanaSiguiente:l}),e.jsx(te,{diasSemana:m,reservarHora:u}),e.jsx(w,{loading:g,semanaAnterior:r,semanaSiguiente:l})]})]})]})}export{xe as default};
