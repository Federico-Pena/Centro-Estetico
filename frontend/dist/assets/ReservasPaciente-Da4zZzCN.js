import{u as h,r as g,n as S,c as v,j as o,m as j,R as C,b,E as m}from"./index-BN4e8_cD.js";import{f as A,a as T,u as y,b as P}from"./useLoaderContext-CL4xz49p.js";import{u as E}from"./useReservasContext-C7eBPDtl.js";import{C as w}from"./ContenedorReservas-DSt0R0fd.js";import{P as _,R as N}from"./ResumenReservas-mgPNI6IO.js";import{B as x}from"./Button-D70TNmHc.js";import"./formatFechaParaUser-B35bwiOM.js";import"./ConfirmationModal-ChS9Prfp.js";import"./useObserver-lcFBawrA.js";import"./formatHoraUser-DhkUKUiJ.js";const O=async(t,e,a)=>{const s={headers:{"Content-Type":"application/json",Authorization:`Bearer ${t||""}`}},n=`${T.reservas.deUnPacientes}${e}/${a}`;return await A(n,s)},U=t=>{const{accessToken:e}=y(),{setMensaje:a}=h(),{dispatch:s}=E(),{setLoading:n}=P(),[r,c]=g.useState(1),[p,u]=g.useState(1);return g.useEffect(()=>{(async()=>{try{n(!0);const i=await O(e,r,t),{status:l,error:R,datos:d}=i;l===200?(s({type:S.SET_RESERVAS,payload:d.reservas}),c(d.page),u(d.totalPages)):a(R||"Ocurrió un error al obtener las reservas del paciente")}catch{a("Ocurrió un error al obtener las reservas del paciente")}finally{n(!1)}})()},[e,r,s,a,t,n]),{pagina:r,totalPaginas:p,setPagina:c}},V=({handleAgregarReserva:t})=>{const e=v();return o.jsxs("header",{className:"border-b border-slate-500 py-4 gap-2 grid grid-flow-col",children:[o.jsx(x,{className:"w-full",tipo:"button",onClickFunction:()=>e(-1),texto:"Volver"}),o.jsx(x,{className:"w-full",tipo:"button",onClickFunction:t,texto:"Agregar"})]})},Y=()=>{var l;const e=(l=j().state)==null?void 0:l.paciente,a=v(),{loading:s}=P(),{reservas:n}=E(),{totalPaginas:r,setPagina:c}=U(e._id),p=async()=>{a(C.admin.agregarReserva,{state:{reserva:{paciente:{nombre:e.nombre},horario:{horaInicio:b.split("T")[0]}}}})},{paga:u,cancelada:f,pendiente:i}=$(n);return o.jsxs("section",{className:"grid grid-rows-[70px_auto_1fr] gap-4 mx-auto max-w-5xl w-full p-4",children:[o.jsx(V,{handleAgregarReserva:p}),n.length>0&&o.jsx(_,{loading:s,totalPages:r,onPageChange:c}),o.jsx(N,{cancelada:f,pago:u,pendiente:i}),o.jsx(w,{reservas:n})]})},$=t=>{const e={pendiente:0,paga:0,cancelada:0};return t.forEach(a=>{const{estado:s}=a;s===m.pago?e.paga++:s===m.pendiente?e.pendiente++:s===m.cancelada&&e.cancelada++}),e};export{Y as default};
