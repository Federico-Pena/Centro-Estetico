import{j as e,E as F,u as y,r as d,H as k,A as T}from"./index-YAdz76Jm.js";import{O as H,C as q}from"./OpenInfo-0kH-_mRx.js";import{u as R,a as I,f as E,b as z}from"./useLoaderContext-_SMLR0xo.js";import{f as D}from"./useReservasContext-D-al89pr.js";import{L as S}from"./LabelInput-iD2B8GI7.js";import{u as V}from"./useForm-kpLBmbY3.js";import{T as L}from"./TextAreaLabel-U7btEOxD.js";import{u as M}from"./useFormReserva-vENUwRLe.js";import{B as $}from"./Button-qbGwCLcH.js";import{D as X}from"./Dropdown-UufBkZzb.js";import"./useObserver-k1XNW9GD.js";import"./compararFechas-sMQnMgQ2.js";function w(t){return t&&t.split(" ").map(r=>r[0].toUpperCase()+r.substring(1)).join(" ")}const B=t=>{const r="59894539587",n=`Me interesa hacer la siguiente reserva. 
  Nombre: ${w(t.nombre)}.
  Fecha: ${w(D(`${t.fecha} ${t.hora}`))}.
  Hora: ${t.hora}. 
  Servicio: ${w(t.servicio)}. 
  Tratamiento: ${w(t.tratamiento)}. 
  ${t.observaciones&&`Observaciones: ${w(t.observaciones)}.`}`;window.open(`https://wa.me/${r}?text=${encodeURIComponent(n)}`,"_blank")},U=({values:t,handleSetHora:r,horasDisponibles:n})=>e.jsxs("ul",{className:"grid gap-4 grid-cols-5",children:[e.jsx("li",{className:"col-span-full",children:"Horas disponibles"}),n.map((o,i)=>i!==0&&i!==1&&o.estado!==F.pendiente&&o.estado!==F.pago&&!o.proximaHoraNoDisponible&&e.jsx("li",{className:`p-2 rounded-xl w-full grid place-content-center shadow-md ${o.id.split("T")[1]===t.hora?"col-span-full row-start-2 bg-color-violeta text-slate-50 max-w-md transition-[max-width]":"bg-slate-50 max-w-20 hover:opacity-50 cursor-pointer transition-opacity"}`,onClick:()=>r(o.id.split("T")[1]),children:o.id.split("T")[1]},o.id))]}),P=({values:t,horasDisponibles:r})=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-betonga text-color-violeta font-bold capitalize text-center underline underline-offset-4 text-2xl px-4",children:"Resumen"}),t.nombre&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Nombre ",e.jsx("strong",{className:"text-end text-balance",children:t.nombre})]}),t.fecha&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Dia",e.jsx("strong",{className:"text-end text-balance",children:D(`${t.fecha} ${t.hora}`)})]}),t.hora&&r.length>0&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Hora ",e.jsx("strong",{className:"text-end text-balance",children:t.hora})]}),t.servicio&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Servicio",e.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:t.servicio})]}),t.tratamiento&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Tratamiento",e.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:t.tratamiento})]}),t.observaciones&&e.jsxs("span",{className:"bg-white gap-4 text-color-violeta py-2 px-4 grid grid-cols-[1fr,2fr] rounded capitalize",children:["Observación",e.jsx("strong",{className:"text-end text-nowrap overflow-auto",children:t.observaciones})]})]}),G={nombre:{required:!0},fecha:{required:!0},hora:{required:!0},servicio:{required:!0},tratamiento:{required:!0}},O=({servicio:t,cerrarFormulario:r})=>{const{loading:n}=R(),{setMensaje:o}=y(),i=d.useRef(),x={nombre:"",fecha:"",hora:"",observaciones:"",servicio:t.nombre||"",tratamiento:""},{errors:a,handleChange:m,values:s,validateForm:p}=V(x,G),{horasDisponibles:f}=M(s.fecha),g=new Date(s.fecha).getDay()===6,b=c=>{c.preventDefault(),p()&&!g&&s.nombre?(B(s),l()):o("Faltan campos requeridos.")},l=()=>{i.current.classList.add("animate-fadeOut")},u=c=>{m({target:{name:"hora",value:c}})},j=c=>{const N={target:{name:"tratamiento",value:c.target.textContent}};m(N)},h=c=>c.map(v=>`${v.descripcion} - ${v.sesiones} ${v.sesiones>1?"Sesiones":"Sesión"}`);return e.jsxs("section",{id:"sectionForm",ref:i,className:"grid grid-rows-[50px_1fr] p-4 py-8",onAnimationEnd:c=>{c.target.id==="sectionForm"&&c.animationName!=="fadeIn"&&r()},children:[e.jsx("h1",{className:"font-betonga text-color-violeta font-bold capitalize text-center underline underline-offset-4 text-2xl px-4",children:"Reserva"}),e.jsxs("form",{onSubmit:b,className:"animate-fadeIn grid w-full max-w-md py-8 px-4 rounded-lg gap-4 m-auto bg-color-verde-blanco border border-gray-300 shadow-lg",children:[e.jsx(S,{errors:a,labelText:"Nombre",name:"nombre",onChange:m,placeholder:"Nombre",type:"text",value:s.nombre}),e.jsx(S,{className:"w-full",errors:a,labelText:"Fecha",name:"fecha",onChange:c=>{m(c),u("")},type:"date",value:s.fecha,min:k.split("T")[0]}),g?e.jsx("span",{className:"p-2 rounded-xl w-full text-center shadow-md bg-color-violeta text-slate-50",children:"* Los días domingos no se realizan reservas"}):null,f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(U,{horasDisponibles:f,handleSetHora:u,values:s}),a.hora&&e.jsx("small",{className:"text-red-600",children:"* Este campo es requerido"})]}),e.jsx(S,{className:"w-full capitalize",errors:a,labelText:"Servicio",name:"servicio",disabled:!0,type:"text",value:s.servicio}),e.jsx("label",{children:"Tratamientos"}),a&&a.tratamiento&&e.jsxs("small",{className:"text-red-600",children:["* ",a.tratamiento]}),e.jsx(X,{defaultValue:s.tratamiento,name:"tratamiento",list:h(t.tratamientos),onClickFunction:j}),e.jsx(L,{value:s.observaciones,placeholder:"Observación",onChange:m,name:"observaciones",labelText:"Observación",error:a.observaciones}),e.jsx(P,{horasDisponibles:f,values:s}),e.jsxs("footer",{className:"grid grid-flow-col pt-8 px-4 gap-4",children:[e.jsx($,{className:"w-full",tipo:"button",onClickFunction:l,texto:"Volver"}),e.jsx($,{className:"w-full",bgColor:!0,tipo:"submit",texto:"Enviar",disabled:n})]})]})]})},Y=()=>{const[t,r]=d.useState(0),[n,o]=d.useState([]),{setMensaje:i}=y(),{accessToken:x}=I();return d.useEffect(()=>{(async()=>{const p=z.publicas.getPromociones,f={headers:{authorization:`Bearer ${x}`}},g=await E(p,f),{error:b,datos:l,status:u}=g;u===200?o(l):i(b||"Error al obtener los datos")})()},[i,x]),d.useEffect(()=>{const p=setInterval(()=>{const f=(t+1)%n.length;r(f)},5e3);return()=>{clearInterval(p)}},[t,n.length]),{promos:n,nextSlide:()=>{const s=(t+1)%n.length;r(s)},prevSlide:()=>{const s=(t-1+n.length)%n.length;r(s)},currentIndex:t}},J=({promos:t,handleReservar:r,currentIndex:n})=>e.jsx("div",{className:"overflow-hidden flex rounded-lg border border-slate-500",children:t.map(o=>{var i,x;return e.jsxs("figure",{className:"transition-transform duration-500 relative flex-[0_0_100%]",style:{transform:`translateX(-${n*100}%)`},children:[e.jsx("img",{className:"object-cover w-full h-full bg-slate-50 aspect-square max-h-[500px]",src:((i=o.imagen)==null?void 0:i.secure_url)||((x=o.servicio.imagen)==null?void 0:x.secure_url),alt:o.nombre}),e.jsx("button",{className:"absolute w-full max-w-64 bottom-4 left-1/2 -translate-x-1/2 font-bold text-slate-50 border-color-violeta bg-color-violeta border-[1px] rounded-md py-2 px-4 transition-colors hover:text-color-violeta hover:bg-transparent",onClick:()=>r(o),children:"Reservar"})]},o._id)})}),K=()=>{const[t,r]=d.useState(!1),[n,o]=d.useState(""),{nextSlide:i,prevSlide:x,promos:a,currentIndex:m}=Y(),s=d.useRef(null),p=l=>{s.current=l.touches[0].clientX},f=()=>{s.current},g=l=>{if(s.current===null)return;const u=l.touches[0].clientX,j=s.current-u;j>50?i():j<-50&&x()},b=l=>{const u=`${l.servicio.nombre} - ${l.descripcion}`;o(u),r(!0)};return a instanceof Array?a.length>0&&e.jsxs(e.Fragment,{children:[t&&e.jsx(O,{observaciones:n,cerrarFormulario:()=>r(!1)}),e.jsxs("section",{className:"relative flex justify-center max-w-4xl m-auto mb-8",onTouchStart:p,onTouchMove:g,onTouchEnd:f,children:[a.length>1&&e.jsx("span",{className:"rounded-md cursor-pointer text-4xl absolute z-10 left-0 top-1/2 flex justify-center items-center rotate-90 transition-transform px-4 bg-[#00000025] hover:bg-[#0000003f] hover:scale-95",onClick:x,children:e.jsx(T,{})}),e.jsx(J,{currentIndex:m,handleReservar:b,promos:a}),a.length>1&&e.jsx("span",{className:"rounded-md cursor-pointer text-4xl absolute z-10 right-0 top-1/2 flex justify-center items-center -rotate-90 transition-transform px-4 bg-[#00000025] hover:bg-[#0000003f] hover:scale-95",onClick:i,children:e.jsx(T,{})}),e.jsx("div",{className:" overflow-hidden absolute rounded-xl px-4 py-2 bg-[#00000025] -bottom-10 flex justify-center gap-x-4 m-auto",children:Array.from(a).map((l,u)=>e.jsx("span",{className:`${u===m?"bg-color-violeta translate-y-0":"translate-y-8"} rounded-full w-4 h-4 transition duration-500`},u))})]})]}):null},Q=K;function de(){const{setMensaje:t}=y(),{setLoading:r}=R(),{accessToken:n}=I(),[o,i]=d.useState([]),[x,a]=d.useState(null),[m,s]=d.useState(!1),[p,f]=d.useState(!1),[g,b]=d.useState(""),l=d.useRef();d.useEffect(()=>{try{r(!0),(async()=>{const c=z.publicas.getServicios,v={headers:{authorization:`Bearer ${n}`}},N=await E(c,v),{error:C,datos:A,status:_}=N;_===200?(i(A),r(!1)):(r(!1),t(C||"Error al obtener los servicios"))})()}catch{r(!1),t("Error al obtener los servicios")}},[t,n,r]);const u=h=>{a(h),f(!0),l.current.scrollIntoView()},j=(h,c)=>{l.current.scrollIntoView(),b(c),a(h),s(!0)};return e.jsxs("main",{className:"animate-fadeIn grid py-8 px-4 gap-8 ",ref:l,children:[!p&&e.jsx("h1",{className:"font-betonga text-color-violeta font-bold text-3xl text-center",children:"Servicios"}),!p&&!m&&e.jsx(Q,{}),p&&e.jsx(O,{servicio:x,cerrarFormulario:()=>f(!1)}),e.jsxs("section",{className:`grid gap-8 grid-cols-1 ${m?"md:grid-cols-1 lg:grid-cols-1 justify-center":"md:grid-cols-2 lg:grid-cols-3"}  max-w-5xl mx-auto`,children:[m&&!p&&e.jsx(H,{setOpenInfo:s,imgSrc:g,servicio:x,reservar:u}),o instanceof Array&&!p&&!m&&o.map(h=>h.nombre!=="admin"&&e.jsx(q,{servicio:h,abrirMasInfo:j,reservar:u,setServicio:a},h._id))]})]})}export{de as default};
