import{j as e,e as j,i as _,h as y,R as b,r as l,k as R,B as x,n as m,f as E,a as v,E as f,l as w,U as $,T as F,u as I}from"./index-rKMOL2j9.js";import{C as O}from"./LoaderChico-f-07DJwF.js";import{f as C}from"./formatHoraUser-TJ92Iw1g.js";const V=({reserva:a})=>{var s,t,o;return e.jsxs("ul",{className:"grid [&>li]:p-4 [&>li]:grid [&>li]:grid-flow-col [&>li]:grid-cols-[1fr_2fr] [&>li]:justify-between [&>li>span]:text-end",children:[e.jsxs("li",{children:["Fecha:",e.jsx("span",{children:j(a.horario.horaInicio)})]}),e.jsxs("li",{children:["Hora: ",e.jsx("span",{children:C(new Date(a.horario.horaInicio))})]}),a.paciente.nombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"capitalize",children:["Servicio: ",e.jsx("span",{children:((s=a.servicio)==null?void 0:s.nombre)||"-"})]}),e.jsxs("li",{children:["Tratamiento:",e.jsx("span",{children:((t=a.tratamiento)==null?void 0:t.descripcion)||"-"})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("span",{children:a.observaciones||"-"})]}),e.jsxs("li",{children:["Valor:",e.jsxs("span",{children:["$ ",(o=a.tratamiento)==null?void 0:o.costoPorSesion]})]})]})]})},k=({reserva:a})=>a.paciente.nombre==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"p-4 border-t",children:"Compromisos:"}),e.jsx("ul",{className:"px-6 pb-4 gap-4 grid list-decimal list-inside",children:a.observaciones.split(",").map(s=>e.jsx("li",{className:"",children:e.jsx("span",{children:s})},s))})]}),D=({reserva:a,handleEditarEstadoReserva:s,handleEliminarReserva:t,loading:o,contenedorRef:n})=>{const r=_(),d=y().pathname===b.admin.calendario,{dispatch:i}=l.useContext(R),c=()=>{i({type:m.SET_RESERVA,payload:a}),r(b.admin.editarReserva)},p=()=>{n.current.classList.replace("animate-growIn","animate-growOut"),setTimeout(()=>{i({type:m.SET_RESERVAS_SELECCIONADAS,payload:[]})},500)};return e.jsxs(e.Fragment,{children:[e.jsx(x,{texto:"Editar",tipo:"button",className:"border border-color-violeta bg-color-violeta  flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity ",onClickFunction:c}),e.jsx(x,{disabled:o,texto:"Estado",tipo:"button",className:`border border-color-violeta bg-color-violeta flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity  ${a.estado}`,onClickFunction:s}),d&&e.jsx(x,{texto:"Cerrar",className:"border border-color-violeta bg-color-violeta  flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity",onClickFunction:p,tipo:"button"}),e.jsx(x,{texto:"Eliminar",tipo:"button",className:"border border-color-violeta flex items-center justify-center max-w-fit justify-self-center rounded-lg px-4 py-2  hover:opacity-70 transition-opacity bg-red-600 text-white",onClickFunction:t})]})},z=async(a,s)=>{const t=`${v.reservas.deleteReserva}${s}`,o={method:"DELETE",headers:{Authorization:`Bearer ${a||""}`}};return await E(t,o)},g=[f.pendiente,f.pago,f.cancelada];function L(a){const s=g.indexOf(a);if(s!==-1){const t=(s+1)%g.length;return g[t]}else return}const U=async(a,s)=>{const t=L(s.estado),o=`${v.reservas.putEstadoReserva}${s._id}`,n={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},body:JSON.stringify({estado:t})};return await E(o,n)},B=()=>{const{setLoading:a}=l.useContext(w),{accessToken:s}=l.useContext($),{setMensaje:t}=l.useContext(F),{dispatch:o}=l.useContext(R);return{borrarReserva:async u=>{try{a(!0);const d=await z(s,u._id),{status:i,error:c,mensaje:p}=d;i===200?(t(p),o({type:m.DELETE_RESERVA,payload:u})):t(c||"Ocurrió un error al eliminar el paciente")}catch{t("Ocurrió un error al eliminar el paciente")}finally{a(!1)}},cambiarEstadoReserva:async u=>{try{a(!0);const d=await U(s,u),{status:i,datos:c,error:p,mensaje:h}=d;if(i===200)return t(h),o({type:m.SET_RESERVA_NUEVA,payload:c}),a(!1),c;t(p||"Error al actualizar el estado de la reserva")}catch{t("Error al actualizar el estado de la reserva")}finally{a(!1)}}}},P=({datos:a,contenedorRef:s})=>{const{loading:t}=l.useContext(w),{borrarReserva:o,cambiarEstadoReserva:n}=B(),[r,u]=l.useState(a),[d,i]=l.useState(!1),c=l.useRef(),{isVisible:p}=I(c),h=async()=>{await o(r),i(!1)},S=()=>{i(!0)},N=async()=>{const T=await n(r);u(T)},A={Pago:"bg-color-paga text-white",Cancelada:"bg-color-cancelada text-white",Pendiente:"bg-color-pendiente text-white"}[r.estado]||"";return e.jsxs(e.Fragment,{children:[d&&e.jsx(O,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${r.paciente.nombre} el dia ${j(r.horario.horaInicio)} a las ${C(new Date(r.horario.horaInicio))}?`,onConfirm:h,onCancel:()=>i(!1)}),e.jsxs("article",{className:`${p?"animate-toastIn":""} border border-slate-500 grid grid-rows-[40px_1fr_130px] rounded-lg max-w-96 w-full m-auto overflow-auto snap-center min-w-80 ${A}`,ref:c,children:[e.jsx("h3",{className:"font-betonga font-bold text-xl capitalize grid place-content-center tracking-wider",children:r.paciente.nombre}),e.jsxs("section",{className:"grid border-t border-b border-slate-50",children:[e.jsx(V,{reserva:r}),e.jsx(k,{reserva:r})]}),e.jsx("section",{className:"grid gap-4 p-4 grid-cols-2 justify-evenly bg-white",children:e.jsx(D,{contenedorRef:s,reserva:r,handleEditarEstadoReserva:N,handleEliminarReserva:S,loading:t})})]})]})},G=({reservas:a})=>{const s=y(),t=l.useRef(),o=s.pathname===b.admin.calendario;return e.jsx("section",{className:`${o?"animate-growIn fixed inset-0 z-30 m-0 p-4 bg-white bg-opacity-30 backdrop-blur-sm flex gap-4 justify-start overflow-x-auto snap-x snap-proximity scroll-smooth":"grid gap-4 m-auto w-full max-w-5xl md:grid-cols-2 xl:grid-cols-3"} `,ref:t,children:a.length>0?a.map(n=>e.jsx(P,{datos:n,contenedorRef:t},n._id)):e.jsx("h2",{className:"text-xl text-center col-span-full",children:"No hay reservas"})})};export{G as C};
