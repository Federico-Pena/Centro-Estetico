import{r as s,U as L,M as O,j as e,a as w}from"./index-ef9425d3.js";import{b as A,H as $,d as I,g as D,f as C,e as k,a as E,L as B}from"./FormularioReserva-cb0d2d0f.js";import{u as G,C as U}from"./ContadorReservas-a3825f53.js";import{F as J,T as M,c as q,N as K,C as y,o as F}from"./Notificacion-6a16bced.js";import"./BotonPrimario-55bf5f35.js";const Q=async(p,m)=>{const v=`${A.reservas.dias}${m}`,r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${p||""}`}};try{const u=await fetch(v,r);if(u.ok){const{fechas:l,cantidad:n,totalReservasMes:c}=await u.json();return{fechas:l,cantidad:n,totalReservasMes:c}}}catch(u){return u}},z=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],V=({setDiaPadre:p,reservas:m,actualizarReservas:v})=>{const[r,u]=s.useState($.split("T")[0]),[l,n]=s.useState($.split("-")[1]),[c,b]=s.useState(""),[x,j]=s.useState([]),[d,N]=s.useState([]),[S,i]=s.useState(0),[t,h]=s.useState(0),[R,f]=s.useState(!1),[W,g]=s.useState(!1),{accessToken:H}=s.useContext(L),{setMensaje:_}=s.useContext(O);s.useEffect(()=>{l&&(async()=>{g(!0);const o=await Q(H,l);if(i(o.cantidad),h(o.totalReservasMes),o.cantidad>0)N(o.fechas);else{g(!1);return}g(!1)})()},[H,l]),s.useEffect(()=>{g(!0);const o=I(r,m).find(Y=>Y.dia.getDay()===new Date(`${r} ${c}`).getDay());j(o.horaID),g(!1)},[r,m,c]);const P=a=>{b(a.target.textContent),q(a,r,m)?f(!0):_("Hora no disponible para hacer una reserva")};function T(a){return a>=1&&a<=12?z[a-1]:"Mes no vÃ¡lido"}return e.jsxs("section",{className:"containerFechasYHoras",children:[R&&e.jsx(e.Fragment,{children:e.jsx(J,{reserva:{fecha:r,hora:c,pacienteNombre:c==="08:00"||c==="08:30"?"admin":null},fecha:r,hora:c,setForm:()=>f(!1),actualizarReserva:v})}),e.jsxs("div",{className:"select-container-container",children:[e.jsxs("div",{className:"select-container",children:[e.jsxs("h3",{children:["Fechas en ",`${T(l)}`," ",e.jsx(M,{from:0,to:S,duration:500})]}),e.jsx("select",{value:l,onChange:a=>n(a.target.value),children:z.map((a,o)=>e.jsx("option",{value:o+1,children:a},a))}),e.jsxs("h3",{children:["Reservas en ",`${T(l)}`," ",e.jsx(M,{from:0,to:t,duration:500})]})]}),e.jsxs("select",{className:"selectedFecha",name:"selectedFecha",onChange:a=>{const o=a.target.value.split("T")[0];p(o),u(o)},children:[e.jsxs("option",{value:D(E),children:["Hoy ",C({fecha:D(E)})]}),(d==null?void 0:d.length)>0&&(d==null?void 0:d.map(a=>e.jsx("option",{className:"selectedComponent-option",value:a.fecha,children:C(a)},a.fecha)))]}),x.length>0&&e.jsx(k,{horas:x,onClickReservar:P})]})]})};function te(){const[p,m]=s.useState($.split("T")[0]),[v,r]=s.useState([]),{loading:u}=s.useContext(L),{loading:l,delDia:n,setDelDia:c,loadingSemana:b}=G(!1,p),{setMensaje:x}=s.useContext(O),j=i=>{const{reserva:t}=i,h=`Reserva nueva de ${t.pacienteNombre} el dia ${C({fecha:t.fecha})} a las ${t.hora}`;x(h);const R=n.filter(f=>f._id!==t._id);c(R.concat(t).sort(F))},d=i=>{const{reserva:t}=i,h=`Reserva borrada de ${t.pacienteNombre} el dia ${C({fecha:t.fecha})} a las ${t.hora}`;x(h);const R=n.filter(f=>f._id!==t._id);c(R.sort(F))},N=i=>{if(i==="Toda")r(n.sort(F));else{const t=n.filter(h=>h.estado===i);r(t.sort(F))}},S=i=>{i.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{i.current.parentElement.classList.remove("animationReservaOut"),r([])},500)};return e.jsxs(e.Fragment,{children:[e.jsx(K,{}),(u||l)&&e.jsx(w,{}),e.jsx("main",{className:"divPageReservas",children:v.length>0?e.jsx(y,{reservas:v,actualizarReservas:j,actualizarReservaEliminada:d,cerrarReserva:S}):e.jsxs(e.Fragment,{children:[e.jsx(U,{reservas:n,mostrarReservadas:N}),e.jsx(V,{actualizarReservas:j,reservas:n,setDiaPadre:m}),b?e.jsx(B,{}):null,e.jsx(y,{reservas:n,actualizarReservas:j,actualizarReservaEliminada:d,className:"ContenedorReservas"})]})})]})}export{te as default};
