import{r as t,M as K,U as _,j as e,B as D}from"./index-f53c4d7f.js";import{E as A,h as Y,b as P,f as O,H as W,d as Z,e as ee,L as ae,a as se}from"./FormularioReserva-bbe3d4b9.js";import{B as te}from"./BotonPrimario-30c31828.js";const ne=(a,n,o)=>{if(a.target.className.includes(A.pendiente)||a.target.className.includes(A.pago))return!1;const c=a.target.textContent,s=n+" "+c,l=new Date(s);l.setMinutes(l.getMinutes()+30);const r=Y(l);return!o.filter(h=>h.fecha===new Date(n).toISOString()&&(h.hora.includes(r)||h.horaFin.includes(r))).find(h=>h.estado===A.pago||h.estado===A.pendiente)};function q(a,n){if(a&&n){const o=a.fecha.split("T")[0],c=n.fecha.split("T")[0],s=new Date(`${o}T${a.hora}`),l=new Date(`${c}T${n.hora}`);return s>l?-1:s<l?1:0}}const oe=a=>{const[n,o]=t.useState([]),[c,s]=t.useState(null),[l,r]=t.useState(!1),[f,i]=t.useState([]),[h,N]=t.useState(1),[w,j]=t.useState(null),[T,g]=t.useState(1),{setMensaje:S}=t.useContext(K),{accessToken:E}=t.useContext(_);t.useEffect(()=>{h&&(async()=>{r(!0);const d={headers:{"Content-Type":"application/json",Authorization:`Bearer ${E||""}`}},b=`${P.paciente.nombres}/${h}`,v=await fetch(b,d),{pacientes:C,page:B,totalPages:z,totalPacientes:I}=await v.json();j(I),g(z),N(B),C.length?i(C.sort((V,p)=>V.nombre.toLowerCase()<p.nombre.toLowerCase()?-1:1)):i([]),r(!1)})()},[E,h]),t.useEffect(()=>{const m={headers:{"Content-Type":"application/json",Authorization:`Bearer ${E||""}`}};a&&(async()=>{r(!0);const b=`${P.reservas.deUnPaciente}${a}`;try{const v=await fetch(b,m);if(v.ok){const C=await v.json();o(C.sort(q))}}catch(v){console.log(v)}r(!1)})()},[E,a]);const M={headers:{"Content-Type":"application/json",Authorization:`Bearer ${E||""}`}};return{setPaciente:s,agregarPaciente:m=>{if(m.error){S(m.mensaje);return}m.totalReservas=0,i([...f,m].sort((b,v)=>b.nombre.toLowerCase()<v.nombre.toLowerCase()?-1:1));const d=`Paciente nuevo ${m.nombre}.`;S(d)},getPaciente:async m=>{if(s(null),r(!0),m){const d=f.find(B=>B.nombre===m),b=`${P.paciente.porId}${d._id}`,C=await(await fetch(b,M)).json();s(C)}else s(null);r(!1)},eliminarPaciente:m=>{const{mensaje:d}=m;S(d)},actualizarReservaPaciente:m=>{const{reserva:d}=m,b=`Reserva nueva de ${d.pacienteNombre}. El dia ${O({fecha:d.fecha.split("T")[0]})} a las ${d.hora}`,v=n.filter(C=>C._id!==d._id);S(b),o(v.concat(d).sort(q))},eliminarReservaPaciente:m=>{const{reserva:d}=m,b=n.filter(C=>C._id!==d._id),v=`Reserva eliminada de ${d.pacienteNombre}. El dia ${O({fecha:d.fecha.split("T")[0]})} a las ${d.hora}`;S(v),o(b.sort(q))},reservasPaciente:n,nombres:f,paciente:c,loading:l,setNombres:i,editarPaciente:m=>{s(null);const d=`Paciente nuevo ${m.nombre}.`;S(d),s(m)},setReservasPaciente:o,pagina:h,setPagina:N,totalPaginas:T,totalPacientes:w}},L=async(a,n,o)=>{try{const s=await(await fetch(a,n)).json();return o(s),s}catch(c){return o(c),c}};const G=({from:a,to:n,duration:o=1e3})=>{const[c,s]=t.useState(a),l=t.useRef(n);return t.useEffect(()=>{let r,f;const i=l.current,h=N=>{r||(r=N);const w=N-r,j=Math.min(1,w/o),T=Math.floor(i+(n-i)*j);s(T),j<1&&(f=requestAnimationFrame(h))};return n!==i&&(l.current=n,r=null,f=requestAnimationFrame(h)),()=>cancelAnimationFrame(f)},[a,n,o]),e.jsx("span",{children:c})},re=({nombres:a,onChangeNombre:n,pagina:o,totalPaginas:c,setPagina:s,totalPacientes:l})=>e.jsxs("div",{className:"selectNombre-container",children:[e.jsxs("div",{className:"encabezado",children:[e.jsxs("strong",{children:["Pacientes:"," ",e.jsx(G,{from:0,to:l,duration:2e3})]}),e.jsxs("strong",{children:["Páginas:"," ",e.jsx(G,{from:0,to:c,duration:1e3})]}),e.jsxs("strong",{children:["Página actual:"," ",e.jsx(G,{from:1,to:o,duration:200})]})]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsx(D,{tipo:"button",className:"pagination-buttons-Anterior",texto:"Anterior",onClickFunction:()=>o>1&&s(o-1)}),e.jsx(D,{tipo:"button",className:"pagination-buttons-Siguiente",onClickFunction:()=>o!==c&&s(o+1),texto:"Siguiente"})]}),a.length>0&&a.map((r,f)=>e.jsxs("div",{className:r.nombre==="admin"||r.pacienteNombre==="admin"?"selectNombre-option admin":"selectNombre-option",onClick:()=>n(r.nombre||r.pacienteNombre),children:[e.jsx("img",{src:r.foto.secure_url,alt:r.nombre||r.pacienteNombre,className:"imagen"}),e.jsx("span",{className:"nombre",children:r.nombre||r.pacienteNombre}),e.jsxs("span",{className:"numero",children:["Numero de reservas: ",r.totalReservas]})]},f))]}),ie=re,ce=({reserva:a,setForm:n,editar:o,actualizarReserva:c})=>{const[s,l]=t.useState(a.fecha||W.split("T")[0]),[r,f]=t.useState([]),[i,h]=t.useState(a.motivo),[N,w]=t.useState(a.observaciones),[j,T]=t.useState(a.hora||""),[g,S]=t.useState(a.pacienteNombre),[E,M]=t.useState(!1),[x,H]=t.useState([]),F=t.useRef(),{setMensaje:y}=t.useContext(K),{accessToken:k}=t.useContext(_),{nombres:Q,pagina:m,setPagina:d,totalPacientes:b,totalPaginas:v}=oe(),C=()=>{F.current.parentElement.classList.add("animationOut"),setTimeout(()=>{n()},300)};t.useEffect(()=>{F.current.scrollIntoView({behavior:"smooth",block:"start"}),k&&s&&(async()=>{const u=await fetch(`${P.reservas.deUnDia}${s}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${k||""}`}}),{data:$}=await u.json();f($)})()},[s,k,a]),t.useEffect(()=>{const u=Z(s,r).find($=>$.dia.getDay()===new Date(`${s} ${j}`).getDay());H(u==null?void 0:u.horaID)},[s,r,j]);const B=p=>{T(p.target.textContent),ne(p,s,r)||(y("Hora no disponible para hacer una reserva"),T(""))},z=async p=>{p.preventDefault(),M(!0);const u=F.current,$=new Date(`${u.fecha.value.split("T")[0]} ${j}`);$.setMinutes($.getMinutes()+30);const R={pacienteNombre:u.pacienteNombre.value,fecha:u.fecha.value,hora:j,horaFin:Y($),motivo:u.motivo?u.motivo.value:void 0,observaciones:u.observaciones.value};if(R.pacienteNombre.trim()&&R.hora&&R.fecha){const U={method:"POST",body:JSON.stringify(R),headers:{"Content-Type":"application/json",authorization:`Bearer ${k}`}};await L(`${P.reservas.agregar}`,U,c),u.classList.add("formOut"),n()}else y("Faltan campos");M(!1)},I=async p=>{p.preventDefault(),M(!0);const u=F.current,$=new Date(`${u.fecha.value.split("T")[0]} ${j}`);$.setMinutes($.getMinutes()+30);const R={_id:a._id,pacienteNombre:u.pacienteNombre.value,fecha:u.fecha.value,hora:j,horaFin:Y($),motivo:u.motivo?u.motivo.value:void 0,observaciones:u.observaciones.value};if(R.pacienteNombre.trim()&&R.hora&&R.fecha){const U=`${P.reservas.editar}${R._id}`,X={method:"PUT",body:JSON.stringify(R),headers:{"Content-Type":"application/json",authorization:`Bearer ${k}`}};await L(U,X,c),n()}else y("Faltan campos");M(!1)},V=p=>{S(p)};return e.jsxs("section",{className:"formReservaContainer",children:[e.jsx(D,{className:"cerrarForm",texto:"Cerrar Formulario",onClickFunction:C,tipo:"button"}),e.jsxs("form",{onSubmit:o?I:z,className:"formReserva",ref:F,children:[e.jsx("h3",{children:"Reserva"}),!g=="admin"||!a.pacienteNombre&&e.jsx(ie,{totalPacientes:b,totalPaginas:v,nombres:Q,pagina:m,setPagina:d,onChangeNombre:V}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"pacienteNombre",children:"Nombre"}),e.jsx("input",{id:"pacienteNombre",type:"text",name:"pacienteNombre",defaultValue:g,disabled:!!g,required:!0})]}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"fecha",children:"Fecha"}),e.jsx("input",{id:"fecha",type:"date",name:"fecha",required:!0,disabled:!(g==="admin"||a.pacienteNombre),defaultValue:a.fecha||W.split("T")[0],onChange:p=>{const u=p.target.value.split("T")[0];l(u)}})]}),(x==null?void 0:x.length)>0&&e.jsx("div",{className:"input",children:e.jsx(ee,{horas:x,onClickReservar:B})}),e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"observaciones",children:g==="admin"?"Tareas. Separadas por comas":"Observaciones"}),e.jsx("input",{defaultValue:a.observaciones,id:"observaciones",type:"text",name:"observaciones",onChange:p=>w(p.target.value)})]}),g==="admin"?null:e.jsxs("div",{className:"input",children:[e.jsx("label",{htmlFor:"motivo",children:"Motivo"}),e.jsxs("select",{name:"motivo",onChange:p=>h(p.target.value),children:[e.jsx("option",{defaultValue:a.motivo,children:a.motivo?a.motivo:""}),e.jsx("option",{value:"Drenaje Linfático",children:"Drenaje Linfático"}),e.jsx("option",{value:"Masaje Estético",children:"Masaje Estético"}),e.jsx("option",{value:"Exfoliación Corporal",children:"Exfoliación Corporal"}),e.jsx("option",{value:"Masaje Cérvico-Craneal",children:"Masaje Cérvico-Craneal"}),e.jsx("option",{value:"Masaje Con Piedras Calientes",children:"Masaje Con Piedras Calientes"}),e.jsx("option",{value:"Masaje Descontracturante",children:"Masaje Descontracturante"}),e.jsx("option",{value:"Masaje Relajante",children:"Masaje Relajante"}),e.jsx("option",{value:"Masaje Prenatal",children:"Masaje Prenatal"}),e.jsx("option",{value:"Barras De access",children:"Barras De Access"})]})]}),e.jsxs("div",{className:"input",children:[g&&e.jsxs("span",{className:"spanHora",children:["Nombre ",e.jsx("strong",{children:g})]}),s&&e.jsxs("span",{className:"spanHora",children:["Dia ",e.jsx("strong",{children:O({fecha:s})})]}),j&&e.jsxs("span",{className:"spanHora",children:["Hora ",e.jsx("strong",{children:j})]}),N&&e.jsxs("span",{className:"spanHora",children:["Observaciones",e.jsx("strong",{children:N})]}),i&&e.jsxs("span",{className:"spanHora",children:["Motivo ",e.jsx("strong",{children:i})]})]}),e.jsx(te,{tipo:"submit",className:"submitAdmin",texto:E?e.jsx(ae,{}):"Guardar"})]})]})};const le=({titulo:a,mensaje:n,onConfirm:o,onCancel:c})=>{const s=t.useRef();return t.useEffect(()=>{s.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",ref:s,children:[e.jsx("h3",{children:a}),e.jsx("p",{children:n}),e.jsxs("div",{children:[e.jsx("button",{onClick:o,children:"Confirmar"}),e.jsx("button",{onClick:c,children:"Cancelar"})]})]})})},J=[A.pendiente,A.cancelada,A.pago];function de(a){const n=J.indexOf(a);if(n!==-1){const o=(n+1)%J.length;return J[o]}else return}const ue=({actualizarReservaEliminada:a,actualizarReserva:n,reserva:o,cerrarReserva:c})=>{const[s,l]=t.useState(!1),[r,f]=t.useState(!1),[i,h]=t.useState(o),N=t.useRef(),{accessToken:w}=t.useContext(_),{setMensaje:j}=t.useContext(K),T=async()=>{const x=`${P.reservas.eliminar}${i._id}`,H={method:"DELETE",headers:{authorization:`Bearer ${w}`}};await L(x,H,a),l(!1)},g=()=>{l(!1)},S=async()=>{const x=de(i.estado),H=`${P.reservas.editarEstado}${i._id}`,F={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${w}`},body:JSON.stringify({estado:x})};await L(H,F,y=>{n(y),h(y.reserva),j(y.mensaje)})},E=()=>{c(N)},M=()=>{f(!0)};return r?e.jsx(ce,{editar:!0,reserva:{...i,fecha:i.fecha.split("T")[0],nombre:i.pacienteNombre},actualizarReserva:x=>{h(x.reserva),n(x)},setForm:()=>{f(!1)}}):s?e.jsx("article",{className:"containerReserva",ref:N,children:e.jsx(le,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${i.pacienteNombre} el dia ${O(i)} a las ${i.hora}?`,onConfirm:T,onCancel:g})}):e.jsxs("article",{className:"containerReserva",ref:N,children:[e.jsx("div",{className:`reserva-container-titulo  ${i.estado}`,children:e.jsx("h3",{children:"Detalles de la reserva"})}),e.jsxs("div",{className:`reserva-container-cuerpo  ${i.estado}`,children:[e.jsxs("ul",{children:[e.jsxs("li",{children:["Paciente: ",e.jsx("strong",{children:i.pacienteNombre})]}),e.jsxs("li",{children:["Fecha:",e.jsx("strong",{children:O(i)})]}),e.jsxs("li",{children:["Hora: ",e.jsx("strong",{children:i.hora})]}),i.pacienteNombre!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["Motivo: ",e.jsx("strong",{children:i.motivo})]}),e.jsxs("li",{children:["Observaciones: ",e.jsx("strong",{children:i.observaciones})]}),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:i.estado})]})]})]}),i.pacienteNombre==="admin"&&e.jsxs("ul",{className:"tareasAdmin",children:[e.jsx("li",{children:"Lista:"}),i.observaciones.split(",").map(x=>e.jsx("li",{className:"liTarea",children:e.jsx("span",{children:x})},x)),e.jsxs("li",{children:["Estado:",e.jsx("strong",{className:"strongEstado",children:i.estado})]})]})]}),e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(D,{texto:"Editar",className:"btnEditar",onClickFunction:M}),e.jsx(D,{texto:"Cambiar Estado",className:`btnCompletada ${i.estado}`,onClickFunction:S})]}),c?e.jsxs("div",{className:"reserva-container-botones",children:[e.jsx(D,{texto:"Cerrar",className:"btnCerrarReserva",onClickFunction:E,tipo:"button"}),e.jsx(D,{texto:"Eliminar",className:"btnCerrar Cancelada",onClickFunction:()=>l(!0)})]}):e.jsx("div",{className:"reserva-container-botones",children:e.jsx(D,{texto:"Eliminar",className:"btnCerrar",onClickFunction:()=>l(!0)})})]})};const je=({reservas:a,actualizarReservas:n,actualizarReservaEliminada:o,cerrarReserva:c})=>e.jsx("section",{className:"ContenedorReservas",children:(a==null?void 0:a.length)>0&&a.map(s=>e.jsx(ue,{cerrarReserva:c,actualizarReservaEliminada:o,actualizarReserva:n,reserva:s},s._id))}),me=()=>{const[a,n]=t.useState([]),{accessToken:o}=t.useContext(_);return t.useEffect(()=>{o&&(async()=>{let s=se.toISOString().split("T")[0];const l={headers:{"Content-Type":"application/json",Authorization:`Bearer ${o||""}`}};try{const r=`${P.publicas.fechasHorasReservadasDeLaSemana}${s}`;await L(r,l,f=>{n(f.reservas)})}catch(r){console.log(r)}})()},[o]),{reservasSemanales:a}},xe=()=>{const{isAllowedAccess:a}=t.useContext(_),{reservasSemanales:n}=me();return t.useEffect(()=>{"Notification"in window&&a&&n.forEach(o=>{const c=new Date(`${o.fecha.split("T")[0]} ${o.hora}`),l=(c-new Date)/(24*60*60*1e3),r={body:"Mensaje de Prueba",icon:"/assets/icons/icon-192.png",vibrate:[200,100,200],tag:"notificacion"};l===1&&setTimeout(()=>{new Notification("Recordatorio",r).addEventListener("click",()=>{window.location.href="https://www.masajistanataliapena.com/#/calendario"})},c-new Date)})},[a]),null};export{je as C,ce as F,xe as N,ie as S,G as T,le as a,ne as c,L as f,q as o,oe as u};
