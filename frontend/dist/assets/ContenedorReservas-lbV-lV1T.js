import{j as e,d as f,a as I,o as v,R as b,g as u,p as j,m as y,u as O,r as x}from"./index-eyZDGxlY.js";import{f as N}from"./formatFechaParaUser-QfX3A7Bl.js";import{C as k}from"./LoaderChico-GUMo0G8g.js";import{u as z}from"./useObserver-6YU-PPv7.js";import{f as C}from"./formatHoraUser-TJ92Iw1g.js";import{B as p}from"./Button-gaWcEQck.js";import{u as S}from"./useReservasContext-7CxyEjNX.js";import{f as $,a as A,u as D}from"./useUserContext-o9xrNTqb.js";const V=({reserva:a})=>{var t,s,r,n;return e.jsxs("ul",{className:"grid text-white",children:[e.jsxs("li",{className:"capitalize grid grid-flow-col justify-between p-4 border-b",children:["Fecha:",e.jsx("span",{children:N(a.horario.horaInicio)})]}),e.jsxs("li",{className:"p-4 border-b grid grid-flow-col justify-between",children:["Hora: ",e.jsx("span",{children:C(new Date(a.horario.horaInicio))})]}),((t=a.paciente)==null?void 0:t.nombre)!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"p-4 border-b capitalize grid gap-2",children:["Servicio:",e.jsx("span",{className:"grid justify-end",children:((s=a.servicio)==null?void 0:s.nombre)||e.jsx(f,{})})]}),e.jsxs("li",{className:"p-4 border-b grid gap-2",children:["Tratamiento:",e.jsx("span",{className:"grid justify-end",children:((r=a.tratamiento)==null?void 0:r.descripcion)||e.jsx(f,{})})]}),e.jsxs("li",{className:"p-4 border-b grid gap-2",children:["Observaciones:",e.jsx("span",{className:"grid justify-end",children:a.observaciones||e.jsx(f,{})})]}),e.jsxs("li",{className:"p-4 pb-8 grid grid-flow-col justify-between",children:["Valor:",e.jsxs("span",{children:["$ ",(n=a.tratamiento)==null?void 0:n.costoPorSesion]})]})]})]})},L=({reserva:a})=>{var t;return((t=a.paciente)==null?void 0:t.nombre)==="admin"&&e.jsx(e.Fragment,{children:e.jsxs("ul",{className:"pb-4 gap-4 items-start grid text-white",children:[e.jsx("li",{className:"list-none text-center border-t pt-4",children:"Compromisos"}),a.observaciones.split(",").map(s=>e.jsx("li",{className:"pl-6",children:s},s))]})})},B=({reserva:a,handleEditarEstadoReserva:t,handleEliminarReserva:s,loading:r,contenedorRef:n})=>{const o=I(),c=v().pathname===b.admin.calendario,{dispatch:l}=S(),i=()=>{o(b.admin.editarReserva,{state:{reserva:a}})},d=()=>{n.current.classList.replace("animate-fadeIn","animate-growOut"),setTimeout(()=>{l({type:j.SET_RESERVAS_SELECCIONADAS,payload:[]})},500)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-full",texto:"Editar",tipo:"button",onClickFunction:i}),e.jsx(p,{disabled:r,texto:"Estado",tipo:"button",className:`${a.estado} w-full text-white`,onClickFunction:t}),c&&e.jsx(p,{className:"w-full",texto:"Cerrar",onClickFunction:d,tipo:"button"}),e.jsx(p,{className:`w-full ${u.cancelada} text-white`,texto:"Eliminar",tipo:"button",onClickFunction:s})]})},U=async(a,t)=>{const s=`${A.reservas.deleteReserva}${t}`,r={method:"DELETE",headers:{Authorization:`Bearer ${a||""}`}};return await $(s,r)},g=[u.pendiente,u.pago,u.cancelada];function M(a){const t=g.indexOf(a);if(t!==-1){const s=(t+1)%g.length;return g[s]}else return}const P=async(a,t)=>{const s=M(t.estado),r=`${A.reservas.putEstadoReserva}${t._id}`,n={method:"PUT",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},body:JSON.stringify({estado:s})};return await $(r,n)},H=()=>{const{setLoading:a}=y(),{accessToken:t}=D(),{setMensaje:s}=O(),{dispatch:r}=S();return{borrarReserva:async m=>{try{a(!0);const c=await U(t,m._id),{status:l,error:i,mensaje:d}=c;l===200?(s(d),r({type:j.DELETE_RESERVA,payload:m})):s(i||"Ocurrió un error al eliminar el paciente")}catch{s("Ocurrió un error al eliminar el paciente")}finally{a(!1)}},cambiarEstadoReserva:async m=>{try{a(!0);const c=await P(t,m),{status:l,datos:i,error:d,mensaje:h}=c;if(l===200)return s(h),r({type:j.SET_RESERVA_NUEVA,payload:i}),a(!1),i;s(d||"Error al actualizar el estado de la reserva")}catch{s("Error al actualizar el estado de la reserva")}finally{a(!1)}}}},q=({datos:a,contenedorRef:t})=>{var R,E,w;const{loading:s}=y(),{borrarReserva:r,cambiarEstadoReserva:n}=H(),[o,m]=x.useState(a),[c,l]=x.useState(!1),i=x.useRef(),{isVisible:d}=z(i),h=async()=>{await r(o),l(!1)},T=()=>{l(!0)},_=async()=>{const F=await n(o);m(F)};return e.jsxs(e.Fragment,{children:[c&&e.jsx(k,{titulo:"Borrar Reserva",mensaje:`¿Estás seguro de que deseas borrar la reserva de ${(R=o.paciente)==null?void 0:R.nombre} el dia ${N((E=o.horario)==null?void 0:E.horaInicio)} a las ${C(new Date((w=o.horario)==null?void 0:w.horaInicio))}?`,onConfirm:h,onCancel:()=>l(!1)}),e.jsxs("article",{className:`${d?"animate-toastIn":""} border border-slate-500 grid grid-rows-[50px_1fr_auto] rounded-lg max-w-96 w-full mx-auto overflow-auto snap-center min-w-80 ${o.estado}`,ref:i,children:[o.paciente&&e.jsx("h3",{className:"font-betonga font-bold text-xl text-white capitalize grid place-content-center tracking-wider",children:o.paciente.nombre||"Paciente eliminado"}),e.jsxs("section",{className:"grid border-t border-b border-slate-50",children:[e.jsx(V,{reserva:o}),e.jsx(L,{reserva:o})]}),e.jsx("section",{className:"grid gap-4 p-4 grid-cols-2 justify-evenly bg-white",children:e.jsx(B,{contenedorRef:t,reserva:o,handleEditarEstadoReserva:_,handleEliminarReserva:T,loading:s})})]})]})},ee=({reservas:a})=>{const t=v(),s=x.useRef(),r=t.pathname===b.admin.calendario;return e.jsx("section",{className:`${r?"animate-fadeIn fixed inset-0 z-30 py-8 px-4 bg-white bg-opacity-30 backdrop-blur-sm grid items-center grid-flow-col gap-4 overflow-x-auto snap-x snap-proximity scroll-smooth":"grid gap-4 m-auto w-full max-w-5xl md:grid-cols-2 xl:grid-cols-3"} `,ref:s,children:a.length>0?a.map(n=>e.jsx(q,{datos:n,contenedorRef:s},n._id)):e.jsx("h2",{className:"text-xl text-center col-span-full",children:"No hay reservas"})})};export{ee as C};
