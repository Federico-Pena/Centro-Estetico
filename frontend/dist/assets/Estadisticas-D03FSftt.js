import{j as e,r as m,o as p,e as b,w as T,u as R,x as h,M as $}from"./index-BN4e8_cD.js";import{T as I}from"./TransitionNumber-7wfd2-tq.js";import{u as w}from"./useObserver-lcFBawrA.js";import{f as y,a as N,b as v,u as k}from"./useLoaderContext-CL4xz49p.js";import{u as S}from"./useForm-CXfPmMIm.js";import{B as f}from"./Button-D70TNmHc.js";import{L as C}from"./LabelInput-BKKsOyNx.js";import{D}from"./Dropdown-B46kqRJn.js";const L=({cantidadEstados:s})=>{const r=Object.values(s).reduce((t,n)=>t+n);return s&&e.jsxs("article",{className:"grid gap-4 py-8 px-4 border border-black rounded-lg md:col-span-2 md:text-xl",children:[e.jsx("h2",{className:"font-betonga font-bold text-color-violeta text-xl text-center md:text-2xl",children:"Estados de reservas"}),e.jsxs("ul",{className:"grid gap-4 grid-cols-2",children:[Object.entries(s).map(([t,n])=>e.jsxs("li",{className:`text-center grid justify-center text-white rounded-lg ${t}`,children:[t," ",e.jsx(I,{to:n})]},t)),e.jsxs("li",{className:"grid w-full text-center text-white rounded-lg bg-color-violeta",children:["Total ",e.jsx("span",{children:r})]})]})]})},_=({horario:s,index:r})=>{const t=m.useRef(),{isVisible:n}=w(t);return e.jsxs("ul",{className:`${n?"animate-fadeIn":""} grid gap-2 p-4 pb-2 border border-black rounded-lg bg-color-logo font-semibold`,ref:t,children:[e.jsx("li",{className:"bg-color-violeta text-white rounded-full m-auto w-8 h-8 grid place-content-center",children:r+1}),e.jsxs("li",{className:"grid py-4 grid-flow-col justify-between border-b border-black ",children:[e.jsx("span",{children:"Día"}),s.dia]}),e.jsxs("li",{className:"grid py-4 grid-flow-col justify-between border-b border-black ",children:[e.jsx("span",{children:"Hora"}),s.hora]}),e.jsxs("li",{className:"text-end grid py-4 grid-flow-col justify-between ",children:[e.jsx("span",{children:"Reservas"}),s.cantidad]})]},s.dia+s.hora)},V=({horarios:s})=>s instanceof Array&&e.jsxs("article",{className:"grid grid-rows-[auto_1fr] grid-cols-2 gap-4 pt-8 md:col-span-4 text-color-violeta tracking-wider",children:[e.jsx("h2",{className:"font-betonga font-bold text-color-violeta text-xl text-center col-span-full md:text-2xl",children:"Horarios Más Solicitados"}),s.map((r,t)=>e.jsx(_,{horario:r,index:t},t))]}),z=({gananciasTotales:s,perdidasTotales:r,pendientesTotales:t})=>s&&e.jsxs("article",{className:"grid grid-cols-2 border gap-2 border-black text-color-violeta py-8 rounded-lg md:text-xl md:col-span-2",children:[e.jsxs("ul",{className:"text-center grid  items-center col-span-full",children:[e.jsx("li",{className:"font-betonga font-bold text-xl md:text-2xl ",children:"Pagas"}),e.jsxs("li",{className:"font-bold Pago m-auto p-2 rounded-xl text-white",children:["$ ",s.toLocaleString(p)]})]}),e.jsxs("ul",{className:"text-center grid  items-center",children:[e.jsx("li",{className:"font-betonga font-bold text-xl md:text-2xl",children:"Pendientes"}),e.jsxs("li",{className:"font-bold Pendiente m-auto p-2 rounded-xl text-white",children:["$ ",t.toLocaleString(p)]})]}),e.jsxs("ul",{className:"text-center grid  items-center",children:[e.jsx("li",{className:"font-betonga font-bold text-xl md:text-2xl",children:"Canceladas"}),e.jsxs("li",{className:"font-bold Cancelada m-auto p-2 rounded-xl text-white",children:["$ ",r.toLocaleString(p)]})]})]}),O=({servicio:s,index:r})=>{var a;const t=m.useRef(),{isVisible:n}=w(t);return e.jsxs("ul",{className:`${n?"animate-fadeIn":""} relative grid gap-2 p-4 pb-2 border border-black rounded-lg text-lg bg-color-logo font-semibold`,ref:t,children:[n&&e.jsx("img",{src:(a=s.imagen)==null?void 0:a.secure_url,alt:s.servicio,className:"aspect-square w-full object-cover h-52 rounded-lg"}),e.jsx("li",{className:"bg-color-violeta text-white rounded-full m-auto w-8 h-8 grid place-content-center",children:r+1}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 border-b border-black",children:["Servicio",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:s.servicio})]}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 border-b border-black ",children:["Tratamiento",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:s.tratamiento})]}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 border-b border-black ",children:["Sesiones",e.jsx("span",{className:"text-end text-nowrap overflow-auto",children:s.sesiones})]}),e.jsxs("li",{className:"py-4 capitalize grid grid-flow-col gap-4 justify-between",children:["Cantidad",e.jsxs("span",{className:"text-end text-nowrap overflow-auto",children:[" ",s.cantidad]})]})]})},P=({servicios:s})=>s&&e.jsxs("article",{className:"grid grid-rows-[auto_1fr] md:grid-cols-2 gap-4 pt-8 md:col-span-4 text-color-violeta",children:[e.jsx("h2",{className:"font-betonga font-bold text-xl text-center col-span-full md:text-2xl",children:"Servicios y Tratamientos Más Solicitados"}),s instanceof Array&&s.map((r,t)=>e.jsx(O,{index:t,servicio:r},t))]}),F=({mes:s,cantidadReservas:r,estados:t,pacienteMasReservas:n,servicioMasSolicitado:a,ganancias:d})=>{const c=m.useRef(),{isVisible:o}=w(c);return e.jsxs("section",{className:`${o?"animate-fadeIn":""} grid gap-2 w-full border border-black bg-color-logo  rounded-lg pt-4 px-2 font-bold [&>ul>li>span>svg]:text-red-600`,ref:c,children:[e.jsx("h3",{className:"grid text-center text-xl uppercase",children:s}),e.jsxs("ul",{className:"border-b border-black grid gap-4 p-4 ",children:[e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Reservas: ",e.jsx("span",{children:r||0})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Ganancias: ",e.jsxs("span",{children:["$ ",d.toLocaleString(p)||0]})]})]}),e.jsxs("ul",{className:"border-b border-black grid gap-4 p-4 ",children:[e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Paciente con mas reservas:"," ",e.jsx("span",{className:"capitalize",children:(n==null?void 0:n.nombre)||e.jsx(b,{})})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Cantidad: ",e.jsx("span",{children:(n==null?void 0:n.cantidad)||0})]})]}),e.jsxs("ul",{className:"border-b border-black grid gap-4 p-4 ",children:[e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Servicio mas solicitado:",e.jsx("span",{className:"capitalize",children:(a==null?void 0:a.servicio)||e.jsx(b,{})})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Tratamiento mas solicitado:",e.jsxs("span",{children:[" ",(a==null?void 0:a.tratamiento)||e.jsx(b,{})]})]}),e.jsxs("li",{className:"grid grid-flow-col justify-between",children:["Cantidad:",e.jsxs("span",{children:[" ",(a==null?void 0:a.cantidad)||e.jsx(b,{})]})]})]}),e.jsxs("ul",{className:"grid gap-4 p-4 ",children:[e.jsx("li",{className:"text-center font-bold",children:"Reservas"}),e.jsxs("li",{className:"Cancelada grid grid-flow-col justify-between rounded-md px-4 text-white py-2",children:["Canceladas: ",e.jsx("span",{children:t.Cancelada})]}),e.jsxs("li",{className:"Pendiente grid grid-flow-col justify-between rounded-md px-4 text-white py-2",children:["Pendientes ",e.jsx("span",{children:t.Pendiente})]}),e.jsxs("li",{className:"Pago grid grid-flow-col justify-between rounded-md px-4 text-white py-2",children:["Pagas: ",e.jsx("span",{children:t.Pago})]})]})]})},B=({datos:s})=>{const[r,t]=m.useState(window.innerWidth),n=Math.max(...s.map(a=>a.ganancias));return m.useEffect(()=>{const a=()=>{t(window.innerWidth)};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[]),s&&s.length>1&&e.jsxs("div",{className:"w-full grid grid-rows-[auto_1fr] gap-2 bg-color-logo rounded-lg p-4 pb-2 border border-black md:col-span-full md:grid-cols-12 md:h-80",children:[e.jsx("h2",{className:"text-lg font-semibold text-color-violeta font-betonga text-center col-span-full md:text-2xl",children:"Ingresos"}),n&&e.jsxs("small",{className:"absolute",children:["* Máximo $",n.toLocaleString(p)]}),s.map((a,d)=>e.jsxs("div",{className:"grid gap-2 relative md:grid-rows-[1fr_auto] md:items-end ",children:[e.jsx("div",{className:"bg-blue-500 text-xs text-white grid items-center rounded [&>span]:hover:opacity-100 [&>span]:hover:scale-100 h-8",style:r>768?{height:`${a.ganancias/n*100||0}%`}:{width:`${a.ganancias/n*100||0}%`},title:`$ ${a.ganancias}`,children:e.jsxs("span",{className:"absolute text-center opacity-0 scale-0 top-1/2 -translate-y-1/2 right-0 bg-color-violeta font-bold p-2 rounded-lg transition-[opacity_scale] md:right-1/2 md:translate-x-1/2 md:w-full",children:["$",a.ganancias]})}),e.jsx("p",{className:`text-xs text-gray-700 border-b border-black pb-2 ${d===s.length-1?"border-none":""} md:text-center md:border-none`,children:a.mes})]},a.mes))]})},j=()=>m.useContext(T),q=()=>{const{reservas:s}=j(),r=m.useRef();return m.useEffect(()=>{r.current&&r.current.scrollIntoView({behavior:"smooth",block:"start"})},[]),s instanceof Array&&e.jsxs("article",{className:"grid gap-2 col-span-full md:grid-cols-2  md:gap-4",ref:r,children:[e.jsx(B,{datos:s}),s.map(t=>e.jsx(F,{mes:t.mes,cantidadReservas:t.cantidadReservas,estados:t.estados,ganancias:t.ganancias,pacienteMasReservas:t.pacienteMasReservas,servicioMasSolicitado:t.servicioMasSolicitado},t.mes))]})},H=async s=>{const r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},t=N.estadisticas.reservas;return await y(t,r)},G=async(s,r)=>{const t={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},n=`${N.estadisticas.reservasAno}${r}`;return await y(n,t)},W=async(s,r,t)=>{const n={headers:{"Content-Type":"application/json",Authorization:`Bearer ${s||""}`}},a=`${N.estadisticas.reservasMes}${r}/${t}`;return await y(a,n)},A=()=>{const{setLoading:s}=v(),{accessToken:r}=k(),{setMensaje:t}=R(),{dispatch:n}=j();return m.useEffect(()=>{(async()=>{s(!0);try{const o=await H(r),{status:x,error:l,datos:g}=o;x===200?n({type:h.SET_ESTADISTICAS_RESERVAS_TODAS,payload:g}):t(l||"Ocurrió un error el obtener las estadísticas de las reservas del año")}catch{t("Ocurrió un error el obtener las estadisticas de las reservas del año")}finally{s(!1)}})()},[n,t,r,s]),{obtenerReservasDelAno:async c=>{try{s(!0);const o=await G(r,c),{status:x,error:l,datos:g}=o;x===200?n({type:h.SET_ESTADISTICAS_RESERVAS,payload:g}):t(l||"Ocurrió un error el obtener las estadísticas de las reservas del año")}catch{t("Ocurrió un error el obtener las estadisticas de las reservas del año")}finally{s(!1)}},obtenerReservasDelMes:async(c,o)=>{try{s(!0);const x=await W(r,c,o),{status:l,error:g,datos:i}=x;l===200?n({type:h.SET_ESTADISTICAS_RESERVAS,payload:i}):t(g||"Ocurrió un error el obtener las estadísticas de las reservas del mes")}catch{t("Ocurrió un error el obtener las estadisticas de las reservas del mes")}finally{s(!1)}}}},U={year:""},J={year:{required:!0,minLength:4,maxLength:4}},K=({setAno:s})=>{const{loading:r}=v(),{obtenerReservasDelAno:t}=A(),{errors:n,values:a,handleChange:d,resetForm:c,onSubmitForm:o}=S(U,J),x=async l=>{const g=l.year;s(g),await t(g),c()};return e.jsxs("form",{className:"grid gap-2 bg-color-verde-blanco border border-gray-300 shadow-lg p-4 rounded-lg md:col-start-2 md:col-end-4 ",onSubmit:l=>o(l,x),children:[e.jsx(C,{errors:n,labelText:"Ingresa un Año",min:4,name:"year",onChange:d,type:"number",placeholder:2024,value:a.year,maxLength:4,minLength:4}),e.jsx(f,{bgColor:!0,className:"mt-4  w-full",disabled:r,tipo:"submit",texto:"Buscar"})]})},M={year:"",mes:""},Q={year:{required:!0,minLength:4,maxLength:4},mes:{required:!0}},X=({setAno:s,setMes:r})=>{const{loading:t}=v(),{obtenerReservasDelMes:n}=A(),{errors:a,values:d,handleChange:c,onSubmitForm:o,resetForm:x}=S(M,Q),l=async i=>{const u=i.year,E=i.mes;await n(u,E)},g=(i,u)=>{r(u),c({target:{name:i,value:u}})};return e.jsxs("form",{className:"grid gap-2 p-4 rounded-lg md:col-start-2 md:col-end-4 bg-color-verde-blanco border border-gray-300 shadow-lg",onSubmit:i=>o(i,l),children:[e.jsx("label",{children:"Elige un mes"}),a.mes&&e.jsxs("small",{className:"text-red-600",children:["* ",a.mes]}),e.jsx(D,{defaultValue:d.mes,name:"Meses",list:$,onClickFunction:i=>{const u=i.target.textContent;g("mes",u)}}),e.jsx(C,{className:"mb-4",errors:a,labelText:"Ingresa un Año",min:4,name:"year",onChange:i=>{s(i.target.value),c(i)},type:"number",placeholder:2024,value:d.year,maxLength:4,minLength:4}),e.jsx(f,{bgColor:!0,disabled:t,tipo:"submit",texto:"Buscar",className:"mt-4 w-full"})]})},Y=()=>{const[s,r]=m.useState(""),[t,n]=m.useState(""),[a,d]=m.useState(!1),{dispatch:c,reservas:o}=j(),x=()=>{c({type:h.SET_ESTADISTICAS_RESERVAS,payload:null})},l=()=>{r(""),n(""),x(),d(!a)};return e.jsxs("section",{className:"text-color-violeta flex flex-col gap-4 md:grid md:col-span-4 md:grid-cols-4",children:[e.jsxs("h2",{className:"text-xl font-bold font-betonga text-center grid col-span-full md:text-2xl ",children:["Datos del ",a?"mes":"año",e.jsxs("span",{className:"text-sm font-semibold text-gray-500 md:text-base",children:[t?`${t} de`:""," ",s]})]}),a?e.jsx(X,{setAno:r,setMes:n}):e.jsx(K,{setAno:r}),e.jsx(f,{className:"grid grid-flow-col gap-2 col-start-2 col-end-4 w-full",texto:`Buscar por ${a?"año":"mes"}`,onClickFunction:l}),o&&e.jsx(f,{tipo:"button",texto:"Limpiar",onClickFunction:x,className:"grid grid-flow-col gap-2 col-start-2 col-end-4 w-full"}),o&&e.jsx(q,{})]})},le=()=>{const{reservasTodas:s}=j();return e.jsx("main",{className:"flex flex-col py-4 px-2",children:e.jsxs("section",{className:"grid gap-4 max-w-6xl m-auto w-full h-full md:grid-cols-4 md:gap-y-8",children:[e.jsx(z,{gananciasTotales:s.gananciasTotales,perdidasTotales:s.perdidasTotales,pendientesTotales:s.pendientesTotales}),e.jsx(L,{cantidadEstados:s.cantidadEstados}),e.jsx(V,{horarios:s.horarios}),e.jsx(P,{servicios:s.servicios}),e.jsx(Y,{})]})})};export{le as default};
