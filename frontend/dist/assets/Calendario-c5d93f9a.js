import{r,M as y,U as B,j as e,a as G,B as R}from"./index-4e232b89.js";import{C as U,F as P,e as Y,o as F}from"./ContenedorReservas-38f36316.js";import{d as Z,f as D,L as T,c as V}from"./diasSemanaConHoras-71219598.js";import{a as q,D as _,H as $,b as w,E as C,f as H}from"./constantes-5af98ff7.js";import{C as J}from"./ContadorReservas-38c56be7.js";import{f as K}from"./fetchData-919cca5f.js";import"./BotonPrimario-8972ad95.js";import"./TransitionNumber-4119ef34.js";const Q=A=>{const[N,m]=r.useState(!1),[u,p]=r.useState(A),[v,x]=r.useState([]),{setMensaje:S}=r.useContext(y),n=Z(u),{accessToken:d}=r.useContext(B);return r.useEffect(()=>{u&&(async()=>{m(!0);const j={headers:{"Content-Type":"application/json",Authorization:`Bearer ${d||""}`}};try{const i=`${q.reservas.deLaSemana}${u}`;await K(i,j,f=>{if(f.error){S(f.error);return}else x(f.reservas)})}catch(i){console.log(i)}m(!1)})()},[d,S,u]),{reservasSemanales:v,loading:N,diasSemana:n,semanaAnterior:()=>{m(!0);const o=new Date(`${u} 00:00:00.000Z`);o.setDate(o.getDate()-_),p(o.toISOString().split("T")[0]),m(!1)},semanaSiguiente:()=>{m(!0);const o=new Date(`${u} 00:00:00.000Z`);o.setDate(o.getDate()+_),p(o.toISOString().split("T")[0]),m(!1)},setReservasSemanales:x}};function oe(){const[A,N]=r.useState($.split("T")[0]),[m,u]=r.useState($.split("T")[1]),[p,v]=r.useState(!1),[x,S]=r.useState(""),[n,d]=r.useState([]),{setMensaje:g}=r.useContext(y),{loading:b}=r.useContext(B),{semanaAnterior:o,semanaSiguiente:j,reservasSemanales:i,setReservasSemanales:f,loading:E,diasSemana:I}=Q(A),O=a=>{const{reserva:s}=a,c=`Reserva nueva de ${s.pacienteNombre} el dia ${D({fecha:s.horario.horaInicio})} a las ${H(new Date(s.horario.horaInicio))}`;g(c);const t=i.filter(h=>h._id!==s._id),l=n.filter(h=>h._id!==s._id);d([...l,s]),f([...t,s])},L=a=>{d([]),S("");const s=a.target.getAttribute("data-fecha"),c=new Date(s).toISOString(),[t]=c.split("T");N(t),u(c);const l=V(new Date(s),i);if(a.target.className.includes("paraReservaAdmin")&&S("admin"),l.estado){d(l.reservadas),l.estado===C.cancelada&&v(!0);return}if(l.proximaHoraNoDisponible)l.proximaHoraNoDisponible===C.cancelada?v(!0):g("Hora no disponible para reservar");else{v(!0);return}},k=a=>{a.current.parentElement.classList.add("animationReservaOut"),setTimeout(()=>{a.current.parentElement.remove("animationReservaOut"),d([])},500)},z=a=>{const{reserva:s}=a;if(s){const c=`Reserva borrada de ${s.pacienteNombre} el dia ${D({fecha:s.horario.horaInicio})} a las  ${H(new Date(s.horario.horaInicio))}`;g(c);const t=i.filter(l=>l._id!==s._id);f(t.sort(F)),d([])}},M=a=>{if(a==="Toda")d(i.sort(F));else{const s=i.filter(c=>c.estado===a);d(s.sort(F))}};return e.jsxs(e.Fragment,{children:[b&&e.jsx(G,{}),(n==null?void 0:n.length)>0?e.jsx("div",{className:n.length?"divReservaCalendario":"",children:e.jsx(U,{cerrarReserva:k,reservas:n,actualizarReservaEliminada:z,actualizarReservas:a=>{O(a)}})}):null,p&&(n==null?void 0:n.length)===0&&e.jsx(P,{reserva:{pacienteNombre:x,fecha:m},actualizarReserva:a=>{O(a)},setForm:()=>{v(!1)}}),e.jsx("main",{className:"containerCalendario",children:e.jsxs(e.Fragment,{children:[e.jsx(J,{reservas:i,mostrarReservadas:M}),e.jsxs("h1",{children:["Hoy ",D({fecha:$})]}),e.jsxs("div",{className:"containerBotones",children:[e.jsx(R,{onClickFunction:o,texto:"Anterior"}),E&&e.jsx(T,{}),e.jsx(R,{onClickFunction:j,texto:"Siguiente"})]}),e.jsx("div",{className:"containerFechas",children:I.map(a=>a.dia.getDay()!==0&&e.jsxs("div",{className:"dias",children:[e.jsx("h3",{className:`${a.dia.getDate()===w.getDate()&&a.dia.getDay()===w.getDay()?"esHoy":""}`,children:D({fecha:a.dia})}),e.jsx("ul",{className:"HorasCalendario",children:a.horas.map((s,c)=>{const t=Y(i,I).find(h=>h.hora.toISOString()===s.toISOString()),l=c==0||c==1?`paraReservaAdmin ${(t==null?void 0:t.estado)||""}`:t&&t.nombreReserva==="admin"&&(t.estado===C.pago||t.estado===C.pendiente)?`paraReservaAdmin ${t.estado}`:t?`${t.estado}`:"";return e.jsx("li",{"data-fecha":s,onClick:L,className:l,children:H(s)},s.toISOString())})})]},a.dia))}),e.jsxs("div",{className:"containerBotonesAbajo",children:[e.jsx(R,{onClickFunction:o,texto:"Anterior"}),E&&e.jsx(T,{}),e.jsx(R,{onClickFunction:j,texto:"Siguiente"})]})]})})]})}export{oe as default};
